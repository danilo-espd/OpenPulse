
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pulse.preprocessing.preprocessor &#8212; OpenPulse  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../../index.html">
  <img src="../../../_static/logo.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../installing/installing.html">
  Installing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../guides/index.html">
  How-to Guides
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../code_reference/index.html">
  Code reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../theory_reference/index.html">
  Theory reference
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for pulse.preprocessing.preprocessor</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">libs.gmsh</span> <span class="kn">import</span> <span class="n">gmsh</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.transform</span> <span class="kn">import</span> <span class="n">Rotation</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">pulse.preprocessing</span> <span class="kn">import</span> <span class="n">structural_element</span>
<span class="kn">from</span> <span class="nn">pulse.preprocessing.cross_section</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">pulse.preprocessing.entity</span> <span class="kn">import</span> <span class="n">Entity</span>
<span class="kn">from</span> <span class="nn">pulse.preprocessing.node</span> <span class="kn">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">,</span> <span class="n">DOF_PER_NODE_ACOUSTIC</span>
<span class="kn">from</span> <span class="nn">pulse.preprocessing.structural_element</span> <span class="kn">import</span> <span class="n">StructuralElement</span><span class="p">,</span> <span class="n">NODES_PER_ELEMENT</span>
<span class="kn">from</span> <span class="nn">pulse.preprocessing.acoustic_element</span> <span class="kn">import</span> <span class="n">AcousticElement</span><span class="p">,</span> <span class="n">NODES_PER_ELEMENT</span>
<span class="kn">from</span> <span class="nn">pulse.preprocessing.compressor_model</span> <span class="kn">import</span> <span class="n">CompressorModel</span>
<span class="kn">from</span> <span class="nn">pulse.preprocessing.before_run</span> <span class="kn">import</span> <span class="n">BeforeRun</span>
<span class="kn">from</span> <span class="nn">data.user_input.project.printMessageInput</span> <span class="kn">import</span> <span class="n">PrintMessageInput</span>

<span class="kn">from</span> <span class="nn">pulse.utils</span> <span class="kn">import</span> <span class="n">split_sequence</span><span class="p">,</span> <span class="n">m_to_mm</span><span class="p">,</span> <span class="n">mm_to_m</span><span class="p">,</span> <span class="n">slicer</span><span class="p">,</span> <span class="n">_transformation_matrix_3x3xN</span><span class="p">,</span> <span class="n">_transformation_matrix_Nx3x3_by_angles</span><span class="p">,</span> <span class="n">check_is_there_a_group_of_elements_inside_list_elements</span>

<span class="n">window_title_1</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>

<div class="viewcode-block" id="Preprocessor"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor">[docs]</a><span class="k">class</span> <span class="nc">Preprocessor</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A preprocessor class.</span>
<span class="sd">    This class creates a acoustic and structural preprocessor object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_variables</span><span class="p">()</span>

<div class="viewcode-block" id="Preprocessor.reset_variables"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.reset_variables">[docs]</a>    <span class="k">def</span> <span class="nf">reset_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method reset the class default values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOFS_ELEMENT</span> <span class="o">=</span> <span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="o">*</span><span class="n">NODES_PER_ELEMENT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># self.neighbors = {}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_tag_to_entity</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_line_to_nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements_to_line</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_expansion_joint</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_valve</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_expansion_joints_by_lines</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_valves_by_lines</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_length_correction</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_capped_end</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_perforated_plate</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_stress_stiffening</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_expansion_joints</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_valves</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_lines_with_capped_end</span> <span class="o">=</span> <span class="p">{}</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_with_stress_stiffening</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_with_expansion_joints</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_with_valves</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expansion_joint_table_indexes</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_B2PX_rotation_decoupling</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_matrix</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodal_coordinates_matrix</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_nodal_loads</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_prescribed_dofs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_constrained_dofs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_masses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_connected_to_springs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_connected_to_dampers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pair_of_nodes_with_elastic_nodal_links</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_acoustic_pressure</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_volume_velocity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_compressor_excitation</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_specific_impedance</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_radiation_impedance</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_with_length_correction</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_perforated_plate</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_with_capped_end</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_elements_with_B2PX_rotation_decoupling</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_nodes_with_B2PX_rotation_decoupling</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_element_type_to_lines</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_acoustic_element_type_to_lines</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_beam_xaxis_rotating_angle_to_lines</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dict_coordinate_to_update_bc_after_remesh</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_element_info_to_update_indexes_in_entity_file</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_element_info_to_update_indexes_in_element_info_file</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_list_elements_to_subgroups</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_old_to_new_node_external_indexes</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_elastic_link_stiffness</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_elastic_link_dampings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_structural_element_force_offset</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_structural_element_wall_formulation</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_capped_end</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_stress_stiffening</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_adding_mass_effect</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="o">=</span> <span class="s2">&quot;pipe_1&quot;</span> <span class="c1"># defined as default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_fluid_mass_effect</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stress_stiffening_enabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># self.compressor_excitation_table_indexes = []</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">beam_gdofs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipe_gdofs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_processing</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Preprocessor.generate"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">element_size</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method evaluates the Lamé&#39;s first parameter `lambda`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            CAD file path &#39;*.igs&#39; and &#39;*.step&#39; are the file formats supported.</span>

<span class="sd">        element_size : float</span>
<span class="sd">            Element size to be used to build the preprocessor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_size</span> <span class="o">=</span> <span class="n">element_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_variables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_gmsh</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_gmsh_options</span><span class="p">(</span><span class="n">element_size</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_entities</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_map_lines_to_elements</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_gmsh</span><span class="p">()</span>

        <span class="c1"># t0 = time()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_neighbors</span><span class="p">()</span>
        <span class="c1"># dt = time() - t0</span>
        <span class="c1"># print(f&quot;Time to process _load_neighbors: {dt}&quot;)</span>

        <span class="c1"># t0 = time()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order_global_indexes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping_nodes_indexes</span><span class="p">()</span>
        <span class="c1"># dt = time() - t0</span>
        <span class="c1"># print(f&quot;Time to process _order_global_indexes: {dt}&quot;)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">get_nodal_coordinates_matrix</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity_matrix</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_dict_nodes_to_element_indexes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_list_edge_nodes</span><span class="p">(</span><span class="n">element_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_principal_diagonal_structure_parallelepiped</span><span class="p">()</span>
        <span class="c1"># self.get_dict_line_to_nodes()</span>
        
        <span class="c1"># t0 = time()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_all_rotation_matrices</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_dict_lines_to_rotation_angles</span><span class="p">()</span></div>
        <span class="c1"># dt = time() - t0</span>
        <span class="c1"># print(&quot;Time to process all rotations matrices: &quot;, dt)</span>
        

<div class="viewcode-block" id="Preprocessor.neighbor_elements_diameter"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.neighbor_elements_diameter">[docs]</a>    <span class="k">def</span> <span class="nf">neighbor_elements_diameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method maps the elements outer diameters that each node belongs to. The maping is done according to the node external index.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Outer diameters at a certain node. Giving a node external index, returns a list of diameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">neighbor_diameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">first</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">external_index</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">external_index</span>
            <span class="n">neighbor_diameters</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">neighbor_diameters</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="p">[])</span>

            <span class="n">outer_diameter</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">outer_diameter</span>
            <span class="n">inner_diameter</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">inner_diameter</span>

            <span class="n">neighbor_diameters</span><span class="p">[</span><span class="n">first</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">index</span><span class="p">,</span> <span class="n">outer_diameter</span><span class="p">,</span> <span class="n">inner_diameter</span><span class="p">))</span>
            <span class="n">neighbor_diameters</span><span class="p">[</span><span class="n">last</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">index</span><span class="p">,</span> <span class="n">outer_diameter</span><span class="p">,</span> <span class="n">inner_diameter</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">neighbor_diameters</span></div>

<div class="viewcode-block" id="Preprocessor.neighbor_elements_diameter_global"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.neighbor_elements_diameter_global">[docs]</a>    <span class="k">def</span> <span class="nf">neighbor_elements_diameter_global</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method maps the elements inner diameters that each node belongs to. The maping is done according to the node global index.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict</span>
<span class="sd">            Inner diameters at a certain node. Giving a node global index, returns a list of diameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">neighbor_diameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">first</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">global_index</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">global_index</span>
            <span class="n">neighbor_diameters</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">neighbor_diameters</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">outer_diameter</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">outer_diameter</span>
            <span class="n">inner_diameter</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">inner_diameter</span>
            <span class="n">neighbor_diameters</span><span class="p">[</span><span class="n">first</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">index</span><span class="p">,</span> <span class="n">outer_diameter</span><span class="p">,</span> <span class="n">inner_diameter</span><span class="p">))</span>
            <span class="n">neighbor_diameters</span><span class="p">[</span><span class="n">last</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">index</span><span class="p">,</span> <span class="n">outer_diameter</span><span class="p">,</span> <span class="n">inner_diameter</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">neighbor_diameters</span>    </div>
    
<div class="viewcode-block" id="Preprocessor.neighboor_elements_of_node"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.neighboor_elements_of_node">[docs]</a>    <span class="k">def</span> <span class="nf">neighboor_elements_of_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_ID</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the acoustic elements that a node belongs to.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        int</span>
<span class="sd">            Node external indexes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List</span>
<span class="sd">            List of acoustic elements indexes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_ID</span><span class="p">]</span>
        <span class="n">neighboor_elments</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>      
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">first</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">]:</span>
                <span class="n">neighboor_elments</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">neighboor_elments</span><span class="p">[</span><span class="n">node</span><span class="p">]</span></div>

<div class="viewcode-block" id="Preprocessor._initialize_gmsh"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor._initialize_gmsh">[docs]</a>    <span class="k">def</span> <span class="nf">_initialize_gmsh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method initializes mesher algorithm gmsh.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        str</span>
<span class="sd">            CAD file path. &#39;.igs&#39; is the only format file supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="Preprocessor._set_gmsh_options"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor._set_gmsh_options">[docs]</a>    <span class="k">def</span> <span class="nf">_set_gmsh_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_size</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method sets the mesher algorithm configuration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        float</span>
<span class="sd">            Element size.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s1">&#39;Mesh.CharacteristicLengthMin&#39;</span><span class="p">,</span> <span class="n">m_to_mm</span><span class="p">(</span><span class="n">element_size</span><span class="p">))</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s1">&#39;Mesh.CharacteristicLengthMax&#39;</span><span class="p">,</span> <span class="n">m_to_mm</span><span class="p">(</span><span class="n">element_size</span><span class="p">))</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s1">&#39;Mesh.Optimize&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s1">&#39;Mesh.OptimizeNetgen&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s1">&#39;Mesh.HighOrderOptimize&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s1">&#39;Mesh.ElementOrder&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s1">&#39;Mesh.Algorithm&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s1">&#39;Mesh.Algorithm3D&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s1">&#39;Geometry.Tolerance&#39;</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span></div>

<div class="viewcode-block" id="Preprocessor._create_entities"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor._create_entities">[docs]</a>    <span class="k">def</span> <span class="nf">_create_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method generate the mesh entities, nodes, structural elements, acoustic elements </span>
<span class="sd">        and their connectivity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">dim</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getEntities</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">newEntity</span> <span class="o">=</span> <span class="n">Entity</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

            <span class="c1">#Element</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">node_indexes</span><span class="p">,</span> <span class="n">connectivity</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getElements</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> 
            <span class="n">node_indexes</span> <span class="o">=</span> <span class="n">node_indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="n">split_sequence</span><span class="p">(</span><span class="n">connectivity</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node_indexes</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">):</span>
                <span class="n">edges</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span>
                <span class="n">newEntity</span><span class="o">.</span><span class="n">insertEdge</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>

            <span class="c1">#Nodes</span>
            <span class="n">element_indexes</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getNodes</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">split_sequence</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">element_indexes</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">):</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span> <span class="n">mm_to_m</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">mm_to_m</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">mm_to_m</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                <span class="n">newEntity</span><span class="o">.</span><span class="n">insertNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">all_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newEntity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_tag_to_entity</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">newEntity</span>

        <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">removeDuplicateNodes</span><span class="p">()</span>

        <span class="n">node_indexes</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getNodes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">element_indexes</span><span class="p">,</span> <span class="n">connectivity</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getElements</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">map_nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">node_indexes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_indexes</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_elements</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">element_indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">element_indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
       
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_nodes</span><span class="p">(</span><span class="n">node_indexes</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_nodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_structural_elements</span><span class="p">(</span><span class="n">element_indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">connectivity</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_elements</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_acoustic_elements</span><span class="p">(</span><span class="n">element_indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">connectivity</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_elements</span><span class="p">)</span> </div>

<div class="viewcode-block" id="Preprocessor._create_nodes"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor._create_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">_create_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indexes</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">map_nodes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method generate the mesh nodes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indexes : List</span>
<span class="sd">            Nodes global indexes.</span>
<span class="sd">            </span>
<span class="sd">        coords : array</span>
<span class="sd">            Nodes coordinates.</span>
<span class="sd">            </span>
<span class="sd">        map_nodes : dict</span>
<span class="sd">            Dictionary maps global indexes to external indexes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">coord</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indexes</span><span class="p">,</span> <span class="n">split_sequence</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">mm_to_m</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">mm_to_m</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">mm_to_m</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">map_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">external_index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">map_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span></div>

<div class="viewcode-block" id="Preprocessor._create_structural_elements"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor._create_structural_elements">[docs]</a>    <span class="k">def</span> <span class="nf">_create_structural_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indexes</span><span class="p">,</span> <span class="n">connectivities</span><span class="p">,</span> <span class="n">map_nodes</span><span class="p">,</span> <span class="n">map_elements</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method generate the mesh structural elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indexes : List</span>
<span class="sd">            Nodes global indexes.</span>
<span class="sd">            </span>
<span class="sd">        connectivities : array</span>
<span class="sd">            Connectivity matrix that relates the elements and its nodes.</span>
<span class="sd">            </span>
<span class="sd">        map_nodes : dict</span>
<span class="sd">            Dictionary maps global indexes to external indexes.</span>
<span class="sd">            </span>
<span class="sd">        map_elements : dict</span>
<span class="sd">            Dictionary maps global element indexes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">connect</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indexes</span><span class="p">,</span> <span class="n">split_sequence</span><span class="p">(</span><span class="n">connectivities</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span>
            <span class="n">first_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">map_nodes</span><span class="p">[</span><span class="n">connect</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
            <span class="n">last_node</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">map_nodes</span><span class="p">[</span><span class="n">connect</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">map_elements</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">StructuralElement</span><span class="p">(</span><span class="n">first_node</span><span class="p">,</span> <span class="n">last_node</span><span class="p">,</span> <span class="n">map_elements</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_structural_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">)</span></div>

<div class="viewcode-block" id="Preprocessor._create_acoustic_elements"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor._create_acoustic_elements">[docs]</a>    <span class="k">def</span> <span class="nf">_create_acoustic_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indexes</span><span class="p">,</span> <span class="n">connectivities</span><span class="p">,</span> <span class="n">map_nodes</span><span class="p">,</span> <span class="n">map_elements</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method generate the mesh acoustic elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indexes : List</span>
<span class="sd">            Nodes global indexes.</span>
<span class="sd">            </span>
<span class="sd">        connectivities : array</span>
<span class="sd">            Connectivity matrix that relates the elements and its nodes.</span>
<span class="sd">            </span>
<span class="sd">        map_nodes : dict</span>
<span class="sd">            Dictionary maps global indexes to external indexes.</span>
<span class="sd">            </span>
<span class="sd">        map_elements : dict</span>
<span class="sd">            Dictionary maps global element indexes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">connect</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indexes</span><span class="p">,</span> <span class="n">split_sequence</span><span class="p">(</span><span class="n">connectivities</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span>
            <span class="n">first_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">map_nodes</span><span class="p">[</span><span class="n">connect</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
            <span class="n">last_node</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">map_nodes</span><span class="p">[</span><span class="n">connect</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">[</span><span class="n">map_elements</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">AcousticElement</span><span class="p">(</span><span class="n">first_node</span><span class="p">,</span> <span class="n">last_node</span><span class="p">,</span> <span class="n">map_elements</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_acoustic_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">)</span></div>

    <span class="c1"># def _create_dict_gdofs_to_external_indexes(self):</span>
    <span class="c1">#     # t0 = time()</span>
    <span class="c1">#     self.dict_gdofs_to_external_indexes = {}</span>
    <span class="c1">#     for external_index, node in self.nodes.items():</span>
    <span class="c1">#         for gdof in node.global_dof:</span>
    <span class="c1">#             self.dict_gdofs_to_external_indexes[gdof] = external_index</span>
    <span class="c1">#     # dt = time()-t0</span>
    <span class="c1">#     # print(len(self.dict_gdofs_to_external_indexes))</span>
    <span class="c1">#     # print(&quot;Time to process: &quot;, dt)</span>

<div class="viewcode-block" id="Preprocessor._map_lines_to_elements"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor._map_lines_to_elements">[docs]</a>    <span class="k">def</span> <span class="nf">_map_lines_to_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh_loaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method maps entities to elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh_loaded : bool, optional.</span>
<span class="sd">            True if the mesh was already generated (internally or externally). False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mesh_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">elements_to_line</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="c1"># t0 = time()   </span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_elements</span>
            <span class="k">for</span> <span class="n">dim</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getEntities</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">elements_of_entity</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getElements</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">tag</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">list_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mapping</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements_of_entity</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">list_elements</span>
                <span class="k">for</span> <span class="n">element_id</span> <span class="ow">in</span> <span class="n">list_elements</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">elements_to_line</span><span class="p">[</span><span class="n">element_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag</span> </div>
            <span class="c1"># dt = time() - t0</span>
            <span class="c1"># print(f&quot;Time to process : {dt}&quot;)</span>

    <span class="k">def</span> <span class="nf">_map_lines_to_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># t0 = time()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_line_to_nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line_ID</span><span class="p">,</span> <span class="n">list_elements</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">list_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_elements</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_elements</span><span class="p">):</span>
                <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">_id</span><span class="p">]</span>
                <span class="n">first_node_id</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">external_index</span>
                <span class="n">last_node_id</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">external_index</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">list_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">first_node_id</span>
                <span class="n">list_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_node_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_line_to_nodes</span><span class="p">[</span><span class="n">line_ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">list_nodes</span><span class="p">)</span>              
        <span class="c1"># dt = time() - t0</span>
        <span class="c1"># print(f&quot;Time to process : {dt}&quot;)</span>

    <span class="k">def</span> <span class="nf">get_line_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_ID</span><span class="p">):</span>
        <span class="n">first_element_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">[</span><span class="n">line_ID</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">last_element_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">[</span><span class="n">line_ID</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">node1_first_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">first_element_ID</span><span class="p">]</span><span class="o">.</span><span class="n">first_node</span>
        <span class="n">node2_first_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">first_element_ID</span><span class="p">]</span><span class="o">.</span><span class="n">last_node</span>

        <span class="n">node3_last_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">last_element_ID</span><span class="p">]</span><span class="o">.</span><span class="n">first_node</span>
        <span class="n">node4_last_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">last_element_ID</span><span class="p">]</span><span class="o">.</span><span class="n">last_node</span>

        <span class="n">list_nodes</span> <span class="o">=</span> <span class="p">[</span>  <span class="n">node1_first_element</span><span class="p">,</span> <span class="n">node2_first_element</span><span class="p">,</span> 
                        <span class="n">node3_last_element</span><span class="p">,</span> <span class="n">node4_last_element</span>  <span class="p">]</span>

        <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_nodes</span><span class="p">)):</span>
            <span class="n">length_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">list_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">-</span> <span class="n">list_nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">length_i</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">length_i</span>
                <span class="n">_node</span> <span class="o">=</span> <span class="n">list_nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">edge_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">list_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_node</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">length</span><span class="p">,</span> <span class="n">edge_nodes</span>

<div class="viewcode-block" id="Preprocessor._finalize_gmsh"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor._finalize_gmsh">[docs]</a>    <span class="k">def</span> <span class="nf">_finalize_gmsh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method finalize the mesher gmsh algorithm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span></div>

<div class="viewcode-block" id="Preprocessor._load_neighbors"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor._load_neighbors">[docs]</a>    <span class="k">def</span> <span class="nf">_load_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method updates the structural elements neighbors dictionary. The dictionary&#39;s keys and values are nodes objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements_connected_to_node</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="c1"># self.nodes_with_multiples_neighbors = {}</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elements_connected_to_node</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elements_connected_to_node</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span></div>
            <span class="c1"># if len(self.neighbors[element.first_node]) &gt; 2:</span>
            <span class="c1">#     self.nodes_with_multiples_neighbors[element.first_node] = self.neighbors[element.first_node]</span>
            <span class="c1"># if len(self.neighbors[element.last_node]) &gt; 2:</span>
            <span class="c1">#     self.nodes_with_multiples_neighbors[element.last_node] = self.neighbors[element.last_node]</span>

<div class="viewcode-block" id="Preprocessor.add_lids_to_variable_cross_sections"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.add_lids_to_variable_cross_sections">[docs]</a>    <span class="k">def</span> <span class="nf">add_lids_to_variable_cross_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method adds lids to cross_section variations and terminations.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_connected_to_node</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>

            <span class="n">element</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">first_element</span><span class="p">,</span> <span class="n">last_element</span> <span class="o">=</span> <span class="n">elements</span>
                
                <span class="k">if</span> <span class="s1">&#39;beam_1&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">first_element</span><span class="o">.</span><span class="n">element_type</span><span class="p">,</span> <span class="n">last_element</span><span class="o">.</span><span class="n">element_type</span><span class="p">]:</span>
                    <span class="n">first_cross</span> <span class="o">=</span> <span class="n">first_element</span><span class="o">.</span><span class="n">cross_section</span>
                    <span class="n">last_cross</span> <span class="o">=</span> <span class="n">last_element</span><span class="o">.</span><span class="n">cross_section</span>
                    
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">first_cross</span> <span class="ow">and</span> <span class="n">last_cross</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="n">first_outer_diameter</span> <span class="o">=</span> <span class="n">first_cross</span><span class="o">.</span><span class="n">outer_diameter</span>
                    <span class="n">first_inner_diameter</span> <span class="o">=</span> <span class="n">first_cross</span><span class="o">.</span><span class="n">inner_diameter</span>
                    <span class="n">last_outer_diameter</span> <span class="o">=</span> <span class="n">last_cross</span><span class="o">.</span><span class="n">outer_diameter</span>
                    <span class="n">last_inner_diameter</span> <span class="o">=</span> <span class="n">last_cross</span><span class="o">.</span><span class="n">inner_diameter</span>

                    <span class="k">if</span> <span class="n">first_outer_diameter</span> <span class="o">&lt;</span> <span class="n">last_inner_diameter</span><span class="p">:</span>
                        <span class="n">inner_diameter</span> <span class="o">=</span> <span class="n">first_inner_diameter</span> 
                        <span class="n">element</span> <span class="o">=</span> <span class="n">last_element</span>

                    <span class="k">if</span> <span class="n">last_outer_diameter</span> <span class="o">&lt;</span> <span class="n">first_inner_diameter</span><span class="p">:</span>
                        <span class="n">inner_diameter</span> <span class="o">=</span> <span class="n">last_inner_diameter</span> 
                        <span class="n">element</span> <span class="o">=</span> <span class="n">first_element</span>
            
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 

                <span class="n">element</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   
                <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">element_type</span> <span class="o">==</span> <span class="s1">&#39;beam_1&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>  

                <span class="n">first_node</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span>
                <span class="n">last_node</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span>  

                <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">inner_diameter</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">inner_diameter</span> 

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">first_node</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_attributes_from_node</span><span class="p">(</span><span class="n">first_node</span><span class="p">,</span> <span class="n">acoustic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">inner_diameter</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">last_node</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_attributes_from_node</span><span class="p">(</span><span class="n">last_node</span><span class="p">,</span> <span class="n">acoustic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">inner_diameter</span> <span class="o">=</span> <span class="mi">0</span>
            
            <span class="k">if</span> <span class="n">element</span><span class="p">:</span>

                <span class="n">cross</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span>
                <span class="n">outer_diameter</span> <span class="o">=</span> <span class="n">cross</span><span class="o">.</span><span class="n">outer_diameter</span>
                <span class="n">offset_y</span> <span class="o">=</span> <span class="n">cross</span><span class="o">.</span><span class="n">offset_y</span>
                <span class="n">offset_z</span> <span class="o">=</span> <span class="n">cross</span><span class="o">.</span><span class="n">offset_z</span>
                <span class="n">insulation_thickness</span> <span class="o">=</span> <span class="n">cross</span><span class="o">.</span><span class="n">insulation_thickness</span>
                <span class="n">section_label</span> <span class="o">=</span> <span class="n">cross</span><span class="o">.</span><span class="n">section_label</span>
        
                <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">element_type</span> <span class="o">==</span> <span class="s1">&#39;expansion_joint&#39;</span><span class="p">:</span>
                    <span class="n">_key</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">expansion_joint_plot_key</span>
                    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">outer_diameter</span><span class="p">,</span> <span class="n">inner_diameter</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span><span class="p">,</span> <span class="n">insulation_thickness</span><span class="p">,</span> <span class="n">_key</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">outer_diameter</span><span class="p">,</span> <span class="n">inner_diameter</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">offset_z</span><span class="p">,</span> <span class="n">insulation_thickness</span><span class="p">]</span>
                <span class="n">element</span><span class="o">.</span><span class="n">cross_section_points</span> <span class="o">=</span> <span class="n">get_circular_section_points</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">section_label</span><span class="p">)</span></div>
                        
    <span class="k">def</span> <span class="nf">get_number_attributes_from_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">acoustic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">structural</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        
        <span class="n">countA</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">acoustic</span><span class="p">:</span>
            <span class="n">acoustic_bcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">acoustic_pressure</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">volume_velocity</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">specific_impedance</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">radiation_impedance</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">compressor_excitation_table_names</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">acoustic_bc</span> <span class="ow">in</span> <span class="n">acoustic_bcs</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">acoustic_bc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">countA</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">acoustic_bc</span><span class="p">:</span>
                    <span class="n">countA</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">radiation_impedance_type</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
                <span class="n">countA</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">countA</span>

        <span class="n">countS</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">structural</span><span class="p">:</span>
            <span class="n">structural_bcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">prescribed_dofs</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">nodal_loads</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">lumped_masses</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">lumped_stiffness</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">lumped_dampings</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">elastic_nodal_link_stiffness</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">structural_bc</span> <span class="ow">in</span> <span class="n">structural_bcs</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structural_bc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">countS</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">structural_bc</span><span class="p">:</span>
                    <span class="n">countS</span> <span class="o">+=</span><span class="mi">1</span>
            <span class="k">return</span> <span class="n">countS</span>
             
    <span class="k">def</span> <span class="nf">get_list_edge_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
        
        <span class="n">coord_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodal_coordinates_matrix_external</span>
        <span class="c1"># self.list_edge_nodes = []</span>
        <span class="n">list_node_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">neigh_nodes</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">neigh_nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># self.list_edge_nodes.append(node.external_index)</span>
                <span class="n">coord</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">coordinates</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coord_matrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coord</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="p">((</span><span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">)</span>
                <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">list_external_indexes</span> <span class="o">=</span> <span class="n">coord_matrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_external_indexes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">external_index</span> <span class="ow">in</span> <span class="n">list_external_indexes</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">external_index</span><span class="p">]])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="n">list_node_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">external_index</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_log_error</span><span class="p">:</span>
                        <span class="n">PrintMessageInput</span><span class="p">([</span><span class="s2">&quot;Error while checking mesh at the line edges&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">_log_error</span><span class="p">),</span> <span class="n">window_title_1</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_node_ids</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Problem detected in connectivity between neighbor nodes&quot;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;At least one disconnected node has been detected at the edge of one line due &quot;</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;to the mismatch between the geometry &#39;keypoints&#39; and the current mesh setup. &quot;</span> 
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;We strongly recommend reducing the element size or correcting the problem &quot;</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;in the geometry file before proceeding with the model setup.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;List of disconnected node(s): </span><span class="se">\n</span><span class="si">{</span><span class="n">list_node_ids</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">PrintMessageInput</span><span class="p">([</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">window_title_1</span><span class="p">])</span>                
        

    <span class="k">def</span> <span class="nf">get_line_from_node_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_ids</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node_ids</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">node_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">node_ids</span><span class="p">]</span>
        
        <span class="n">line_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_first_node_to_element_index</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">element_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_first_node_to_element_index</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span>
                <span class="n">line_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_to_line</span><span class="p">[</span><span class="n">element_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            
            <span class="k">elif</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_last_node_to_element_index</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">element_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_last_node_to_element_index</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span>
                <span class="n">line_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_to_line</span><span class="p">[</span><span class="n">element_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">line_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_id</span><span class="p">)</span>  

        <span class="k">return</span> <span class="n">line_ids</span>
 

<div class="viewcode-block" id="Preprocessor._order_global_indexes"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor._order_global_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">_order_global_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method updates the nodes global indexes numbering.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># t0 = time()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
        <span class="n">list_nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">old_version</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">old_version</span><span class="p">:</span>

            <span class="n">stack</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="n">list_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>

                <span class="n">top</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">list_nodes</span><span class="p">:</span>
                    <span class="n">list_nodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">top</span><span class="o">.</span><span class="n">global_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># list_nodes.remove(top)</span>
                    <span class="n">top</span><span class="o">.</span><span class="n">global_index</span> <span class="o">=</span> <span class="n">index</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
                
                <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">top</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">global_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">stack</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="n">neighbor</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_nodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">stack</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="n">list_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        
                        <span class="c1">#TODO: uncomment to rebegin from start or end nodes</span>
                        <span class="c1"># for node in list_nodes:</span>
                        <span class="c1">#     if len(self.neighbors[node]) == 1:</span>
                        <span class="c1">#         stack.appendleft(node)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">stack</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="n">list_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">external_index</span><span class="p">)</span> 

            <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
            
                <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()]</span>
        
                <span class="k">if</span> <span class="n">top</span><span class="o">.</span><span class="n">global_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">top</span><span class="o">.</span><span class="n">global_index</span> <span class="o">=</span> <span class="n">index</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
                
                <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">top</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">global_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">external_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">:</span>
                            <span class="n">stack</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="n">neighbor</span><span class="o">.</span><span class="n">external_index</span><span class="p">)</span>
                        
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_nodes</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">list_nodes</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">global_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">stack</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">external_index</span><span class="p">)</span>
                                <span class="k">break</span></div>
                        
                        <span class="c1">#TODO: uncomment to begin from start or end nodes</span>
                        <span class="c1"># for node in list_nodes:</span>
                        <span class="c1">#     if len(self.neighbors[node]) == 1:</span>
                        <span class="c1">#         stack.appendleft(node)   </span>

    <span class="k">def</span> <span class="nf">_mapping_nodes_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_global_to_external_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="o">.</span><span class="n">global_index</span><span class="p">:</span><span class="n">node</span><span class="o">.</span><span class="n">external_index</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>


<div class="viewcode-block" id="Preprocessor.load_mesh"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.load_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">load_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method creates mesh data from nodes coordinates and connectivity matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coordinates : array.</span>
<span class="sd">            Nodes&#39; coordinates. Each row presents the nodes&#39; index, x-coordinate, y-coordinate, and z-coordinate. Coordinates matrix row structure:</span>
<span class="sd">            &#39;&#39;[Node index, x-coordinate, y-coordinate, z-coordinate]&#39;&#39;.</span>
<span class="sd">            </span>
<span class="sd">        connectivity : array.</span>
<span class="sd">            Connectivity matrix. Each row presents the elements&#39; index, first node index, and last node index. Connectivity matrix row structure:</span>
<span class="sd">            &#39;&#39;[Element index, first node index, last node index]&#39;&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">connectivity</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_structural_elements</span> <span class="o">=</span> <span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_acoustic_elements</span> <span class="o">=</span> <span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">newEntity</span> <span class="o">=</span> <span class="n">Entity</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">map_indexes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">map_indexes</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">external_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">map_indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">node</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">map_indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
            <span class="n">newEntity</span><span class="o">.</span><span class="n">insertNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">connectivity</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">first_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">map_indexes</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
            <span class="n">last_node</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">map_indexes</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">StructuralElement</span><span class="p">(</span><span class="n">first_node</span><span class="p">,</span> <span class="n">last_node</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">AcousticElement</span><span class="p">(</span><span class="n">first_node</span><span class="p">,</span> <span class="n">last_node</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">map_indexes</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">map_indexes</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">newEntity</span><span class="o">.</span><span class="n">insertEdge</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newEntity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_tag_to_entity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">newEntity</span>
        <span class="c1">#Ordering global indexes</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">global_index</span> <span class="o">=</span> <span class="n">index</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_nodal_coordinates_matrix</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_connectivity_matrix</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_dict_nodes_to_element_indexes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_principal_diagonal_structure_parallelepiped</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_map_lines_to_elements</span><span class="p">(</span><span class="n">mesh_loaded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_all_rotation_matrices</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_dict_lines_to_rotation_angles</span><span class="p">()</span></div>
        <span class="c1"># self._create_dict_gdofs_to_external_indexes()</span>

<div class="viewcode-block" id="Preprocessor.get_dict_nodes_to_element_indexes"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_dict_nodes_to_element_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">get_dict_nodes_to_element_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method updates the dictionary that maps the external node to the element index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_first_node_to_element_index</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_last_node_to_element_index</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">first_node_index</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">external_index</span>
            <span class="n">last_node_index</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">external_index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_first_node_to_element_index</span><span class="p">[</span><span class="n">first_node_index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_last_node_to_element_index</span><span class="p">[</span><span class="n">last_node_index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="Preprocessor.get_nodal_coordinates_matrix"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_nodal_coordinates_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">get_nodal_coordinates_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reordering</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method updates the mesh nodes coordinates data. Coordinates matrix row structure:</span>
<span class="sd">        &#39;&#39;[Node index, x-coordinate, y-coordinate, z-coordinate]&#39;&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reordering : bool, optional.</span>
<span class="sd">            True if the nodes numbering is according to the global indexing. False otherwise.</span>
<span class="sd">            Default is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.number_nodes = len(self.nodes)</span>
        <span class="n">nodal_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">number_nodes</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">nodal_coordinates_external</span> <span class="o">=</span> <span class="n">nodal_coordinates</span>

        <span class="c1"># if reordering:</span>
        <span class="k">for</span> <span class="n">external_index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">external_index</span><span class="p">]</span><span class="o">.</span><span class="n">global_index</span>
            <span class="n">nodal_coordinates</span><span class="p">[</span><span class="n">index</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">z</span>
            <span class="n">nodal_coordinates_external</span><span class="p">[</span><span class="n">index</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">external_index</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">z</span>
        <span class="c1"># else:               </span>
        <span class="c1">#     for external_index, node in self.nodes.items():</span>
        <span class="c1">#         index = self.nodes[external_index].global_index</span>
        <span class="c1">#         nodal_coordinates[index,:] = external_index, node.x, node.y, node.z</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodal_coordinates_matrix</span> <span class="o">=</span> <span class="n">nodal_coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodal_coordinates_matrix_external</span> <span class="o">=</span> <span class="n">nodal_coordinates_external</span></div>
    

<div class="viewcode-block" id="Preprocessor.get_connectivity_matrix"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_connectivity_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">get_connectivity_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reordering</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method updates the mesh connectivity data. Connectivity matrix row structure:</span>
<span class="sd">        &#39;&#39;[Element index, first node index, last node index]&#39;&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reordering : bool, optional.</span>
<span class="sd">            True if the nodes numbering is according to the global indexing. False otherwise.</span>
<span class="sd">            Default is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">number_structural_elements</span><span class="p">,</span> <span class="n">NODES_PER_ELEMENT</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">reordering</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">first</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">global_index</span>
                <span class="n">last</span>  <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">global_index</span>
                <span class="n">first_external</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">external_index</span>
                <span class="n">last_external</span>  <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">external_index</span>
                <span class="n">connectivity</span><span class="p">[</span><span class="n">index</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">first</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">external_index</span>
                <span class="n">last</span>  <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">external_index</span>
                <span class="n">connectivity</span><span class="p">[</span><span class="n">index</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_matrix</span> <span class="o">=</span> <span class="n">connectivity</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> </div>

<div class="viewcode-block" id="Preprocessor.get_element_center_coordinates_matrix"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_element_center_coordinates_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_center_coordinates_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method updates the center coordinates matrix attribute. </span>
<span class="sd">        </span>
<span class="sd">        Element center coordinates matrix row structure:</span>

<span class="sd">        [Element index, x-element_center_coordinate, y-element_center_coordinate, z-element_center_coordinate].</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_coordinates_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">center_coordinates_matrix</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">center_coordinates_matrix</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">element_center_coordinates</span></div>
        
<div class="viewcode-block" id="Preprocessor.get_principal_diagonal_structure_parallelepiped"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_principal_diagonal_structure_parallelepiped">[docs]</a>    <span class="k">def</span> <span class="nf">get_principal_diagonal_structure_parallelepiped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method updates the principal structure diagonal parallelepiped attribute. </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodal_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodal_coordinates_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">z_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">nodal_coordinates</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">nodal_coordinates</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure_principal_diagonal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x_max</span><span class="o">-</span><span class="n">x_min</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_max</span><span class="o">-</span><span class="n">y_min</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z_max</span><span class="o">-</span><span class="n">z_min</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span></div>
        <span class="c1"># print(&#39;The base length is: {}[m]&#39;.format(round(self.structure_principal_diagonal,6)))</span>

<div class="viewcode-block" id="Preprocessor.get_global_structural_indexes"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_global_structural_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">get_global_structural_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the placement of the rows and columns of the structural global degrees of freedom in the global matrices.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        row : array.</span>
<span class="sd">            Integers that place the rows.</span>
<span class="sd">            </span>
<span class="sd">        column : array.</span>
<span class="sd">            Integers that place the columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Process the I and J indexes vector for assembly process</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_structural_elements</span><span class="p">,</span> <span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="o">*</span><span class="n">NODES_PER_ELEMENT</span>
        <span class="n">cols_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_matrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">cols_dofs</span> <span class="o">=</span> <span class="n">cols_nodes</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">DOF_PER_NODE_STRUCTURAL</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">cols_dofs</span> <span class="o">=</span> <span class="n">cols_dofs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">cols_dofs</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">cols_dofs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="nd">@np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">cols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">I</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">J</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="Preprocessor.get_global_acoustic_indexes"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_global_acoustic_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">get_global_acoustic_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the placement of the rows and columns of the acoustic global degrees of freedom in the global matrices.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        row : array.</span>
<span class="sd">            Integers that place the rows.</span>
<span class="sd">            </span>
<span class="sd">        column : array.</span>
<span class="sd">            Integers that place the columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">),</span> <span class="n">DOF_PER_NODE_ACOUSTIC</span><span class="o">*</span><span class="n">NODES_PER_ELEMENT</span>
        <span class="n">cols_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_matrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">cols_dofs</span> <span class="o">=</span> <span class="n">cols_nodes</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">cols_dofs</span> <span class="o">=</span> <span class="n">cols_dofs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">cols_dofs</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">cols_dofs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="nd">@np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">cols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">I</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">J</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">map_structural_to_acoustic_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_to_acoustic_elements</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_to_acoustic_elements</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_to_acoustic_elements</span> 

<div class="viewcode-block" id="Preprocessor.get_neighbor_nodes_and_elements_by_node"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_neighbor_nodes_and_elements_by_node">[docs]</a>    <span class="k">def</span> <span class="nf">get_neighbor_nodes_and_elements_by_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method returns two lists of nodes ids and elements ids at the neighborhood of the </span>
<span class="sd">            node_id in the range of -(length/2) - tolerance and (length/2) + tolerance. The tolerance </span>
<span class="sd">            avoids the problem of element size deviations resultant in the mesh generation algorithm.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="n">half_length</span> <span class="o">=</span> <span class="p">(</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">tolerance</span>
        <span class="n">node_central</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span>
        <span class="n">list_nodes_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">node_id</span><span class="p">]</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()]]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">((</span><span class="n">node_central</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">coordinates</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">half_length</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">external_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">list_nodes_ids</span><span class="p">:</span>
                            <span class="n">list_nodes_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">external_index</span><span class="p">)</span>
                            <span class="n">stack</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">external_index</span><span class="p">)</span>                    
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">list_elements_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">external_index</span> <span class="ow">in</span> <span class="n">list_nodes_ids</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">external_index</span> <span class="ow">in</span> <span class="n">list_nodes_ids</span><span class="p">:</span>
                    <span class="n">list_elements_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_elements_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_nodes_ids</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">list_nodes_ids</span><span class="p">,</span> <span class="n">list_elements_ids</span></div>

<div class="viewcode-block" id="Preprocessor.get_neighbor_nodes_and_elements_by_element"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_neighbor_nodes_and_elements_by_element">[docs]</a>    <span class="k">def</span> <span class="nf">get_neighbor_nodes_and_elements_by_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method returns two lists of nodes ids and elements ids at the neighborhood of the </span>
<span class="sd">            element_id in the range of -(length/2) - tolerance and (length/2) + tolerance. The tolerance </span>
<span class="sd">            avoids the problem of element size deviations resultant in the mesh generation algorithm.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------- </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">                               </span>
<span class="sd">        &quot;&quot;&quot;</span>         
        <span class="n">node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">element_id</span><span class="p">]</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">external_index</span>
        <span class="n">last_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">element_id</span><span class="p">]</span><span class="o">.</span><span class="n">last_node</span>
        
        <span class="n">length_t</span> <span class="o">=</span> <span class="n">length</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">element_id</span><span class="p">]</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="n">list_nodes_ids</span><span class="p">,</span> <span class="n">list_elements_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighbor_nodes_and_elements_by_node</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">length_t</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">list_nodes_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                
            <span class="k">for</span> <span class="n">external_index</span> <span class="ow">in</span> <span class="n">list_nodes_ids</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">external_index</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">((</span><span class="n">last_node</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">coordinates</span><span class="p">))</span> <span class="o">&gt;</span> <span class="p">((</span><span class="n">length_t</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">):</span>
                    <span class="n">list_nodes_ids</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">external_index</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">list_elements_ids</span><span class="p">:</span>
                <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">external_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">list_nodes_ids</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">list_elements_ids</span><span class="p">:</span>
                        <span class="n">list_elements_ids</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        
                <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">external_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">list_nodes_ids</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">list_elements_ids</span><span class="p">:</span> 
                        <span class="n">list_elements_ids</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        
            <span class="k">return</span> <span class="n">list_nodes_ids</span><span class="p">,</span> <span class="n">list_elements_ids</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Preprocessor._reset_global_indexes"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor._reset_global_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">_reset_global_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes None to global index of all mesh nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">node</span><span class="o">.</span><span class="n">global_index</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Preprocessor.set_structural_element_type_by_element"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_structural_element_type_by_element">[docs]</a>    <span class="k">def</span> <span class="nf">set_structural_element_type_by_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">element_type</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes structural element type to a list of elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elements : list</span>
<span class="sd">            Structural elements indexes.</span>
<span class="sd">            </span>
<span class="sd">        element_type : str, [&#39;pipe_1&#39;, &#39;pipe_2&#39;, &#39;beam_1&#39;, &#39;expansion_joint&#39;, &#39;valve&#39;]</span>
<span class="sd">            Structural element type to be attributed to the listed elements.</span>
<span class="sd">            </span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            True if the element_type have to be removed from the structural element type dictionary. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">element_type</span> <span class="o">=</span> <span class="n">element_type</span>
        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_element_type_to_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Preprocessor.set_structural_element_force_offset_by_elements"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_structural_element_force_offset_by_elements">[docs]</a>    <span class="k">def</span> <span class="nf">set_structural_element_force_offset_by_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">force_offset</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method assigns a structural element wall formulation to a list of selected elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elements : list</span>
<span class="sd">            Structural elements indexes.</span>
<span class="sd">            </span>
<span class="sd">        force_offset : int, [0, 1]</span>
<span class="sd">            Structural element type to be attributed to the listed elements.</span>
<span class="sd">            </span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            True if the element_force_offset should to be removed from the _________ dictionary. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">force_offset</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">force_offset</span><span class="p">)</span></div>
        <span class="c1">#TODO: check if it is necessary</span>
        <span class="c1"># if remove:</span>
        <span class="c1">#     return</span>
            <span class="c1"># self.dict_structural_element_force_offset_to_lines.pop(force_offset)</span>

<div class="viewcode-block" id="Preprocessor.set_structural_element_wall_formulation_by_elements"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_structural_element_wall_formulation_by_elements">[docs]</a>    <span class="k">def</span> <span class="nf">set_structural_element_wall_formulation_by_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">wall_formulation</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method assigns a structural element wall formulation to a list of selected elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elements : list</span>
<span class="sd">            Structural elements indexes.</span>
<span class="sd">            </span>
<span class="sd">        wall_formulation : str, [&#39;thick_wall&#39;, &#39;thin_wall&#39;]</span>
<span class="sd">            Structural element type to be attributed to the listed elements.</span>
<span class="sd">            </span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            True if the element_wall_formulation should to be removed from the _________ dictionary. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">wall_formulation</span> <span class="o">=</span> <span class="n">wall_formulation</span></div>
        <span class="c1">#TODO: check if it is necessary</span>
        <span class="c1"># if remove:</span>
        <span class="c1">#     return</span>
            <span class="c1"># self.dict_structural_element_wall_formulation_to_lines.pop(wall_formulation)</span>

<div class="viewcode-block" id="Preprocessor.set_acoustic_element_type_by_element"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_acoustic_element_type_by_element">[docs]</a>    <span class="k">def</span> <span class="nf">set_acoustic_element_type_by_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">element_type</span><span class="p">,</span> <span class="n">proportional_damping</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vol_flow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes acoustic element type to a list of elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elements : list</span>
<span class="sd">            Acoustic elements indexes.</span>
<span class="sd">            </span>
<span class="sd">        element_type : str, [&#39;undamped&#39;, &#39;proportional&#39;, &#39;wide-duct&#39;, &#39;LRF fluid equivalent&#39;, &#39;LRF full&#39;]</span>
<span class="sd">            Acoustic element type to be attributed to the listed elements.</span>
<span class="sd">            </span>
<span class="sd">        proportional_damping : float, optional</span>
<span class="sd">            Acoustic proportional damping coefficient. It must be attributed to the elements of type &#39;proportional&#39;.</span>
<span class="sd">            Default is None.</span>
<span class="sd">            </span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            True if the element_type have to be removed from the acoustic element type dictionary. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">element_type</span> <span class="o">=</span> <span class="n">element_type</span>
            <span class="n">element</span><span class="o">.</span><span class="n">proportional_damping</span> <span class="o">=</span> <span class="n">proportional_damping</span>
            <span class="n">element</span><span class="o">.</span><span class="n">vol_flow</span> <span class="o">=</span> <span class="n">vol_flow</span>
        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_acoustic_element_type_to_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Preprocessor.set_cross_section_by_element"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_cross_section_by_element">[docs]</a>    <span class="k">def</span> <span class="nf">set_cross_section_by_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">cross_section</span><span class="p">,</span> <span class="n">update_cross_section</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">update_section_points</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes cross section object to a list of acoustic and structural elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elements : list</span>
<span class="sd">            Acoustic and structural elements indexes.</span>
<span class="sd">            </span>
<span class="sd">        cross_section : Cross section object</span>
<span class="sd">            Tube cross section data.</span>
<span class="sd">            </span>
<span class="sd">        update_cross_section : bool, optional</span>
<span class="sd">            True if the cross section data have to be evaluated or updated. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">update_cross_section</span><span class="p">:</span>
            <span class="n">cross_section</span><span class="o">.</span><span class="n">update_properties</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cross_section</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
                <span class="n">_cross_section</span> <span class="o">=</span> <span class="n">cross_section</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">_element</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">_element</span><span class="p">):</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span> <span class="o">=</span> <span class="n">_cross_section</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">,</span> <span class="n">_element</span><span class="p">):</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span> <span class="o">=</span> <span class="n">_cross_section</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
                <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span> <span class="o">=</span> <span class="n">cross_section</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
                <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span> <span class="o">=</span> <span class="n">cross_section</span>

        <span class="k">if</span> <span class="n">update_section_points</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cross_section</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cross_section</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
                        <span class="n">_element</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span><span class="p">]</span>
                        <span class="c1"># _cross_section = cross_section[i]</span>
                        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">_element</span><span class="p">):</span>
                            <span class="n">element</span><span class="o">.</span><span class="n">cross_section_points</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">get_cross_section_points</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">,</span> <span class="n">_element</span><span class="p">):</span>
                            <span class="n">element</span><span class="o">.</span><span class="n">cross_section_points</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">get_cross_section_points</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>    
                    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
                        <span class="n">element</span><span class="o">.</span><span class="n">cross_section_points</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">get_cross_section_points</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
                        <span class="n">element</span><span class="o">.</span><span class="n">cross_section_points</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">get_cross_section_points</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">length</span><span class="p">)</span></div>

<div class="viewcode-block" id="Preprocessor.set_cross_section_by_line"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_cross_section_by_line">[docs]</a>    <span class="k">def</span> <span class="nf">set_cross_section_by_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">cross_section</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes cross section object to all elements that belongs to a line/entity.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        line : list</span>
<span class="sd">            Entities tag.</span>
<span class="sd">            </span>
<span class="sd">        cross_section : Cross section object</span>
<span class="sd">            Tube cross section data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cross_section_by_element</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">cross_section</span><span class="p">)</span></div>
    
    <span class="c1"># def set_cross_section_plot_info_by_element(self, elements, cross_section):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This method attributes cross section object to a list of acoustic and structural elements.</span>

    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     elements : list</span>
    <span class="c1">#         Acoustic and structural elements indexes.</span>
            
    <span class="c1">#     cross_section : Cross section object</span>
    <span class="c1">#         Tube cross section data.</span>
            
    <span class="c1">#     update_cross_section : bool, optional</span>
    <span class="c1">#         True if the cross section data have to be evaluated or updated. False otherwise.</span>
    <span class="c1">#         Default is False.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>

    <span class="c1">#     if isinstance(cross_section, list):</span>
    <span class="c1">#         for i, element in enumerate(elements):</span>
    <span class="c1">#             _cross_section = cross_section[i]</span>
    <span class="c1">#             _element = [element]</span>
    <span class="c1">#             for element in slicer(self.structural_elements, _element):</span>
    <span class="c1">#                 element.cross_section_plot_info = _cross_section</span>
    <span class="c1">#             for element in slicer(self.acoustic_elements, _element):</span>
    <span class="c1">#                 element.cross_section_plot_info = _cross_section</span>
    <span class="c1">#     else:    </span>
    <span class="c1">#         for element in slicer(self.structural_elements, elements):</span>
    <span class="c1">#             element.cross_section_plot_info = cross_section</span>
    <span class="c1">#         for element in slicer(self.acoustic_elements, elements):</span>
    <span class="c1">#             element.cross_section_plot_info = cross_section</span>

    <span class="c1"># def set_cross_section_plot_info_by_line(self, lines, cross_section):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This method attributes cross section plot info object to all elements that belongs to a line/entity.</span>

    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     line : list</span>
    <span class="c1">#         Entities tag.</span>
            
    <span class="c1">#     cross_section : Cross section plot info object</span>
    <span class="c1">#         Tube cross section data.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     for elements in slicer(self.line_to_elements, lines):</span>
    <span class="c1">#         self.set_cross_section_plot_info_by_element(elements, cross_section)</span>

<div class="viewcode-block" id="Preprocessor.set_structural_element_type_by_lines"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_structural_element_type_by_lines">[docs]</a>    <span class="k">def</span> <span class="nf">set_structural_element_type_by_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">element_type</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes structural element type to all elements that belongs to a line/entity.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        line : list</span>
<span class="sd">            Entities tag.</span>
<span class="sd">            </span>
<span class="sd">        element_type : str, [&#39;pipe_1&#39;, &#39;pipe_2&#39;, &#39;beam_1&#39;, &#39;expansion_joint&#39;, &#39;valve&#39;]</span>
<span class="sd">            Structural element type to be attributed to elements.</span>
<span class="sd">            </span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            True if the element_type have to be removed from the structural element type dictionary. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_structural_element_type_by_element</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">element_type</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_element_type_to_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">element_type</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_element_type_to_lines</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">element_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">temp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_element_type_to_lines</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">list_lines</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">element_type</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_element_type_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_element_type_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_element_type_to_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">list_lines</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">element_type</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_element_type_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">line</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_element_type_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_element_type_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_element_type_to_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="Preprocessor.set_acoustic_element_type_by_lines"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_acoustic_element_type_by_lines">[docs]</a>    <span class="k">def</span> <span class="nf">set_acoustic_element_type_by_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">element_type</span><span class="p">,</span> <span class="n">proportional_damping</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vol_flow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes acoustic element type to all elements that belongs to a line/entity.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        line : list</span>
<span class="sd">            Entities tag.</span>
<span class="sd">            </span>
<span class="sd">        element_type : str, [&#39;undamped&#39;, &#39;proportional&#39;, &#39;wide-duct&#39;, &#39;LRF fluid equivalent&#39;, &#39;LRF full&#39;]</span>
<span class="sd">            Acoustic element type to be attributed to the listed elements.</span>
<span class="sd">            </span>
<span class="sd">        proportional_damping : float, optional</span>
<span class="sd">            Acoustic proportional damping coefficient. It must be attributed to the elements of type &#39;proportional&#39;.</span>
<span class="sd">            Default is None.</span>
<span class="sd">            </span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            True if the element_type have to be removed from the acoustic element type dictionary. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_acoustic_element_type_by_element</span><span class="p">(</span>  <span class="n">elements</span><span class="p">,</span> <span class="n">element_type</span><span class="p">,</span> 
                                                        <span class="n">proportional_damping</span> <span class="o">=</span> <span class="n">proportional_damping</span><span class="p">,</span> 
                                                        <span class="n">vol_flow</span> <span class="o">=</span> <span class="n">vol_flow</span>  <span class="p">)</span>
        
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_acoustic_element_type_to_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">element_type</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_acoustic_element_type_to_lines</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">element_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">temp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dict_acoustic_element_type_to_lines</span><span class="p">[</span><span class="n">element_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">list_lines</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">element_type</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dict_acoustic_element_type_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_acoustic_element_type_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dict_acoustic_element_type_to_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">list_lines</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">element_type</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dict_acoustic_element_type_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">line</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dict_acoustic_element_type_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_acoustic_element_type_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dict_acoustic_element_type_to_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>

    <span class="c1"># Structural physical quantities</span>
<div class="viewcode-block" id="Preprocessor.set_material_by_element"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_material_by_element">[docs]</a>    <span class="k">def</span> <span class="nf">set_material_by_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">material</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes material object to a list of acoustic and structural elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elements : list</span>
<span class="sd">            Acoustic and structural elements indexes.</span>
<span class="sd">            </span>
<span class="sd">        material : Material object</span>
<span class="sd">            Material data.</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">material</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">material</span></div>

<div class="viewcode-block" id="Preprocessor.set_material_by_lines"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_material_by_lines">[docs]</a>    <span class="k">def</span> <span class="nf">set_material_by_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">material</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes material object to all elements that belongs to a line/entity.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        line : list</span>
<span class="sd">            Entities tag.</span>
<span class="sd">            </span>
<span class="sd">        material : Material object</span>
<span class="sd">            Material data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_material_by_element</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">set_force_by_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">loads</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">loaded_forces</span> <span class="o">=</span> <span class="n">loads</span>
    
<div class="viewcode-block" id="Preprocessor.set_structural_load_bc_by_node"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_structural_load_bc_by_node">[docs]</a>    <span class="k">def</span> <span class="nf">set_structural_load_bc_by_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes_id</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes structural force and moment loads to a list of nodes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes_id : list</span>
<span class="sd">            Nodes external indexes.</span>
<span class="sd">            </span>
<span class="sd">        values : complex or array</span>
<span class="sd">            Force and moment loads. Complex valued input corresponds to a constant load with respect to the frequency. Array valued input corresponds to a variable load with respect to the frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">values</span><span class="p">,</span> <span class="n">table_names</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">nodes_id</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">nodal_loads</span> <span class="o">=</span> <span class="n">values</span>
            <span class="n">node</span><span class="o">.</span><span class="n">nodal_loads_table_names</span> <span class="o">=</span> <span class="n">table_names</span>            
            <span class="n">node</span><span class="o">.</span><span class="n">prescribed_dofs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_nodes_to_update_indexes_after_remesh</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="c1"># Checking imported tables </span>
            <span class="n">check_array</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check_array</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">loaded_table_for_nodal_loads</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_nodal_loads</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_nodal_loads</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_nodal_loads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">continue</span>
                <span class="c1"># return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">loaded_table_for_nodal_loads</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># Checking complex single values    </span>
            <span class="n">check_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check_values</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_nodal_loads</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_nodal_loads</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_nodal_loads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_nodal_loads</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_nodal_loads</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_nodal_loads</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>

<div class="viewcode-block" id="Preprocessor.add_mass_to_node"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.add_mass_to_node">[docs]</a>    <span class="k">def</span> <span class="nf">add_mass_to_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes structural lumped mass to a list of nodes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes_id : list</span>
<span class="sd">            Nodes external indexes.</span>
<span class="sd">            </span>
<span class="sd">        values : complex or array</span>
<span class="sd">            Lumped mass. Complex valued input corresponds to a constant mass with respect to the frequency. Array valued input corresponds to a variable mass with respect to the frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">values</span><span class="p">,</span> <span class="n">table_names</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">lumped_masses</span> <span class="o">=</span> <span class="n">values</span>
            <span class="n">node</span><span class="o">.</span><span class="n">lumped_masses_table_names</span> <span class="o">=</span> <span class="n">table_names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_nodes_to_update_indexes_after_remesh</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="c1"># Checking imported tables </span>
            <span class="n">check_array</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check_array</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">loaded_table_for_lumped_masses</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_lumped_masses</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_masses</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_masses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">loaded_table_for_lumped_masses</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># Checking complex single values    </span>
            <span class="n">check_values</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">if</span> <span class="n">bc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">True</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check_values</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_lumped_masses</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_masses</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_masses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_lumped_masses</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_masses</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_masses</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>

<div class="viewcode-block" id="Preprocessor.add_spring_to_node"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.add_spring_to_node">[docs]</a>    <span class="k">def</span> <span class="nf">add_spring_to_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes structural lumped stiffness (spring) to a list of nodes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes_id : list</span>
<span class="sd">            Nodes external indexes.</span>
<span class="sd">            </span>
<span class="sd">        values : complex or array</span>
<span class="sd">            Lumped stiffness. Complex valued input corresponds to a constant stiffness with respect to the frequency. Array valued input corresponds to a variable stiffness with respect to the frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">values</span><span class="p">,</span> <span class="n">table_names</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">lumped_stiffness</span> <span class="o">=</span> <span class="n">values</span>
            <span class="n">node</span><span class="o">.</span><span class="n">lumped_stiffness_table_names</span> <span class="o">=</span> <span class="n">table_names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_nodes_to_update_indexes_after_remesh</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="c1"># Checking imported tables </span>
            <span class="n">check_array</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check_array</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">loaded_table_for_lumped_stiffness</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_lumped_stiffness</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_connected_to_springs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_connected_to_springs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">loaded_table_for_lumped_stiffness</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># Checking complex single values    </span>
            <span class="n">check_values</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">if</span> <span class="n">bc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">True</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check_values</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_lumped_stiffness</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_connected_to_springs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_connected_to_springs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_lumped_stiffness</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_connected_to_springs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_connected_to_springs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Preprocessor.add_damper_to_node"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.add_damper_to_node">[docs]</a>    <span class="k">def</span> <span class="nf">add_damper_to_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes structural lumped damping (damper) to a list of nodes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes_id : list</span>
<span class="sd">            Nodes external indexes.</span>
<span class="sd">            </span>
<span class="sd">        values : complex or array</span>
<span class="sd">            Lumped damping. Complex valued input corresponds to a constant damping with respect to the frequency. Array valued input corresponds to a variable damping with respect to the frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">values</span><span class="p">,</span> <span class="n">table_names</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">lumped_dampings</span> <span class="o">=</span> <span class="n">values</span>
            <span class="n">node</span><span class="o">.</span><span class="n">lumped_dampings_table_names</span> <span class="o">=</span> <span class="n">table_names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_nodes_to_update_indexes_after_remesh</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="c1"># Checking imported tables </span>
            <span class="n">check_array</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check_array</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">loaded_table_for_lumped_dampings</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_lumped_dampings</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_connected_to_dampers</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_connected_to_dampers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">loaded_table_for_lumped_dampings</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># Checking complex single values    </span>
            <span class="n">check_values</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">if</span> <span class="n">bc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">True</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check_values</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_lumped_dampings</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_connected_to_dampers</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_connected_to_dampers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_lumped_dampings</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_connected_to_dampers</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_connected_to_dampers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>

<div class="viewcode-block" id="Preprocessor.set_prescribed_dofs_bc_by_node"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_prescribed_dofs_bc_by_node">[docs]</a>    <span class="k">def</span> <span class="nf">set_prescribed_dofs_bc_by_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes structural displacement and rotation boundary condition to a list of nodes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes_id : list</span>
<span class="sd">            Nodes external indexes.</span>
<span class="sd">            </span>
<span class="sd">        values : complex or array</span>
<span class="sd">            Displacement and rotation. Complex valued input corresponds to a constant boundary condition with respect to the frequency. Array valued input corresponds to a variable boundary condition with respect to the frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">values</span><span class="p">,</span> <span class="n">table_names</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">prescribed_dofs</span> <span class="o">=</span> <span class="n">values</span>
            <span class="n">node</span><span class="o">.</span><span class="n">prescribed_dofs_table_names</span> <span class="o">=</span> <span class="n">table_names</span>
            <span class="n">node</span><span class="o">.</span><span class="n">nodal_loads</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_nodes_to_update_indexes_after_remesh</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="c1"># Checking imported tables </span>
            <span class="n">check_array</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check_array</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">loaded_table_for_prescribed_dofs</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_prescribed_dofs</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_constrained_dofs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_constrained_dofs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_prescribed_dofs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_prescribed_dofs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">continue</span>
                <span class="c1"># return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">loaded_table_for_prescribed_dofs</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># Checking complex single values    </span>
            <span class="n">check_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check_values</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_prescribed_dofs</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">there_are_constrained_dofs</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_constrained_dofs</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_constrained_dofs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_prescribed_dofs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_prescribed_dofs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>              
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_prescribed_dofs</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">node</span><span class="o">.</span><span class="n">there_are_constrained_dofs</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_constrained_dofs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_constrained_dofs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_prescribed_dofs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_prescribed_dofs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> </div>

<div class="viewcode-block" id="Preprocessor.set_B2PX_rotation_decoupling"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_B2PX_rotation_decoupling">[docs]</a>    <span class="k">def</span> <span class="nf">set_B2PX_rotation_decoupling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_ID</span><span class="p">,</span> <span class="n">node_ID</span><span class="p">,</span> <span class="n">rotations_to_decouple</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method .</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        element_ID : list</span>
<span class="sd">            Element indexes.</span>

<span class="sd">        nodes_id : list</span>
<span class="sd">            Nodes external indexes.</span>

<span class="sd">        rotations_to_decouple : list of boolean, optional</span>
<span class="sd">            ?????</span>
<span class="sd">            Default is [False, False, False]</span>
<span class="sd">            </span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            True if the ???????? have to be removed from the ???????? dictionary. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DOFS_PER_ELEMENT</span> <span class="o">=</span> <span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="o">*</span><span class="n">NODES_PER_ELEMENT</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">DOF_PER_NODE_STRUCTURAL</span>
        <span class="n">mat_ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">DOFS_PER_ELEMENT</span><span class="p">,</span><span class="n">DOFS_PER_ELEMENT</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">neighboor_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighboor_elements_of_node</span><span class="p">(</span><span class="n">node_ID</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighboor_elements</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mat_ones</span>
        
        <span class="n">mat_base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>  <span class="p">)</span>
        
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_ID</span><span class="p">]</span>
        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">element_ID</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">rotations_to_decouple</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">remove</span><span class="p">:</span>
            <span class="n">mat_out</span> <span class="o">=</span> <span class="n">mat_ones</span>

        <span class="k">elif</span> <span class="n">rotations_to_decouple</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  
            <span class="n">mat_out</span> <span class="o">=</span> <span class="n">mat_base</span>

        <span class="k">elif</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="p">]:</span>
  
            <span class="n">temp</span> <span class="o">=</span> <span class="n">mat_base</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">mat_base</span><span class="p">[:</span><span class="n">N</span><span class="p">,:</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">mat_base</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">temp</span>

            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rotations_to_decouple</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">ij</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">mat_base</span><span class="p">[:,</span> <span class="p">[</span><span class="n">ij</span><span class="p">,</span> <span class="n">ij</span><span class="o">+</span><span class="n">N</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">DOFS_PER_ELEMENT</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                    <span class="n">mat_base</span><span class="p">[[</span><span class="n">ij</span><span class="p">,</span> <span class="n">ij</span><span class="o">+</span><span class="n">N</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">DOFS_PER_ELEMENT</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> 
            <span class="n">mat_out</span> <span class="o">=</span> <span class="n">mat_base</span>

        <span class="k">elif</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="p">]:</span>
   
            <span class="n">temp</span> <span class="o">=</span> <span class="n">mat_base</span><span class="p">[</span><span class="n">N</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">N</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">mat_base</span><span class="p">[</span><span class="n">N</span><span class="p">:,</span><span class="n">N</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">mat_base</span><span class="p">[</span><span class="n">N</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">N</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">temp</span>

            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rotations_to_decouple</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">ij</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">mat_base</span><span class="p">[:,</span> <span class="p">[</span><span class="n">ij</span><span class="o">-</span><span class="n">N</span><span class="p">,</span> <span class="n">ij</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">DOFS_PER_ELEMENT</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                    <span class="n">mat_base</span><span class="p">[[</span><span class="n">ij</span><span class="o">-</span><span class="n">N</span><span class="p">,</span> <span class="n">ij</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">DOFS_PER_ELEMENT</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> 
            <span class="n">mat_out</span> <span class="o">=</span> <span class="n">mat_base</span>

        <span class="n">section</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">rotations_to_decouple</span><span class="p">)</span>
        <span class="n">element</span><span class="o">.</span><span class="n">decoupling_matrix</span> <span class="o">=</span> <span class="n">mat_out</span>
        <span class="n">element</span><span class="o">.</span><span class="n">decoupling_info</span> <span class="o">=</span> <span class="p">[</span><span class="n">element_ID</span><span class="p">,</span> <span class="n">node_ID</span><span class="p">,</span> <span class="n">rotations_to_decouple</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">element_ID</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_elements_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">section</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_elements_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element_ID</span><span class="p">)</span>  
            <span class="k">if</span> <span class="n">node_ID</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_nodes_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">section</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_nodes_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node_ID</span><span class="p">)</span>
            
            <span class="n">element</span><span class="o">.</span><span class="n">decoupling_info</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">else</span><span class="p">:</span> 
                     
            <span class="k">if</span> <span class="n">section</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_elements_with_B2PX_rotation_decoupling</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_elements_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element_ID</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_nodes_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_ID</span><span class="p">)</span>  

            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">temp_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_elements_with_B2PX_rotation_decoupling</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">temp_list_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_nodes_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">temp_list_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_elements_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  
                
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">str</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">element_ID</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="n">element_ID</span><span class="p">:</span>
                                <span class="n">temp_list_nodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node_ID</span><span class="p">)</span>
                                <span class="n">temp_list_elements</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element_ID</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dict_nodes_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_list_nodes</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dict_elements_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_list_elements</span>

                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">section</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">element_ID</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="n">element_ID</span><span class="p">:</span>
                                <span class="n">temp_list_nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_ID</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dict_nodes_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_list_nodes</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dict_elements_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_list_elements</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dict_elements_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dict_nodes_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_ID</span><span class="p">)</span> 

                <span class="k">elif</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">section</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">element_ID</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="n">element_ID</span><span class="p">:</span>
                                <span class="n">temp_list_nodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node_ID</span><span class="p">)</span>
                                <span class="n">temp_list_elements</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element_ID</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dict_nodes_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_list_nodes</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dict_elements_with_B2PX_rotation_decoupling</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_list_elements</span>
                
        <span class="k">return</span> <span class="n">mat_out</span>  </div>

<div class="viewcode-block" id="Preprocessor.enable_fluid_mass_adding_effect"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.enable_fluid_mass_adding_effect">[docs]</a>    <span class="k">def</span> <span class="nf">enable_fluid_mass_adding_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method enables or disables the addition of fluid mass in the structural element mass.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------            </span>
<span class="sd">        reset : bool, optional</span>
<span class="sd">            True if the fluid mass effect have to be disable. False to enable.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_fluid_mass_effect</span>
        
        <span class="k">if</span> <span class="n">reset</span> <span class="ow">and</span> <span class="n">flag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flag_fluid_mass_effect</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">element</span><span class="o">.</span><span class="n">adding_mass_effect</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">reset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flag_fluid_mass_effect</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">element</span><span class="o">.</span><span class="n">adding_mass_effect</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Preprocessor.set_capped_end_by_elements"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_capped_end_by_elements">[docs]</a>    <span class="k">def</span> <span class="nf">set_capped_end_by_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">selection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method enables or disables the capped end effect in a list of acoustic elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elements : list</span>
<span class="sd">            Acoustic elements indexes.</span>
<span class="sd">            </span>
<span class="sd">        value : bool</span>
<span class="sd">            True if the capped end effect have to be activated. False otherwise.</span>

<span class="sd">        selection : ?????</span>
<span class="sd">            ??????</span>
<span class="sd">        &quot;&quot;&quot;</span>      
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">capped_end</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_with_capped_end</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">element_with_capped_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_with_capped_end</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">element_with_capped_end</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_capped_end</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span> <span class="o">=</span> <span class="n">elements</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">selection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_capped_end</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_capped_end</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span> </div>

    <span class="c1"># def set_capped_end_line_to_element(self, lines, value):</span>
    <span class="c1">#     for elements in slicer(self.line_to_elements, lines):</span>
    <span class="c1">#         for element in slicer(self.structural_elements, elements):</span>
    <span class="c1">#             element.capped_end = value</span>
 
<div class="viewcode-block" id="Preprocessor.set_capped_end_by_lines"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_capped_end_by_lines">[docs]</a>    <span class="k">def</span> <span class="nf">set_capped_end_by_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method enables or disables the capped end effect to all acoustic elements that belongs to a line.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lines : list</span>
<span class="sd">            Lines/entities indexes.</span>
<span class="sd">            </span>
<span class="sd">        value : bool</span>
<span class="sd">            True if the capped end effect have to be activated. False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.set_capped_end_line_to_element(lines, value)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
                <span class="n">element</span><span class="o">.</span><span class="n">capped_end</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">lines</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_capped_end</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_capped_end</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_lines</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_capped_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_capped_end</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_capped_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_capped_end</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_capped_end</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span></div>


<div class="viewcode-block" id="Preprocessor.set_structural_element_wall_formulation_by_lines"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_structural_element_wall_formulation_by_lines">[docs]</a>    <span class="k">def</span> <span class="nf">set_structural_element_wall_formulation_by_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">formulation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method assign a strutural element wall formulation to the selected lines.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lines : list</span>
<span class="sd">            Lines/entities indexes.</span>
<span class="sd">            </span>
<span class="sd">        wall_formulation : str, [&#39;thick_wall&#39;, &#39;thin_wall&#39;]</span>
<span class="sd">            Structural element type to be attributed to the listed elements. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">wall_formulation</span> <span class="o">=</span> <span class="n">formulation</span>
            
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">formulation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">list_lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines_with_structural_element_wall_formulation</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_structural_element_wall_formulation</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_structural_element_wall_formulation</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">formulation</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">_error</span><span class="p">))</span></div>
    <span class="c1"># def set_capped_end_all_lines(self, value):</span>
    <span class="c1">#     self.set_capped_end_line_to_element(&quot;all&quot;, value)</span>
    <span class="c1">#     self.group_elements_with_capped_end = {}</span>
    <span class="c1">#     self.lines_with_capped_end = []</span>
    <span class="c1">#     if value:</span>
    <span class="c1">#         for line in self.all_lines:</span>
    <span class="c1">#             self.lines_with_capped_end.append(line)</span>

<div class="viewcode-block" id="Preprocessor.set_structural_element_force_offset_by_lines"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_structural_element_force_offset_by_lines">[docs]</a>    <span class="k">def</span> <span class="nf">set_structural_element_force_offset_by_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">force_offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method assign a strutural element force offset to the selected lines.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lines : list</span>
<span class="sd">            Lines/entities indexes.</span>
<span class="sd">            </span>
<span class="sd">        force offset : int, [0, 1]</span>
<span class="sd">            Structural element force offset to be attributed to the listed elements. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">force_offset</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">force_offset</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">force_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">list_lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines_with_structural_element_force_offset</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_structural_element_force_offset</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_structural_element_force_offset</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">force_offset</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">_error</span><span class="p">))</span></div>

<div class="viewcode-block" id="Preprocessor.set_stress_stiffening_by_line"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_stress_stiffening_by_line">[docs]</a>    <span class="k">def</span> <span class="nf">set_stress_stiffening_by_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">pressures</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method .</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lines : list</span>
<span class="sd">            Lines/entities indexes.</span>

<span class="sd">        parameters : list</span>
<span class="sd">            ????????.</span>
<span class="sd">            </span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            True if the ???????? have to be removed from the ???????? dictionary. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_stress_stiffening_by_elements</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">pressures</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lines</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_stress_stiffening</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_stress_stiffening</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">remove</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_lines</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_stress_stiffening</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_with_stress_stiffening</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">pressures</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_stress_stiffening</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_stress_stiffening</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_with_stress_stiffening</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>               
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_stress_stiffening</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lines_with_stress_stiffening</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_with_stress_stiffening</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">pressures</span></div>

<div class="viewcode-block" id="Preprocessor.set_stress_stiffening_by_elements"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_stress_stiffening_by_elements">[docs]</a>    <span class="k">def</span> <span class="nf">set_stress_stiffening_by_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">pressures</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method .</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lines : list</span>
<span class="sd">            Elements indexes.</span>

<span class="sd">        parameters : list</span>
<span class="sd">            ????????.</span>

<span class="sd">        section : ?????</span>
<span class="sd">            ??????</span>
<span class="sd">            Default is None</span>
<span class="sd">            </span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            True if the ???????? have to be removed from the ???????? dictionary. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stress_stiffening_enabled</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">external_pressure</span> <span class="o">=</span> <span class="n">pressures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">element</span><span class="o">.</span><span class="n">internal_pressure</span> <span class="o">=</span> <span class="n">pressures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">section</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">section</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_stress_stiffening</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_stress_stiffening</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">section</span><span class="p">)</span> 
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_stress_stiffening</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pressures</span><span class="p">,</span> <span class="n">elements</span><span class="p">]</span></div>


<div class="viewcode-block" id="Preprocessor.add_expansion_joint_by_elements"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.add_expansion_joint_by_elements">[docs]</a>    <span class="k">def</span> <span class="nf">add_expansion_joint_by_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                        <span class="n">list_elements</span><span class="p">,</span> 
                                        <span class="n">parameters</span><span class="p">,</span> 
                                        <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                        <span class="n">aux_line_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                        <span class="n">reset_cross</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method .</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lines : list</span>
<span class="sd">            Elements indexes.</span>

<span class="sd">        parameters : list</span>
<span class="sd">            ????????.</span>

<span class="sd">        section : ?????</span>
<span class="sd">            ??????</span>
<span class="sd">            Default is None</span>
<span class="sd">            </span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            True if the ???????? have to be removed from the ???????? dictionary. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">aux_line_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="n">elements_from_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">[</span><span class="n">aux_line_id</span><span class="p">]</span>
            <span class="n">temp_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_expansion_joints</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="p">[</span><span class="n">_list_elements_ids</span><span class="p">,</span> <span class="n">_</span><span class="p">]</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">element_id</span> <span class="ow">in</span> <span class="n">_list_elements_ids</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">element_id</span> <span class="ow">in</span> <span class="n">elements_from_line</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_expansion_joints</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                        <span class="k">break</span>

        <span class="n">list_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element_id</span> <span class="ow">in</span> <span class="n">list_elements</span><span class="p">:</span>
            <span class="n">line_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_to_line</span><span class="p">[</span><span class="n">element_id</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">line_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                <span class="n">list_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">list_elements</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expansion_joint_table_indexes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">expansion_joint_table_indexes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">line_id</span><span class="p">)</span>
                <span class="c1"># if element.joint_stiffness_table_names != []:</span>
                <span class="c1">#     first_table_name = element.joint_stiffness_table_names[0]</span>
                <span class="c1">#     for ext in [&quot;.csv&quot;, &quot;.dat&quot;, &quot;.txt&quot;]:</span>
                <span class="c1">#         if ext in first_table_name:</span>
                <span class="c1">#             first_table_name = first_table_name.split(ext)[0]</span>
                <span class="c1">#             break</span>
                <span class="c1">#     table_index = int(first_table_name.split(&quot;_table#&quot;)[1])</span>
                <span class="c1">#     if table_index in self.expansion_joint_table_indexes.keys(): </span>
                <span class="c1">#         self.expansion_joint_table_indexes.pop(table_index)</span>
                <span class="n">element</span><span class="o">.</span><span class="n">reset_expansion_joint_parameters</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">reset_cross</span><span class="p">:</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_expansion_joint</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_expansion_joint</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_expansion_joints_by_lines</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">number_expansion_joints_by_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">line_id</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_expansion_joints_by_lines</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">number_expansion_joints_by_lines</span><span class="p">[</span><span class="n">line_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">number_expansion_joints_by_lines</span><span class="p">[</span><span class="n">line_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="p">[</span><span class="n">joint_length</span><span class="p">,</span> <span class="n">effective_diameter</span><span class="p">,</span> <span class="n">joint_mass</span><span class="p">,</span> <span class="n">axial_locking_criteria</span><span class="p">,</span> <span class="n">rods_included</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">[</span><span class="n">axial_stiffness</span><span class="p">,</span> <span class="n">transversal_stiffness</span><span class="p">,</span> <span class="n">torsional_stiffness</span><span class="p">,</span> <span class="n">angular_stiffness</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">list_stiffness_table_names</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
           
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">list_elements</span><span class="p">):</span>
                <span class="n">element</span><span class="o">.</span><span class="n">joint_length</span> <span class="o">=</span> <span class="n">joint_length</span>
                <span class="n">element</span><span class="o">.</span><span class="n">joint_effective_diameter</span> <span class="o">=</span> <span class="n">effective_diameter</span>
                <span class="n">element</span><span class="o">.</span><span class="n">joint_mass</span> <span class="o">=</span> <span class="n">joint_mass</span>
                <span class="n">element</span><span class="o">.</span><span class="n">joint_axial_locking_criteria</span> <span class="o">=</span> <span class="n">axial_locking_criteria</span>
                <span class="n">element</span><span class="o">.</span><span class="n">joint_rods_included</span> <span class="o">=</span> <span class="n">rods_included</span>
                <span class="n">element</span><span class="o">.</span><span class="n">joint_axial_stiffness</span> <span class="o">=</span> <span class="n">axial_stiffness</span>
                <span class="n">element</span><span class="o">.</span><span class="n">joint_transversal_stiffness</span> <span class="o">=</span> <span class="n">transversal_stiffness</span>
                <span class="n">element</span><span class="o">.</span><span class="n">joint_torsional_stiffness</span> <span class="o">=</span> <span class="n">torsional_stiffness</span>
                <span class="n">element</span><span class="o">.</span><span class="n">joint_angular_stiffness</span> <span class="o">=</span> <span class="n">angular_stiffness</span>
                <span class="n">element</span><span class="o">.</span><span class="n">joint_stiffness_table_names</span> <span class="o">=</span> <span class="n">list_stiffness_table_names</span>
                <span class="n">element</span><span class="o">.</span><span class="n">expansion_joint_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
                <span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_expansion_joint</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_expansion_joint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">list_stiffness_table_names</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">first_table_name</span> <span class="o">=</span> <span class="n">list_stiffness_table_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;.txt&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">first_table_name</span><span class="p">:</span>
                        <span class="n">first_table_name</span> <span class="o">=</span> <span class="n">first_table_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ext</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">break</span>
                <span class="n">table_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">first_table_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_table#&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">stiffness_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;axial stiffness&quot;</span><span class="p">,</span> <span class="s2">&quot;transversal_stiffness&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;torsional stiffness&quot;</span><span class="p">,</span> <span class="s2">&quot;angular stiffness&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">table_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expansion_joint_table_indexes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">expansion_joint_table_indexes</span><span class="p">[</span><span class="n">table_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">stiffness_labels</span>
        
            <span class="k">if</span> <span class="n">aux_line_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_expansion_joints</span><span class="p">)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;group-</span><span class="si">{</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_expansion_joints</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">list_elements</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span></div>

<div class="viewcode-block" id="Preprocessor.add_expansion_joint_by_line"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.add_expansion_joint_by_line">[docs]</a>    <span class="k">def</span> <span class="nf">add_expansion_joint_by_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method .</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lines : list</span>
<span class="sd">            Lines/entities indexes.</span>

<span class="sd">        parameters : list</span>
<span class="sd">            ????????.</span>
<span class="sd">            </span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            True if the ???????? have to be removed from the ???????? dictionary. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="p">]</span> 
        <span class="k">for</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">,</span> <span class="n">line_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_expansion_joint_by_elements</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="n">remove</span><span class="p">,</span> <span class="n">aux_line_id</span><span class="o">=</span><span class="n">line_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_with_expansion_joints</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_with_expansion_joints</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">line_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_expansion_joints_by_lines</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">number_expansion_joints_by_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">line_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_with_expansion_joints</span><span class="p">[</span><span class="n">line_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number_expansion_joints_by_lines</span><span class="p">[</span><span class="n">line_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Preprocessor.add_valve_by_elements"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.add_valve_by_elements">[docs]</a>    <span class="k">def</span> <span class="nf">add_valve_by_elements</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">list_elements</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">aux_line_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reset_cross</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method .</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lines : list</span>
<span class="sd">            Elements indexes.</span>

<span class="sd">        parameters : list</span>
<span class="sd">            ????????.</span>

<span class="sd">        section : ?????</span>
<span class="sd">            ??????</span>
<span class="sd">            Default is None</span>
<span class="sd">            </span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            True if the ???????? have to be removed from the ???????? dictionary. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if aux_line_id is not None:</span>
        <span class="c1">#     elements_from_line = self.line_to_elements[aux_line_id]</span>
        <span class="c1">#     temp_dict = self.group_elements_with_valves.copy()</span>
        <span class="c1">#     for key, [_list_elements_ids, _] in temp_dict.items():</span>
        <span class="c1">#         for element_id in _list_elements_ids:</span>
        <span class="c1">#             if element_id in elements_from_line:</span>
        <span class="c1">#                 self.group_elements_with_valves.pop(key)</span>
        <span class="c1">#                 break</span>

        <span class="n">list_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element_id</span> <span class="ow">in</span> <span class="n">list_elements</span><span class="p">:</span>
            <span class="n">line_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_to_line</span><span class="p">[</span><span class="n">element_id</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">line_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                <span class="n">list_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">list_elements</span><span class="p">):</span>
                <span class="n">element</span><span class="o">.</span><span class="n">reset_valve_parameters</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">reset_cross</span><span class="p">:</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_valve</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_valve</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_valves_by_lines</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">number_valves_by_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">line_id</span><span class="p">)</span>
            
            <span class="n">temp_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_valves</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="p">[</span><span class="n">_list_elements_ids</span><span class="p">,</span> <span class="n">_</span><span class="p">]</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">element_id</span> <span class="ow">in</span> <span class="n">_list_elements_ids</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">element_id</span> <span class="ow">in</span> <span class="n">list_elements</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_valves</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                        <span class="k">break</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="n">list_lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_valves_by_lines</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">number_valves_by_lines</span><span class="p">[</span><span class="n">line_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">number_valves_by_lines</span><span class="p">[</span><span class="n">line_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">list_elements</span><span class="p">):</span>
                <span class="n">element</span><span class="o">.</span><span class="n">valve_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
                <span class="n">element</span><span class="o">.</span><span class="n">valve_elements</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;valve_elements&quot;</span><span class="p">]</span>
                <span class="n">element</span><span class="o">.</span><span class="n">valve_section_parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;valve_section_parameters&quot;</span><span class="p">]</span>
                <span class="n">element</span><span class="o">.</span><span class="n">valve_length</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;valve_length&quot;</span><span class="p">]</span>
                <span class="n">element</span><span class="o">.</span><span class="n">valve_stiffening_factor</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;stiffening_factor&quot;</span><span class="p">]</span>
                <span class="n">element</span><span class="o">.</span><span class="n">valve_mass</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;valve_mass&quot;</span><span class="p">]</span>
                <span class="n">element</span><span class="o">.</span><span class="n">valve_center_coordinates</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;valve_center_coordinates&quot;</span><span class="p">]</span>
                <span class="n">element</span><span class="o">.</span><span class="n">valve_diameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;valve_diameters&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="s2">&quot;flange_section_parameters&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">flange_parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;flange_section_parameters&quot;</span><span class="p">]</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">number_flange_elements</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;number_flange_elements&quot;</span><span class="p">]</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">flange_elements</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;flange_elements&quot;</span><span class="p">]</span>
                    
                <span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_valve</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_valve</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        
            <span class="k">if</span> <span class="n">aux_line_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_valves</span><span class="p">)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;group-</span><span class="si">{</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_valves</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">list_elements</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span></div>
            
<div class="viewcode-block" id="Preprocessor.add_valve_by_line"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.add_valve_by_line">[docs]</a>    <span class="k">def</span> <span class="nf">add_valve_by_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reset_cross</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method .</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lines : list</span>
<span class="sd">            Lines/entities indexes.</span>

<span class="sd">        parameters : list</span>
<span class="sd">            ????????.</span>
<span class="sd">            </span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            True if the ???????? have to be removed from the ???????? dictionary. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="p">]</span> 
        <span class="k">for</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">,</span> <span class="n">line_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_valve_by_elements</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="n">remove</span><span class="p">,</span> <span class="n">aux_line_id</span><span class="o">=</span><span class="n">line_id</span><span class="p">,</span> <span class="n">reset_cross</span><span class="o">=</span><span class="n">reset_cross</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_with_valves</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_with_valves</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">line_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_valves_by_lines</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">number_valves_by_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">line_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_with_valves</span><span class="p">[</span><span class="n">line_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number_valves_by_lines</span><span class="p">[</span><span class="n">line_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>      </div>

<div class="viewcode-block" id="Preprocessor.set_stress_intensification_by_element"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_stress_intensification_by_element">[docs]</a>    <span class="k">def</span> <span class="nf">set_stress_intensification_by_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method enables or disables the stress intensification effect in a list of structural elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elements : list</span>
<span class="sd">            Elements indexes.</span>
<span class="sd">            </span>
<span class="sd">        value : bool</span>
<span class="sd">            True if the stress intensification effect have to be activated. False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>  
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">stress_intensification</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Preprocessor.set_stress_intensification_by_line"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_stress_intensification_by_line">[docs]</a>    <span class="k">def</span> <span class="nf">set_stress_intensification_by_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method enables or disables the stress intensification effect to all structural elements that belongs to a line.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lines : list</span>
<span class="sd">            Lines/entities indexes.</span>
<span class="sd">            </span>
<span class="sd">        value : bool</span>
<span class="sd">            True if the stress intensification effect have to be activated. False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_stress_intensification_by_element</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>
            
    <span class="c1"># Acoustic physical quantities</span>
<div class="viewcode-block" id="Preprocessor.set_fluid_by_element"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_fluid_by_element">[docs]</a>    <span class="k">def</span> <span class="nf">set_fluid_by_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">fluid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes fluid object to a list of acoustic elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elements : list</span>
<span class="sd">            Acoustic elements indexes.</span>
<span class="sd">            </span>
<span class="sd">        fluid : Fluid object</span>
<span class="sd">            Fluid data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;beam_1&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">element_type</span><span class="p">:</span>
                <span class="n">element</span><span class="o">.</span><span class="n">fluid</span> <span class="o">=</span> <span class="n">fluid</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">element</span><span class="o">.</span><span class="n">fluid</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;beam_1&#39;</span><span class="p">]:</span>
                <span class="n">element</span><span class="o">.</span><span class="n">fluid</span> <span class="o">=</span> <span class="n">fluid</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">element</span><span class="o">.</span><span class="n">fluid</span> <span class="o">=</span> <span class="kc">None</span></div>
    
<div class="viewcode-block" id="Preprocessor.set_fluid_by_lines"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_fluid_by_lines">[docs]</a>    <span class="k">def</span> <span class="nf">set_fluid_by_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">fluid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes fluid object to all acoustic elements that belongs to a line/entity.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        line/entity : list</span>
<span class="sd">            Lines/entities tags.</span>
<span class="sd">            </span>
<span class="sd">        fluid : Fluid object</span>
<span class="sd">            Fluid data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_fluid_by_element</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">fluid</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="Preprocessor.set_length_correction_by_element"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_length_correction_by_element">[docs]</a>    <span class="k">def</span> <span class="nf">set_length_correction_by_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">delete_from_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method enables or disables the acoustic length correction effect in a list of acoustic elements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elements : list</span>
<span class="sd">            Acoustic elements indexes.</span>
<span class="sd">            </span>
<span class="sd">        value : [None, 0, 1, 2]</span>
<span class="sd">            Acoustic length correction due to acoustic discontinuities. The prescription is done through the following labeling:</span>
<span class="sd">            None: disable</span>
<span class="sd">            0 : expansion</span>
<span class="sd">            1 : side_branch</span>
<span class="sd">            2 : loop </span>

<span class="sd">        section : ?????</span>
<span class="sd">            ??????</span>
<span class="sd">            </span>
<span class="sd">        remove : bool, optional</span>
<span class="sd">            True if the ???????? have to be removed from the ???????? dictionary. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">acoustic_length_correction</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_with_length_correction</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">element_with_length_correction</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_with_length_correction</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">element_with_length_correction</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delete_from_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_length_correction</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">section</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_length_correction</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">,</span> <span class="n">elements</span><span class="p">]</span></div>
            
<div class="viewcode-block" id="Preprocessor.set_acoustic_pressure_bc_by_node"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_acoustic_pressure_bc_by_node">[docs]</a>    <span class="k">def</span> <span class="nf">set_acoustic_pressure_bc_by_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes acoustic pressure boundary condition to a list of nodes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes : list</span>
<span class="sd">            Nodes external indexes.</span>
<span class="sd">            </span>
<span class="sd">        values : complex or array</span>
<span class="sd">            Acoustic pressure. Complex valued input corresponds to a constant pressure boundary condition with respect to the frequency. Array valued input corresponds to a variable pressure boundary condition with respect to the frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="p">[</span><span class="n">value</span><span class="p">,</span> <span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">acoustic_pressure</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">node</span><span class="o">.</span><span class="n">acoustic_pressure_table_name</span> <span class="o">=</span> <span class="n">table_name</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_acoustic_pressure</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_acoustic_pressure</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_acoustic_pressure</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_acoustic_pressure</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                
                <span class="n">node</span><span class="o">.</span><span class="n">volume_velocity</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">node</span><span class="o">.</span><span class="n">volume_velocity_table</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_volume_velocity</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_volume_velocity</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="n">node</span><span class="o">.</span><span class="n">compressor_excitation_table_names</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">node</span><span class="o">.</span><span class="n">dict_index_to_compressor_connection_info</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_compressor_excitation</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_compressor_excitation</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">process_nodes_to_update_indexes_after_remesh</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
                
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">log_error</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Error while setting acoustic pressure&quot;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">log_error</span><span class="p">)</span>
            <span class="n">PrintMessageInput</span><span class="p">([</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">window_title_1</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">True</span>  </div>


<div class="viewcode-block" id="Preprocessor.set_volume_velocity_bc_by_node"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_volume_velocity_bc_by_node">[docs]</a>    <span class="k">def</span> <span class="nf">set_volume_velocity_bc_by_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes acoustic volume velocity load to a list of nodes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes : list</span>
<span class="sd">            Nodes external indexes.</span>
<span class="sd">            </span>
<span class="sd">        values : complex or array</span>
<span class="sd">            Volume velocity. Complex valued input corresponds to a constant volume velocity load with respect to the frequency. Array valued input corresponds to a variable volume velocity load with respect to the frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="p">[</span><span class="n">values</span><span class="p">,</span> <span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">volume_velocity</span> <span class="o">=</span> <span class="n">values</span>
                <span class="n">node</span><span class="o">.</span><span class="n">volume_velocity_table_name</span> <span class="o">=</span> <span class="n">table_name</span>

                <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_volume_velocity</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_volume_velocity</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_volume_velocity</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_volume_velocity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

                <span class="n">node</span><span class="o">.</span><span class="n">compressor_excitation_table_names</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">node</span><span class="o">.</span><span class="n">compressor_excitation_table_indexes</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">node</span><span class="o">.</span><span class="n">dict_index_to_compressor_connection_info</span> <span class="o">=</span> <span class="p">{}</span>
                
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_compressor_excitation</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_compressor_excitation</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

                <span class="n">node</span><span class="o">.</span><span class="n">acoustic_pressure</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">node</span><span class="o">.</span><span class="n">acoustic_pressure_table_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_acoustic_pressure</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_acoustic_pressure</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">process_nodes_to_update_indexes_after_remesh</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Error while setting volume velocity&quot;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="n">PrintMessageInput</span><span class="p">([</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">window_title_1</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">True</span>  </div>

    <span class="k">def</span> <span class="nf">set_vol_flow_by_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">vol_flow</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;beam_1&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">element_type</span><span class="p">:</span>
                <span class="n">element</span><span class="o">.</span><span class="n">vol_flow</span> <span class="o">=</span> <span class="n">vol_flow</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">element</span><span class="o">.</span><span class="n">vol_flow</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">set_vol_flow_by_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">vol_flow</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_vol_flow_by_element</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">vol_flow</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_perforated_plate_by_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">perforated_plate</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">delete_from_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">perforated_plate</span> <span class="o">=</span> <span class="n">perforated_plate</span>
            <span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_perforated_plate</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_perforated_plate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">perforated_plate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_perforated_plate</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_perforated_plate</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                    
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">perforated_plate</span> <span class="o">=</span> <span class="n">perforated_plate</span>
            <span class="n">element</span><span class="o">.</span><span class="n">delta_pressure</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">element</span><span class="o">.</span><span class="n">pp_impedance</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">delete_from_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_perforated_plate</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">section</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_elements_with_perforated_plate</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">perforated_plate</span><span class="p">,</span> <span class="n">elements</span><span class="p">]</span>

<div class="viewcode-block" id="Preprocessor.set_compressor_excitation_bc_by_node"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_compressor_excitation_bc_by_node">[docs]</a>    <span class="k">def</span> <span class="nf">set_compressor_excitation_bc_by_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">connection_info</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes compressor excitation in the form of volume velocity source to a list of nodes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes : list</span>
<span class="sd">            Nodes external indexes.</span>
<span class="sd">            </span>
<span class="sd">        values : complex or array</span>
<span class="sd">            Volume velocity. Array valued input corresponds to a variable volume velocity load with respect to the frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="p">[</span><span class="n">values</span><span class="p">,</span> <span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

            <span class="k">if</span> <span class="n">table_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_node&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">str_table_index</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">table_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">str_table_index</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">volume_velocity</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">volume_velocity_table_name</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">compressor_excitation_table_names</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">dict_index_to_compressor_connection_info</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">compressor_excitation_table_indexes</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_compressor_excitation</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_compressor_excitation</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                
                <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">volume_velocity</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">volume_velocity</span><span class="p">,</span> <span class="nb">complex</span><span class="p">):</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">volume_velocity</span> <span class="o">=</span> <span class="n">values</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">compressor_excitation_table_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">table_name</span><span class="p">]</span>  
                    <span class="n">node</span><span class="o">.</span><span class="n">dict_index_to_compressor_connection_info</span><span class="p">[</span><span class="n">table_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection_info</span>                   

                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">volume_velocity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>                        
                    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">volume_velocity_table_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">volume_velocity_table_name</span> <span class="o">=</span> <span class="kc">None</span> 
                        <span class="n">node</span><span class="o">.</span><span class="n">volume_velocity</span> <span class="o">=</span> <span class="n">values</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">compressor_excitation_table_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">table_name</span><span class="p">]</span> 
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">volume_velocity</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                            <span class="n">node</span><span class="o">.</span><span class="n">volume_velocity</span> <span class="o">+=</span> <span class="n">values</span> 
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Error while setting compressor excitation&quot;</span>
                            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;The arrays lengths mismatch. It is recommended to check the frequency setup before continue.&quot;</span>
                            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Actual array length: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">volume_velocity</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;New array length: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                            <span class="n">PrintMessageInput</span><span class="p">([</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">window_title_1</span><span class="p">])</span>
                            <span class="k">return</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                    <span class="n">node</span><span class="o">.</span><span class="n">dict_index_to_compressor_connection_info</span><span class="p">[</span><span class="n">table_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection_info</span>
                    <span class="k">if</span> <span class="n">table_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">compressor_excitation_table_indexes</span><span class="p">:</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">compressor_excitation_table_indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">table_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">compressor_excitation_table_names</span><span class="p">:</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">compressor_excitation_table_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_compressor_excitation</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_compressor_excitation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>   
                                     
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_volume_velocity</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_volume_velocity</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                
                <span class="n">node</span><span class="o">.</span><span class="n">acoustic_pressure</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">node</span><span class="o">.</span><span class="n">acoustic_pressure_table_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_acoustic_pressure</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_acoustic_pressure</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_nodes_to_update_indexes_after_remesh</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Error while setting compressor excitation&quot;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="n">PrintMessageInput</span><span class="p">([</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">window_title_1</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">True</span>  </div>

<div class="viewcode-block" id="Preprocessor.set_specific_impedance_bc_by_node"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_specific_impedance_bc_by_node">[docs]</a>    <span class="k">def</span> <span class="nf">set_specific_impedance_bc_by_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes acoustic lumped specific impedance to a list of nodes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes : list</span>
<span class="sd">            Nodes external indexes.</span>
<span class="sd">            </span>
<span class="sd">        values : complex or array, None</span>
<span class="sd">            Specific impedance. Complex valued input corresponds to a constant specific impedance with respect to the frequency. Array valued input corresponds to a variable specific impedance with respect to the frequency.</span>

<span class="sd">            If None is attributed, then no specific impedance is considered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="p">[</span><span class="n">values</span><span class="p">,</span> <span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">specific_impedance</span> <span class="o">=</span> <span class="n">values</span>
                <span class="n">node</span><span class="o">.</span><span class="n">specific_impedance_table_name</span> <span class="o">=</span> <span class="n">table_name</span>
                <span class="n">node</span><span class="o">.</span><span class="n">radiation_impedance</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">node</span><span class="o">.</span><span class="n">radiation_impedance_type</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_specific_impedance</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_specific_impedance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_specific_impedance</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_specific_impedance</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_radiation_impedance</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_radiation_impedance</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">process_nodes_to_update_indexes_after_remesh</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> 
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Error while setting specific impedance&quot;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="n">PrintMessageInput</span><span class="p">([</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">window_title_1</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">True</span>  </div>


<div class="viewcode-block" id="Preprocessor.set_radiation_impedance_bc_by_node"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.set_radiation_impedance_bc_by_node">[docs]</a>    <span class="k">def</span> <span class="nf">set_radiation_impedance_bc_by_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">impedance_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method attributes acoustic lumped radiation impedance to a list of nodes according to the anechoic, flanged, and unflanged prescription.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes : list</span>
<span class="sd">            Nodes external indexes.</span>
<span class="sd">            </span>
<span class="sd">        impedance_type : [None, 0, 1, 2]</span>
<span class="sd">            Acoustic length correction due to acoustic discontinuities. The prescription is done through the following labeling:</span>
<span class="sd">            0 : anechoic termination</span>
<span class="sd">            1 : unflanged pipe</span>
<span class="sd">            2 : flanged pipe</span>

<span class="sd">            If None is attributed, then no radiation impedance is considered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">radiation_impedance_type</span> <span class="o">=</span> <span class="n">impedance_type</span>
                <span class="n">node</span><span class="o">.</span><span class="n">specific_impedance</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_radiation_impedance</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_radiation_impedance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">impedance_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_radiation_impedance</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_radiation_impedance</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_specific_impedance</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_specific_impedance</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">process_nodes_to_update_indexes_after_remesh</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">log_error</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Error while setting radiation impedance&quot;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">log_error</span><span class="p">)</span>
            <span class="n">PrintMessageInput</span><span class="p">([</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">window_title_1</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">True</span>  </div>

<div class="viewcode-block" id="Preprocessor.get_radius"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_radius">[docs]</a>    <span class="k">def</span> <span class="nf">get_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method updates and returns the ????.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dictionary</span>
<span class="sd">            Radius at certain node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">first</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">global_index</span>
            <span class="n">last</span>  <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">global_index</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">external_radius</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="n">first</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="n">first</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="n">first</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="n">last</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="n">last</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="n">last</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span></div>


<div class="viewcode-block" id="Preprocessor.get_pipe_and_expansion_joint_elements_global_dofs"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_pipe_and_expansion_joint_elements_global_dofs">[docs]</a>    <span class="k">def</span> <span class="nf">get_pipe_and_expansion_joint_elements_global_dofs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the acoustic global degrees of freedom of the nodes associated to structural beam elements. </span>
<span class="sd">        This method helps to exclude those degrees of freedom from acoustic analysis.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Acoustic global degrees of freedom associated to beam element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># list_pipe_gdofs = []  </span>
        <span class="n">pipe_gdofs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pipe_1&#39;</span><span class="p">,</span> <span class="s1">&#39;pipe_2&#39;</span><span class="p">,</span> <span class="s1">&#39;expansion_joint&#39;</span><span class="p">,</span> <span class="s1">&#39;valve&#39;</span><span class="p">]:</span>
                <span class="n">gdofs_node_first</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">global_index</span>
                <span class="n">gdofs_node_last</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">global_index</span>
                <span class="n">pipe_gdofs</span><span class="p">[</span><span class="n">gdofs_node_first</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdofs_node_first</span> 
                <span class="n">pipe_gdofs</span><span class="p">[</span><span class="n">gdofs_node_last</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdofs_node_last</span> 
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">pipe_gdofs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


<div class="viewcode-block" id="Preprocessor.get_beam_and_non_beam_elements_global_dofs"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_beam_and_non_beam_elements_global_dofs">[docs]</a>    <span class="k">def</span> <span class="nf">get_beam_and_non_beam_elements_global_dofs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the acoustic global degrees of freedom of the nodes associated to structural pipe elements. This method helps to keep only those degrees of freedom in acoustic analysis.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Acoustic global degrees of freedom associated to pipe element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipe_and_expansion_joint_gdofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pipe_and_expansion_joint_elements_global_dofs</span><span class="p">()</span>
        <span class="n">total_dof</span> <span class="o">=</span> <span class="n">DOF_PER_NODE_ACOUSTIC</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">all_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">total_dof</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beam_gdofs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">all_indexes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_and_expansion_joint_gdofs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_gdofs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_and_expansion_joint_gdofs</span></div>

    
<div class="viewcode-block" id="Preprocessor._process_beam_nodes_and_indexes"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor._process_beam_nodes_and_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">_process_beam_nodes_and_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method ?????.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            ?????</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beam_gdofs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_gdofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_beam_and_non_beam_elements_global_dofs</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beam_gdofs</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_nodes</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>
    
<div class="viewcode-block" id="Preprocessor.get_acoustic_elements"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_acoustic_elements">[docs]</a>    <span class="k">def</span> <span class="nf">get_acoustic_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns a list of acoustic elements.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Acoustic elements list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">acoustic_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_structural_to_acoustic_elements</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;beam_1&#39;</span><span class="p">]:</span>
                <span class="n">acoustic_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_structural_to_acoustic_elements</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>
                <span class="n">acoustic_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acoustic_element</span><span class="p">)</span>
                <span class="c1"># if element.element_type == &quot;valve&quot;:</span>
                <span class="c1">#     print(element.element_type, element.index)</span>
        <span class="k">return</span> <span class="n">acoustic_elements</span>   </div>
    
<div class="viewcode-block" id="Preprocessor.get_nodes_relative_to_acoustic_elements"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_nodes_relative_to_acoustic_elements">[docs]</a>    <span class="k">def</span> <span class="nf">get_nodes_relative_to_acoustic_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns a dictionary that maps the acoustic node indexes to the acoustic elements.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Dictionary of nodes relative to the acoustic elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">acoustic_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acoustic_elements</span><span class="p">()</span>
        <span class="n">acoustic_nodes</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">acoustic_elements</span><span class="p">:</span>
            <span class="n">first_node</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">external_index</span>
            <span class="n">last_node</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">external_index</span>
            <span class="n">acoustic_nodes</span><span class="p">[</span><span class="n">first_node</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span>
            <span class="n">acoustic_nodes</span><span class="p">[</span><span class="n">last_node</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span>

        <span class="k">return</span> <span class="n">acoustic_nodes</span>  </div>

<div class="viewcode-block" id="Preprocessor.get_beam_elements"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_beam_elements">[docs]</a>    <span class="k">def</span> <span class="nf">get_beam_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns a list of structural beam elements objects.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Beam elements objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;beam_1&#39;</span><span class="p">]:</span>
                <span class="n">list_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">list_elements</span></div>

<div class="viewcode-block" id="Preprocessor.add_compressor_excitation"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.add_compressor_excitation">[docs]</a>    <span class="k">def</span> <span class="nf">add_compressor_excitation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method ???????</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ??????</span>
<span class="sd">            ???????</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;cylinder label&#39;</span><span class="p">:</span>
                <span class="n">list_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;cylinder label&#39;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">CompressorModel</span><span class="p">(</span><span class="n">list_parameters</span><span class="p">,</span> <span class="n">active_cyl</span><span class="o">=</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;cylinder label&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CompressorModel</span><span class="p">(</span><span class="n">list_parameters</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="Preprocessor.get_gdofs_from_nodes"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_gdofs_from_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">get_gdofs_from_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeID_1</span><span class="p">,</span> <span class="n">nodeID_2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the ordered global degrees of freedom of two nodes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodeID_1 : int</span>
<span class="sd">            Node 1 external index.</span>

<span class="sd">        nodeID_2 : int</span>
<span class="sd">            Node 2 external index.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reord_gdofs : list</span>
<span class="sd">            Global degrees of freedom ordered according to its indexes.</span>

<span class="sd">        first_node : Node object</span>
<span class="sd">            First node. </span>

<span class="sd">        last_node : Node object</span>
<span class="sd">            Last node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">nodeID_1</span><span class="p">]</span>
        <span class="n">node_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">nodeID_2</span><span class="p">]</span>
        <span class="n">nodes_gdofs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">node_1</span><span class="o">.</span><span class="n">global_dof</span><span class="p">,</span> <span class="n">node_2</span><span class="o">.</span><span class="n">global_dof</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">reord_gdofs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">nodes_gdofs</span><span class="p">)</span>
        <span class="k">if</span>  <span class="nb">list</span><span class="p">(</span><span class="n">nodes_gdofs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="n">reord_gdofs</span><span class="p">):</span>
            <span class="n">first_node</span> <span class="o">=</span> <span class="n">node_1</span>
            <span class="n">last_node</span> <span class="o">=</span> <span class="n">node_2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">first_node</span> <span class="o">=</span> <span class="n">node_2</span>
            <span class="n">last_node</span> <span class="o">=</span> <span class="n">node_1</span>
        <span class="k">return</span> <span class="n">reord_gdofs</span><span class="p">,</span> <span class="n">first_node</span><span class="p">,</span> <span class="n">last_node</span>       </div>

    <span class="k">def</span> <span class="nf">get_nodes_and_elements_with_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Incomplete model setup&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Dear user, you should should to apply a cross-setion to all &#39;pipe_1&#39; or &#39;pipe_2&#39; elements&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;before continue&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_cross_section_transition</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">neigh_elements</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_connected_to_node</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">check_complete</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">neigh_elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">neigh_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;pipe_1&quot;</span><span class="p">,</span> <span class="s2">&quot;pipe_2&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">neigh_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cross_section</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">PrintMessageInput</span><span class="p">([</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">window_title_1</span><span class="p">])</span>
                        <span class="k">return</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">check_complete</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">diameter_first</span> <span class="o">=</span> <span class="n">neigh_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">outer_diameter</span>
                        
                <span class="k">if</span> <span class="n">neigh_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;pipe_1&quot;</span><span class="p">,</span> <span class="s2">&quot;pipe_2&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">neigh_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">cross_section</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">PrintMessageInput</span><span class="p">([</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">window_title_1</span><span class="p">])</span>
                        <span class="k">return</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">check_complete</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">diameter_last</span> <span class="o">=</span> <span class="n">neigh_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">outer_diameter</span>
                
                <span class="k">if</span> <span class="n">check_complete</span><span class="p">:</span>
                    <span class="n">diameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">diameter_first</span><span class="p">,</span> <span class="n">diameter_last</span><span class="p">]</span>
                    <span class="n">diameters_ratio</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">diameters</span><span class="p">)</span><span class="o">/</span><span class="nb">min</span><span class="p">(</span><span class="n">diameters</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">diameters_ratio</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_cross_section_transition</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">neigh_elements</span>
                        <span class="c1"># print(node.external_index, diameters_ratio)</span>


<div class="viewcode-block" id="Preprocessor.add_elastic_nodal_link"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.add_elastic_nodal_link">[docs]</a>    <span class="k">def</span> <span class="nf">add_elastic_nodal_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeID_1</span><span class="p">,</span> <span class="n">nodeID_2</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">_stiffness</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">_damping</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method ???????</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodeID_1 : int</span>
<span class="sd">            Node 1 external index.</span>

<span class="sd">        nodeID_2 : int</span>
<span class="sd">            Node 2 external index.</span>

<span class="sd">        parameters : ??????</span>
<span class="sd">            ???????.</span>

<span class="sd">        _stiffness : bool, optional</span>
<span class="sd">            True if ???????. False otherwise.</span>
<span class="sd">            Default is False.</span>

<span class="sd">        _damping : bool, optional</span>
<span class="sd">            True if ???????. False otherwise.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">_stiffness</span> <span class="ow">or</span> <span class="n">_damping</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">gdofs</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_gdofs_from_nodes</span><span class="p">(</span><span class="n">nodeID_1</span><span class="p">,</span> <span class="n">nodeID_2</span><span class="p">)</span>     
        <span class="n">min_node_ID</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">node1</span><span class="o">.</span><span class="n">external_index</span><span class="p">,</span> <span class="n">node2</span><span class="o">.</span><span class="n">external_index</span><span class="p">)</span>
        <span class="n">max_node_ID</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">node1</span><span class="o">.</span><span class="n">external_index</span><span class="p">,</span> <span class="n">node2</span><span class="o">.</span><span class="n">external_index</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_node_ID</span><span class="p">,</span> <span class="n">max_node_ID</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">]:</span>

                <span class="k">if</span> <span class="n">_stiffness</span><span class="p">:</span>
                    <span class="n">count_stiffness</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">elastic_nodal_link_stiffness</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">elastic_nodal_link_stiffness</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">_key</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">elastic_nodal_link_stiffness</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">str_nodes</span> <span class="o">=</span> <span class="n">_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                        <span class="n">node_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">str_node</span><span class="p">)</span> <span class="k">for</span> <span class="n">str_node</span> <span class="ow">in</span> <span class="n">str_nodes</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
                            <span class="n">count_stiffness</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">count_stiffness</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">loaded_table_for_elastic_link_stiffness</span> <span class="o">=</span> <span class="kc">False</span>
                
                <span class="k">if</span> <span class="n">_damping</span><span class="p">:</span>
                    <span class="n">count_damping</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">elastic_nodal_link_dampings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">elastic_nodal_link_dampings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">_key</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">elastic_nodal_link_dampings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">str_nodes</span> <span class="o">=</span> <span class="n">_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                        <span class="n">node_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">str_node</span><span class="p">)</span> <span class="k">for</span> <span class="n">str_node</span> <span class="ow">in</span> <span class="n">str_nodes</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
                            <span class="n">count_damping</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">count_damping</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">loaded_table_for_elastic_link_stiffness</span> <span class="o">=</span> <span class="kc">False</span>
                    
            <span class="k">if</span> <span class="n">_stiffness</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_elastic_link_stiffness</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_elastic_link_stiffness</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">_damping</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_elastic_link_dampings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_elastic_link_dampings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
           
            <span class="k">return</span>

        <span class="p">[</span><span class="n">parameters</span><span class="p">,</span> <span class="n">table_names</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
               
        <span class="n">gdofs_node1</span> <span class="o">=</span> <span class="n">gdofs</span><span class="p">[:</span><span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">]</span>
        <span class="n">gdofs_node2</span> <span class="o">=</span> <span class="n">gdofs</span><span class="p">[</span><span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">process_nodes_to_update_indexes_after_remesh</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_nodes_to_update_indexes_after_remesh</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>
        
        <span class="n">pos_data</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="n">neg_data</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">value</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">]</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">True</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">]</span>

        <span class="n">check_tables</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">]</span>

        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check_tables</span><span class="p">:</span>
            <span class="n">node1</span><span class="o">.</span><span class="n">loaded_table_for_elastic_link_stiffness</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">node2</span><span class="o">.</span><span class="n">loaded_table_for_elastic_link_stiffness</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">node1</span><span class="o">.</span><span class="n">loaded_table_for_elastic_link_dampings</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">node2</span><span class="o">.</span><span class="n">loaded_table_for_elastic_link_dampings</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">value_labels</span> <span class="o">=</span> <span class="n">table_names</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_labels</span> <span class="o">=</span> <span class="n">parameters</span>
            <span class="n">node1</span><span class="o">.</span><span class="n">loaded_table_for_elastic_link_stiffness</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">node2</span><span class="o">.</span><span class="n">loaded_table_for_elastic_link_stiffness</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">node1</span><span class="o">.</span><span class="n">loaded_table_for_elastic_link_dampings</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">node2</span><span class="o">.</span><span class="n">loaded_table_for_elastic_link_dampings</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">indexes_i</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="n">gdofs_node1</span><span class="p">,</span> <span class="n">gdofs_node2</span> <span class="p">],</span> <span class="p">[</span> <span class="n">gdofs_node1</span><span class="p">,</span> <span class="n">gdofs_node2</span> <span class="p">]</span> <span class="p">]</span> 
        <span class="n">indexes_j</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="n">gdofs_node1</span><span class="p">,</span> <span class="n">gdofs_node1</span> <span class="p">],</span> <span class="p">[</span> <span class="n">gdofs_node2</span><span class="p">,</span> <span class="n">gdofs_node2</span> <span class="p">]</span> <span class="p">]</span> 
        <span class="n">out_data</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="n">pos_data</span><span class="p">,</span> <span class="n">neg_data</span> <span class="p">],</span> <span class="p">[</span> <span class="n">neg_data</span><span class="p">,</span> <span class="n">pos_data</span> <span class="p">]</span> <span class="p">]</span>
        <span class="n">element_matrix_info_node1</span> <span class="o">=</span> <span class="p">[</span> <span class="n">indexes_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indexes_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">out_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span> 
        <span class="n">element_matrix_info_node2</span> <span class="o">=</span> <span class="p">[</span> <span class="n">indexes_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indexes_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">out_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span> 
        
        <span class="k">if</span> <span class="n">_stiffness</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_elastic_link_stiffness</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">element_matrix_info_node1</span><span class="p">,</span> <span class="n">element_matrix_info_node2</span><span class="p">]</span>
            <span class="n">node1</span><span class="o">.</span><span class="n">elastic_nodal_link_stiffness</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">value_labels</span><span class="p">]</span>
            <span class="n">node2</span><span class="o">.</span><span class="n">elastic_nodal_link_stiffness</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">value_labels</span><span class="p">]</span>
            <span class="n">node1</span><span class="o">.</span><span class="n">there_are_elastic_nodal_link_stiffness</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">node2</span><span class="o">.</span><span class="n">there_are_elastic_nodal_link_stiffness</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="n">_damping</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_with_elastic_link_dampings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">element_matrix_info_node1</span><span class="p">,</span> <span class="n">element_matrix_info_node2</span><span class="p">]</span>
            <span class="n">node1</span><span class="o">.</span><span class="n">elastic_nodal_link_dampings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">value_labels</span><span class="p">]</span>
            <span class="n">node2</span><span class="o">.</span><span class="n">elastic_nodal_link_dampings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">value_labels</span><span class="p">]</span>
            <span class="n">node1</span><span class="o">.</span><span class="n">there_are_elastic_nodal_link_dampings</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">node2</span><span class="o">.</span><span class="n">there_are_elastic_nodal_link_dampings</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Preprocessor.process_element_cross_sections_orientation_to_plot"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.process_element_cross_sections_orientation_to_plot">[docs]</a>    <span class="k">def</span> <span class="nf">process_element_cross_sections_orientation_to_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method ???????</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rotation_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">number_structural_elements</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">rotation_data</span><span class="p">[</span><span class="n">index</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">mean_rotations_at_local_coordinate_system</span><span class="p">()</span>   
        
        <span class="n">rotation_results_matrices</span> <span class="o">=</span> <span class="n">_transformation_matrix_Nx3x3_by_angles</span><span class="p">(</span><span class="n">rotation_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rotation_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rotation_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>  
        <span class="n">matrix_resultant</span> <span class="o">=</span> <span class="n">rotation_results_matrices</span><span class="nd">@self</span><span class="o">.</span><span class="n">transformation_matrices</span> 
        <span class="n">r</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">matrix_resultant</span><span class="p">)</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="o">-</span><span class="n">r</span><span class="o">.</span><span class="n">as_euler</span><span class="p">(</span><span class="s1">&#39;zxy&#39;</span><span class="p">,</span> <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">deformed_rotation_xyz</span> <span class="o">=</span> <span class="p">[</span><span class="n">angles</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">angles</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">angles</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span></div>

            
<div class="viewcode-block" id="Preprocessor.process_all_rotation_matrices"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.process_all_rotation_matrices">[docs]</a>    <span class="k">def</span> <span class="nf">process_all_rotation_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method ???????</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">delta_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">number_structural_elements</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">xaxis_rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_structural_elements</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">delta_data</span><span class="p">[</span><span class="n">index</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">delta_x</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">delta_y</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">delta_z</span>
            <span class="n">xaxis_rotation_angle</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">xaxis_beam_rotation</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">transformation_matrices</span> <span class="o">=</span> <span class="n">_transformation_matrix_3x3xN</span><span class="p">(</span><span class="n">delta_data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> 
                                                                    <span class="n">delta_data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> 
                                                                    <span class="n">delta_data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> 
                                                                    <span class="n">gamma</span> <span class="o">=</span> <span class="n">xaxis_rotation_angle</span><span class="p">)</span>
        <span class="c1"># output_data = inverse_matrix_Nx3x3(self.transformation_matrices)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformation_matrices</span><span class="p">)</span>
        <span class="n">rotations</span> <span class="o">=</span> <span class="o">-</span><span class="n">r</span><span class="o">.</span><span class="n">as_euler</span><span class="p">(</span><span class="s1">&#39;zxy&#39;</span><span class="p">,</span> <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">rotations_xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rotations</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">rotations</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">rotations</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_rotations_xyz</span> <span class="o">=</span> <span class="n">rotations_xyz</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">sub_transformation_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation_matrices</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="n">element</span><span class="o">.</span><span class="n">section_directional_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation_matrices</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="n">element</span><span class="o">.</span><span class="n">section_rotation_xyz_undeformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_rotations_xyz</span><span class="p">[</span><span class="n">index</span><span class="p">,:]</span></div>

    <span class="k">def</span> <span class="nf">set_beam_xaxis_rotation_by_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">delta_angle</span><span class="p">,</span> <span class="n">gimball_deviation</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_to_rotation_angles</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta_angle</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_to_rotation_angles</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
        <span class="n">str_angle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">angle</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">270</span><span class="p">]:</span>
            <span class="n">angle</span> <span class="o">-=</span> <span class="n">gimball_deviation</span>
        <span class="k">elif</span> <span class="n">angle</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">270</span><span class="p">]:</span>
            <span class="n">angle</span> <span class="o">+=</span> <span class="n">gimball_deviation</span>
        <span class="n">angle</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>

        <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_to_elements</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_beam_xaxis_rotation_by_elements</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="n">str_angle</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">temp_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_beam_xaxis_rotating_angle_to_lines</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">str_angle</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">temp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_beam_xaxis_rotating_angle_to_lines</span><span class="p">[</span><span class="n">str_angle</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">lines</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">str_angle</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dict_beam_xaxis_rotating_angle_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_beam_xaxis_rotating_angle_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dict_beam_xaxis_rotating_angle_to_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>                            
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">lines</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">str_angle</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dict_beam_xaxis_rotating_angle_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dict_beam_xaxis_rotating_angle_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_beam_xaxis_rotating_angle_to_lines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dict_beam_xaxis_rotating_angle_to_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">temp_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_beam_xaxis_rotating_angle_to_lines</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>              
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;0.0&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">temp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_beam_xaxis_rotating_angle_to_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">set_beam_xaxis_rotation_by_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">slicer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">xaxis_beam_rotation</span> <span class="o">=</span> <span class="n">angle</span>

    <span class="k">def</span> <span class="nf">create_dict_lines_to_rotation_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_to_rotation_angles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_lines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_lines_to_rotation_angles</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="Preprocessor.process_nodes_to_update_indexes_after_remesh"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.process_nodes_to_update_indexes_after_remesh">[docs]</a>    <span class="k">def</span> <span class="nf">process_nodes_to_update_indexes_after_remesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method ...</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">str_coord</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_coordinate_to_update_bc_after_remesh</span><span class="p">[</span><span class="n">str_coord</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">external_index</span></div>

    <span class="k">def</span> <span class="nf">update_node_ids_after_remesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_cache</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">):</span>
        <span class="n">coord_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodal_coordinates_matrix_external</span>
        <span class="n">list_coordinates</span> <span class="o">=</span> <span class="n">coord_matrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">new_external_indexes</span> <span class="o">=</span> <span class="n">coord_matrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_non_mapped_bcs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">old_external_index</span> <span class="ow">in</span> <span class="n">dict_cache</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">list_key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">_key</span><span class="p">)</span> <span class="k">for</span> <span class="n">_key</span> <span class="ow">in</span> <span class="n">list_key</span> <span class="k">if</span> <span class="n">_key</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">list_coordinates</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">list_coordinates</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
                <span class="n">new_external_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_external_indexes</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_old_to_new_node_external_indexes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">old_external_index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_external_index</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coord_matrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coord</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="n">tolerance</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">new_external_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">coord_matrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="n">mask</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dict_old_to_new_node_external_indexes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">old_external_index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_external_index</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dict_non_mapped_bcs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_external_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_nodal_coordinates_matrix</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_old_to_new_node_external_indexes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_non_mapped_bcs</span><span class="p">]</span>


<div class="viewcode-block" id="Preprocessor.process_elements_to_update_indexes_after_remesh_in_entity_file"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.process_elements_to_update_indexes_after_remesh_in_entity_file">[docs]</a>    <span class="k">def</span> <span class="nf">process_elements_to_update_indexes_after_remesh_in_entity_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_elements</span><span class="p">,</span> <span class="n">reset_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">line_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dict_map_cross</span><span class="o">=</span><span class="p">{},</span> <span class="n">dict_map_expansion_joint</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_groups_elements</span> <span class="o">=</span> <span class="n">check_is_there_a_group_of_elements_inside_list_elements</span><span class="p">(</span><span class="n">list_elements</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">reset_line</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_list_elements_from_line</span><span class="p">(</span><span class="n">line_id</span><span class="p">,</span> <span class="n">dict_map_cross</span><span class="p">,</span> <span class="n">dict_map_expansion_joint</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subgroup_elements</span> <span class="ow">in</span> <span class="n">list_groups_elements</span><span class="p">:</span>
                <span class="n">first_element_id</span> <span class="o">=</span> <span class="n">subgroup_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">last_element_id</span> <span class="o">=</span> <span class="n">subgroup_elements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">start_node_id</span><span class="p">,</span> <span class="n">end_node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distantest_nodes_from_elements</span><span class="p">([</span><span class="n">first_element_id</span><span class="p">,</span> <span class="n">last_element_id</span><span class="p">])</span> 
                <span class="n">first_node_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">start_node_id</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span>
                <span class="n">last_node_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">end_node_id</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span>
                <span class="n">line_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_to_line</span><span class="p">[</span><span class="n">first_element_id</span><span class="p">]</span>
                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_element_id</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">last_element_id</span><span class="si">}</span><span class="s2">||</span><span class="si">{</span><span class="n">line_id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_element_info_to_update_indexes_in_entity_file</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>    <span class="nb">list</span><span class="p">(</span><span class="n">first_node_coordinates</span><span class="p">),</span>
                                                                                    <span class="nb">list</span><span class="p">(</span><span class="n">last_node_coordinates</span><span class="p">),</span>
                                                                                    <span class="n">subgroup_elements</span>   <span class="p">]</span></div>


    <span class="k">def</span> <span class="nf">reset_list_elements_from_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_id</span><span class="p">,</span> <span class="n">dict_map_cross</span><span class="p">,</span> <span class="n">dict_map_expansion_joint</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">line_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_map_cross</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_map_expansion_joint</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">temp_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_element_info_to_update_indexes_in_entity_file</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">key_line_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">line_id</span> <span class="o">==</span> <span class="n">key_line_id</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_element_info_to_update_indexes_in_entity_file</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        
        <span class="n">list_group_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">list_elements_cross</span> <span class="ow">in</span> <span class="n">dict_map_cross</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">list_group_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_elements_cross</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">list_elements_joint</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dict_map_expansion_joint</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">list_group_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_elements_joint</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">_list_elements</span> <span class="ow">in</span> <span class="n">list_group_elements</span><span class="p">:</span>    
            <span class="n">list_subgroups_elements</span> <span class="o">=</span> <span class="n">check_is_there_a_group_of_elements_inside_list_elements</span><span class="p">(</span><span class="n">_list_elements</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">subgroup_elements</span> <span class="ow">in</span> <span class="n">list_subgroups_elements</span><span class="p">:</span>
                <span class="n">first_element_id</span> <span class="o">=</span> <span class="n">subgroup_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">last_element_id</span> <span class="o">=</span> <span class="n">subgroup_elements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">start_node_id</span><span class="p">,</span> <span class="n">end_node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distantest_nodes_from_elements</span><span class="p">([</span><span class="n">first_element_id</span><span class="p">,</span> <span class="n">last_element_id</span><span class="p">])</span> 
                <span class="n">first_node_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">start_node_id</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span>
                <span class="n">last_node_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">end_node_id</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span>
                <span class="n">line_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_to_line</span><span class="p">[</span><span class="n">first_element_id</span><span class="p">]</span>
                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_element_id</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">last_element_id</span><span class="si">}</span><span class="s2">||</span><span class="si">{</span><span class="n">line_id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_element_info_to_update_indexes_in_entity_file</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>    <span class="nb">list</span><span class="p">(</span><span class="n">first_node_coordinates</span><span class="p">),</span>
                                                                                    <span class="nb">list</span><span class="p">(</span><span class="n">last_node_coordinates</span><span class="p">),</span>
                                                                                    <span class="n">subgroup_elements</span>   <span class="p">]</span>


<div class="viewcode-block" id="Preprocessor.process_elements_to_update_indexes_after_remesh_in_element_info_file"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.process_elements_to_update_indexes_after_remesh_in_element_info_file">[docs]</a>    <span class="k">def</span> <span class="nf">process_elements_to_update_indexes_after_remesh_in_element_info_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_elements</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_groups_elements</span> <span class="o">=</span> <span class="n">check_is_there_a_group_of_elements_inside_list_elements</span><span class="p">(</span><span class="n">list_elements</span><span class="p">)</span>
        <span class="n">output_subgroups_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">input_group</span> <span class="ow">in</span> <span class="n">input_groups_elements</span><span class="p">:</span>
            <span class="n">line_to_elements</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element_id</span> <span class="ow">in</span> <span class="n">input_group</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_to_line</span><span class="p">[</span><span class="n">element_id</span><span class="p">]</span>
                <span class="n">line_to_elements</span><span class="p">[</span><span class="n">line</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">line_to_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">output_subgroups_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_list_elements_to_subgroups</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">list_elements</span><span class="p">)]</span> <span class="o">=</span> <span class="n">output_subgroups_elements</span>

        <span class="k">for</span> <span class="n">output_subgroup</span> <span class="ow">in</span> <span class="n">output_subgroups_elements</span><span class="p">:</span>
       
            <span class="n">first_element_id</span> <span class="o">=</span> <span class="n">output_subgroup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">last_element_id</span> <span class="o">=</span> <span class="n">output_subgroup</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">start_node_id</span><span class="p">,</span> <span class="n">end_node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distantest_nodes_from_elements</span><span class="p">([</span><span class="n">first_element_id</span><span class="p">,</span> <span class="n">last_element_id</span><span class="p">])</span> 
            <span class="n">first_node_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">start_node_id</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span>
            <span class="n">last_node_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">end_node_id</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span>

            <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_element_id</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">last_element_id</span><span class="si">}</span><span class="s2">&quot;</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_element_info_to_update_indexes_in_element_info_file</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>  <span class="nb">list</span><span class="p">(</span><span class="n">first_node_coordinates</span><span class="p">),</span>
                                                                                    <span class="nb">list</span><span class="p">(</span><span class="n">last_node_coordinates</span><span class="p">),</span>
                                                                                    <span class="n">output_subgroup</span> <span class="p">]</span></div>


<div class="viewcode-block" id="Preprocessor.update_element_ids_after_remesh"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.update_element_ids_after_remesh">[docs]</a>    <span class="k">def</span> <span class="nf">update_element_ids_after_remesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_cache</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method ...</span>
<span class="sd">        &quot;&quot;&quot;</span>      
        <span class="n">coord_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodal_coordinates_matrix_external</span>
        <span class="n">list_coordinates</span> <span class="o">=</span> <span class="n">coord_matrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">new_external_indexes</span> <span class="o">=</span> <span class="n">coord_matrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dict_old_to_new_list_of_elements</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dict_non_mapped_subgroups</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dict_subgroups_old_to_new_group_nodes</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dict_cache</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="p">[</span><span class="n">first_node_coord</span><span class="p">,</span> <span class="n">last_node_coord</span><span class="p">,</span> <span class="n">subgroup_elements</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

            <span class="k">if</span> <span class="n">first_node_coord</span> <span class="ow">in</span> <span class="n">list_coordinates</span><span class="p">:</span>

                <span class="n">ind</span> <span class="o">=</span> <span class="n">list_coordinates</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">first_node_coord</span><span class="p">)</span>
                <span class="n">new_external_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_external_indexes</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="n">dict_subgroups_old_to_new_group_nodes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">subgroup_elements</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_external_index</span><span class="p">)</span>          
            
            <span class="k">else</span><span class="p">:</span>

                <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coord_matrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">first_node_coord</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="n">tolerance</span>
                
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">new_external_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">coord_matrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="n">mask</span><span class="p">])</span>
                    <span class="n">dict_subgroups_old_to_new_group_nodes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">subgroup_elements</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_external_index</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">dict_non_mapped_subgroups</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">subgroup_elements</span><span class="p">)]</span> <span class="o">=</span> <span class="n">subgroup_elements</span>
                           
            <span class="k">if</span> <span class="n">last_node_coord</span> <span class="ow">in</span> <span class="n">list_coordinates</span><span class="p">:</span>

                <span class="n">ind</span> <span class="o">=</span> <span class="n">list_coordinates</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">last_node_coord</span><span class="p">)</span>
                <span class="n">new_external_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_external_indexes</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="n">dict_subgroups_old_to_new_group_nodes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">subgroup_elements</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_external_index</span><span class="p">)</span>           
            
            <span class="k">else</span><span class="p">:</span>

                <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coord_matrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">last_node_coord</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="n">tolerance</span>
                
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">new_external_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">coord_matrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="n">mask</span><span class="p">])</span>
                    <span class="n">dict_subgroups_old_to_new_group_nodes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">subgroup_elements</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_external_index</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">dict_non_mapped_subgroups</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">subgroup_elements</span><span class="p">)]</span> <span class="o">=</span> <span class="n">subgroup_elements</span>
            
        <span class="k">for</span> <span class="n">str_subgroup_elements</span><span class="p">,</span> <span class="n">edge_nodes_from_group</span> <span class="ow">in</span> <span class="n">dict_subgroups_old_to_new_group_nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">str_subgroup_elements</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_non_mapped_subgroups</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">start_element_index</span><span class="p">,</span> <span class="n">end_element_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elements_inside_nodes_boundaries</span><span class="p">(</span><span class="n">edge_nodes_from_group</span><span class="p">)</span>
                <span class="n">new_list_elements</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start_element_index</span><span class="p">,</span> <span class="n">end_element_index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
                <span class="n">dict_old_to_new_list_of_elements</span><span class="p">[</span><span class="n">str_subgroup_elements</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_list_elements</span>

        <span class="k">return</span> <span class="n">dict_old_to_new_list_of_elements</span><span class="p">,</span> <span class="n">dict_non_mapped_subgroups</span></div>


<div class="viewcode-block" id="Preprocessor.get_distantest_nodes_from_elements"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_distantest_nodes_from_elements">[docs]</a>    <span class="k">def</span> <span class="nf">get_distantest_nodes_from_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_elements</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;This method returns the more distant nodes from selected elements</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">element_id</span> <span class="o">=</span> <span class="n">list_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">first_node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">element_id</span><span class="p">]</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">external_index</span>
            <span class="n">last_node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">element_id</span><span class="p">]</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">external_index</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="p">[</span><span class="n">element_id1</span><span class="p">,</span> <span class="n">element_id2</span><span class="p">]</span> <span class="o">=</span> <span class="n">list_elements</span>
            <span class="n">element_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">element_id1</span><span class="p">]</span>
            <span class="n">element_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">element_id2</span><span class="p">]</span>
            <span class="n">diff_1</span> <span class="o">=</span> <span class="n">element_1</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">-</span> <span class="n">element_2</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">coordinates</span>
            <span class="n">diff_2</span> <span class="o">=</span> <span class="n">element_2</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">-</span> <span class="n">element_1</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">coordinates</span>
            
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">diff_1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">diff_2</span><span class="p">):</span>
                <span class="n">first_node_id</span> <span class="o">=</span> <span class="n">element_1</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">external_index</span>
                <span class="n">last_node_id</span> <span class="o">=</span> <span class="n">element_2</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">external_index</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first_node_id</span> <span class="o">=</span> <span class="n">element_1</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">external_index</span>
                <span class="n">last_node_id</span> <span class="o">=</span> <span class="n">element_2</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">external_index</span>

        <span class="n">list_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">first_node_id</span><span class="p">,</span> <span class="n">last_node_id</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">list_nodes</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">list_nodes</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">get_elements_inside_nodes_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_nodes</span><span class="p">):</span>
        
        <span class="n">start_node</span><span class="p">,</span> <span class="n">end_node</span> <span class="o">=</span> <span class="n">list_nodes</span>
        <span class="n">element_1_start_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_first_node_to_element_index</span><span class="p">[</span><span class="n">start_node</span><span class="p">]</span>
        <span class="n">element_2_start_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_last_node_to_element_index</span><span class="p">[</span><span class="n">start_node</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">element_1_start_node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">element_2_start_node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">elements_start_node</span> <span class="o">=</span> <span class="n">element_1_start_node</span>
            <span class="k">for</span> <span class="n">element_id</span> <span class="ow">in</span> <span class="n">element_2_start_node</span><span class="p">:</span>
                <span class="n">elements_start_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">element_1_start_node</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">elements_start_node</span> <span class="o">=</span> <span class="n">element_2_start_node</span>
        <span class="k">elif</span> <span class="n">element_2_start_node</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">elements_start_node</span> <span class="o">=</span> <span class="n">element_1_start_node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements_start_node</span> <span class="o">=</span> <span class="p">[</span><span class="n">element_1_start_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">element_2_start_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        
        <span class="n">element_1_end_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_first_node_to_element_index</span><span class="p">[</span><span class="n">end_node</span><span class="p">]</span>
        <span class="n">element_2_end_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_last_node_to_element_index</span><span class="p">[</span><span class="n">end_node</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">element_1_end_node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">element_2_end_node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">elements_end_node</span> <span class="o">=</span> <span class="n">element_1_end_node</span>
            <span class="k">for</span> <span class="n">element_id</span> <span class="ow">in</span> <span class="n">element_2_end_node</span><span class="p">:</span>
                <span class="n">elements_end_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">element_1_end_node</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">elements_end_node</span> <span class="o">=</span> <span class="n">element_2_end_node</span>
        <span class="k">elif</span> <span class="n">element_2_end_node</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">elements_end_node</span> <span class="o">=</span> <span class="n">element_1_end_node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements_end_node</span> <span class="o">=</span> <span class="p">[</span><span class="n">element_1_end_node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">element_2_end_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                
        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">element_start</span> <span class="ow">in</span> <span class="n">elements_start_node</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">element_end</span> <span class="ow">in</span> <span class="n">elements_end_node</span><span class="p">:</span>
                
                <span class="n">difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">element_start</span><span class="p">]</span><span class="o">.</span><span class="n">element_center_coordinates</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">element_end</span><span class="p">]</span><span class="o">.</span><span class="n">element_center_coordinates</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                    <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">previous_distance</span> <span class="o">=</span> <span class="n">distance</span>
                    <span class="n">output_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">element_start</span><span class="p">,</span> <span class="n">element_end</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="n">previous_distance</span> <span class="o">&gt;</span> <span class="n">distance</span><span class="p">:</span>
                    <span class="n">previous_distance</span> <span class="o">=</span> <span class="n">distance</span>
                    <span class="n">output_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">element_start</span><span class="p">,</span> <span class="n">element_end</span><span class="p">]</span>
     
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">output_indexes</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">output_indexes</span><span class="p">)</span>             

<div class="viewcode-block" id="Preprocessor.deformed_amplitude_control_in_expansion_joints"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.deformed_amplitude_control_in_expansion_joints">[docs]</a>    <span class="k">def</span> <span class="nf">deformed_amplitude_control_in_expansion_joints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method evaluates the deformed amplitudes in expansion joints nodes</span>
<span class="sd">        and reduces the amplitude through rescalling if higher levels are observed.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_with_expansion_joint</span><span class="p">:</span>

            <span class="n">results_lcs</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">element_results_lcs</span><span class="p">()</span>
            <span class="n">delta_yz</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">results_lcs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">delta_yz</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">element_size</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">joint_effective_diameter</span><span class="o">/</span><span class="mi">6</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">value</span>
            
            <span class="n">first_node</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">first_node</span>
            <span class="n">last_node</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">last_node</span>
            <span class="n">delta_x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span>  <span class="p">(</span><span class="n">last_node</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">results_lcs</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">-</span> 
                            <span class="p">(</span><span class="n">first_node</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">results_lcs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">)</span>

            <span class="k">if</span> <span class="n">delta_x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_size</span><span class="o">/</span><span class="mi">3</span> <span class="ow">or</span> <span class="n">delta_x</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">element_size</span><span class="p">:</span> 
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_size</span><span class="o">/</span><span class="mi">2</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">value</span>

        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Preprocessor.get_number_of_elements_by_element_type"><a class="viewcode-back" href="../../../code_reference/Preprocessor.html#pulse.preprocessing.preprocessor.Preprocessor.get_number_of_elements_by_element_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_of_elements_by_element_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot; This method returns &quot;&quot;&quot;</span>
        <span class="n">acoustic_etype_to_number_elements</span> <span class="o">=</span> <span class="p">{</span>   <span class="s1">&#39;undamped&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                                <span class="s1">&#39;proportional&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                                <span class="s1">&#39;wide-duct&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                                <span class="s1">&#39;LRF fluid equivalent&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                                <span class="s1">&#39;LRF full&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                                <span class="s1">&#39;undamped mean flow&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                                <span class="s1">&#39;howe&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                                <span class="s1">&#39;peters&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                                <span class="kc">None</span> <span class="p">:</span> <span class="mi">0</span>    <span class="p">}</span>

        <span class="n">structural_etype_to_number_elements</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;pipe_1&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                                <span class="s2">&quot;pipe_2&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                                <span class="s2">&quot;beam_1&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                                <span class="s2">&quot;expansion_joint&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                                <span class="s2">&quot;valve&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                                <span class="kc">None</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>

        <span class="n">acoustic_etype_to_elements</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">structural_etype_to_elements</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">structural_etype_to_number_elements</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">element_type</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">structural_etype_to_elements</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">element_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acoustic_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_elements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">element_type</span> <span class="o">!=</span> <span class="s1">&#39;beam_1&#39;</span><span class="p">:</span>
                <span class="n">acoustic_etype_to_number_elements</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">element_type</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">acoustic_etype_to_elements</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">element_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="c1"># print(f&quot;acoustic elements data: {acoustic_etype_to_number_elements}&quot;)</span>
        <span class="c1"># print(f&quot;structural elements data: {structural_etype_to_number_elements}&quot;)</span>
        <span class="k">return</span> <span class="n">structural_etype_to_number_elements</span><span class="p">,</span> <span class="n">acoustic_etype_to_number_elements</span></div></div>

    <span class="c1">#TODO: remove the following methods if they are not necessary anymore</span>

    <span class="c1"># def get_beam_nodes_and_indexes(self, list_beam_elements):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This method returns the global indexes of the nodes associated to structural beam elements.</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     list</span>
    <span class="c1">#         Nodes global indexes associated to beam element.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     list_beam_nodes = []</span>
    <span class="c1">#     list_node_ids = []</span>
    <span class="c1">#     # print(len(list_beam_elements))</span>
    <span class="c1">#     self.get_nodes_connected_to_beam_and_pipe()#list_beam_elements)</span>
    <span class="c1">#     # list(self.nodes_with_multiples_neighbors.keys())</span>
        
    <span class="c1">#     # for element in self.structural_elements.values():</span>
    <span class="c1">#     for element in list_beam_elements:</span>
    <span class="c1">#         # if element.element_type in [&#39;beam_1&#39;]:</span>
            
    <span class="c1">#         node_first = element.first_node</span>
    <span class="c1">#         node_last = element.last_node</span>
            
    <span class="c1">#         if node_first not in list_beam_nodes:</span>
    <span class="c1">#             list_beam_nodes.append(node_first)</span>
    <span class="c1">#             list_node_ids.append(node_first.global_index)</span>
            
    <span class="c1">#         if node_last not in list_beam_nodes:</span>
    <span class="c1">#             list_beam_nodes.append(node_last)</span>
    <span class="c1">#             list_node_ids.append(node_last.global_index)</span>
                        
    <span class="c1">#         if node_first in self.nodes_connected_to_beam_and_pipe:</span>
    <span class="c1">#             print(f&#39;First node: {node_first.external_index}&#39;)</span>
    <span class="c1">#             list_beam_nodes.remove(node_first)</span>
    <span class="c1">#             list_node_ids.remove(node_first.global_index)</span>

    <span class="c1">#         if node_last in self.nodes_connected_to_beam_and_pipe:</span>
    <span class="c1">#             print(f&#39;Last node: {node_last.external_index}&#39;)</span>
    <span class="c1">#             list_beam_nodes.remove(node_last) </span>
    <span class="c1">#             list_node_ids.remove(node_last.global_index) </span>

    <span class="c1">#     print(len(list_node_ids))</span>
    <span class="c1">#     return list_node_ids</span>

    <span class="c1"># def get_nodes_connected_to_beam_and_pipe(self):</span>
    <span class="c1">#     list_nodes_with_multiples_neighbors = list(self.nodes_with_multiples_neighbors.keys())</span>
    <span class="c1">#     self.dict_node_to_multiple_element_types = defaultdict(list)</span>
    <span class="c1">#     self.nodes_connected_to_beam_and_pipe = []</span>
    <span class="c1">#     for element in self.structural_elements.values():#list_beam_elements:</span>
    <span class="c1">#         first_node = element.first_node</span>
    <span class="c1">#         last_node = element.last_node</span>
    <span class="c1">#         if first_node in list_nodes_with_multiples_neighbors:</span>
    <span class="c1">#             self.dict_node_to_multiple_element_types[first_node].append(element.element_type)</span>
    <span class="c1">#         if last_node in list_nodes_with_multiples_neighbors:</span>
    <span class="c1">#             self.dict_node_to_multiple_element_types[last_node].append(element.element_type)</span>
    <span class="c1">#     for node, element_types in self.dict_node_to_multiple_element_types.items():</span>
    <span class="c1">#         if &quot;beam_1&quot; in element_types:</span>
    <span class="c1">#             if (&quot;pipe_1&quot; or &quot;pipe_2&quot;) in element_types:</span>
    <span class="c1">#                 print(f&quot;Node to remove: {node.external_index}&quot;)</span>
    <span class="c1">#                 # print(element_types)</span>
    <span class="c1">#                 self.nodes_connected_to_beam_and_pipe.append(node)</span>
    <span class="c1">#     print(len(self.nodes_connected_to_beam_and_pipe))</span>
</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2020, MOPT.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>