
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pulse.preprocessing.structural_element &#8212; OpenPulse  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../../index.html">
  <img src="../../../_static/logo.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../installing/installing.html">
  Installing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../guides/index.html">
  How-to Guides
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../code_reference/index.html">
  Code reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../theory_reference/index.html">
  Theory reference
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for pulse.preprocessing.structural_element</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span>
<span class="kn">from</span> <span class="nn">pulse.preprocessing.acoustic_element</span> <span class="kn">import</span> <span class="n">DOF_PER_NODE</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pulse.preprocessing.node</span> <span class="kn">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">DOF_PER_NODE_STRUCTURAL</span>

<span class="n">NODES_PER_ELEMENT</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">DOF_PER_ELEMENT</span> <span class="o">=</span> <span class="n">DOF_PER_NODE_STRUCTURAL</span> <span class="o">*</span> <span class="n">NODES_PER_ELEMENT</span>
<span class="n">ENTRIES_PER_ELEMENT</span> <span class="o">=</span> <span class="n">DOF_PER_ELEMENT</span> <span class="o">**</span> <span class="mi">2</span>

<span class="n">decoupling_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span><span class="n">DOF_PER_ELEMENT</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">zeros_3x3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<div class="viewcode-block" id="gauss_quadrature"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.gauss_quadrature">[docs]</a><span class="k">def</span> <span class="nf">gauss_quadrature</span><span class="p">(</span><span class="n">integration_points</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method returns the Gauss quadrature data.  </span>

<span class="sd">    Parameters</span>
<span class="sd">    -------</span>
<span class="sd">    integration_points : int</span>
<span class="sd">        Number of integration points.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    points : array</span>
<span class="sd">        Integration points in the normalized domain [-1,1].</span>

<span class="sd">    weigths : array</span>
<span class="sd">        Weigths of the respective integration points in the sum approximation.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        Only 1, 2, and 3 integration points are supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">integration_points</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">weigths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">integration_points</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="n">weigths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">integration_points</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">5</span><span class="p">)]</span>
        <span class="n">weigths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="o">/</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="o">/</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="o">/</span><span class="mi">9</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;You must provide 1, 2, or 3 integration points&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">points</span><span class="p">,</span> <span class="n">weigths</span></div>

<div class="viewcode-block" id="shape_function"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.shape_function">[docs]</a><span class="k">def</span> <span class="nf">shape_function</span><span class="p">(</span><span class="n">ksi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function returns the one dimensional linear shape function and its derivative.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    float in [-1,1]</span>
<span class="sd">        Dimensionless coordinate.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    phi : array</span>
<span class="sd">        One dimensional linear shape function.</span>

<span class="sd">    derivative_phi : array</span>
<span class="sd">        Shape function derivative.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ksi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">ksi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">derivative_phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">phi</span><span class="p">,</span> <span class="n">derivative_phi</span></div>

<div class="viewcode-block" id="symmetrize"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.symmetrize">[docs]</a><span class="k">def</span> <span class="nf">symmetrize</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function receives matrix and makes it symmetric.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    array</span>
<span class="sd">        Matrix.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    array</span>
<span class="sd">        Symmetric matrix.    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">diagonal</span><span class="p">())</span></div>
<div class="viewcode-block" id="StructuralElement"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement">[docs]</a><span class="k">class</span> <span class="nc">StructuralElement</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A structural element.</span>
<span class="sd">    This class creates a structural element from input data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    first_node : Node object</span>
<span class="sd">        Fist node of element.</span>

<span class="sd">    last_node : Node object</span>
<span class="sd">        Last node of element.</span>

<span class="sd">    index : int</span>
<span class="sd">        Element index.</span>

<span class="sd">    element_type : str, [&#39;pipe_1&#39;, &#39;pipe_2&#39;, &#39;beam_1&#39;, &#39;expansion_joint&#39;, &#39;valve&#39;], optional</span>
<span class="sd">        Element type</span>
<span class="sd">        Default is &#39;pipe_1&#39;.</span>

<span class="sd">    material : Material object, optional</span>
<span class="sd">        Element structural material.</span>
<span class="sd">        Default is &#39;None&#39;.</span>

<span class="sd">    fluid : Fluid object, optional</span>
<span class="sd">        Element acoustic fluid.</span>
<span class="sd">        Default is &#39;None&#39;.</span>

<span class="sd">    cross_section : CrossSection object, optional</span>
<span class="sd">        Element cross section.</span>
<span class="sd">        Default is &#39;None&#39;.</span>

<span class="sd">    loaded_forces : array, optional</span>
<span class="sd">        Structural forces and moments on the nodes.</span>
<span class="sd">        Default is zeros(12).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_node</span><span class="p">,</span> <span class="n">last_node</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">first_node</span> <span class="o">=</span> <span class="n">first_node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_node</span> <span class="o">=</span> <span class="n">last_node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;element_type&#39;</span><span class="p">,</span> <span class="s1">&#39;pipe_1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wall_formulation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wall_formulation&#39;</span><span class="p">,</span> <span class="s1">&#39;thick_wall&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cross_section&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_section_points</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cross_section_points&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loaded_forces</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;loaded_forces&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fluid</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fluid&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adding_mass_effect</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;adding_mass_effect&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoupling_matrix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decoupling_matrix&#39;</span><span class="p">,</span> <span class="n">decoupling_matrix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoupling_info</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decoupling_info&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">capped_end</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;capped_end&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stress_intensification</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stress_intensification&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wall_formutation_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wall_formutation_type&#39;</span><span class="p">,</span> <span class="s2">&quot;thick wall&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force_offset</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">section_rotation_xyz_undeformed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deformed_rotation_xyz</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deformed_length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xaxis_beam_rotation</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_pressure</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">external_pressure</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_expansion_joint_parameters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_valve_parameters</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delta_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">z</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">element_center_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> 
                                                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                                                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_Dab</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Bab</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Dts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Bts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rot</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_transformation_matrix</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_inverse_rotation_matrix</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_directional_vectors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_rotation_results</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation_matrix_results_at_lcs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results_at_global_coordinate_system</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stress</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_load</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">static_analysis_evaluated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">perforated_plate</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valve_parameters</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the element length.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            Element length.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_node</span><span class="p">)</span> 

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">global_dof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the element global degrees of freedom. The 3D Timoshenko beam theory implemented takes into account the three node&#39;s translations and the three node&#39;s rotations.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Element global degrees of freedom.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">global_dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">global_dof</span><span class="p">[:</span><span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">global_dof</span>
        <span class="n">global_dof</span><span class="p">[</span><span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">global_dof</span>
        <span class="k">return</span> <span class="n">global_dof</span>

    <span class="c1"># @property</span>
    <span class="c1"># def local_dof(self):</span>
    <span class="c1">#     return np.arange(DOF_PER_ELEMENT, dtype=int)</span>

    <span class="k">def</span> <span class="nf">element_results_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">values</span><span class="p">[:</span><span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">nodal_solution_gcs</span>
        <span class="n">values</span><span class="p">[</span><span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">nodal_solution_gcs</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="k">def</span> <span class="nf">element_results_lcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_rotation_matrix</span><span class="nd">@self</span><span class="o">.</span><span class="n">element_results_gcs</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">static_element_results_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">values</span><span class="p">[:</span><span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_node</span><span class="o">.</span><span class="n">static_nodal_solution_gcs</span>
        <span class="n">values</span><span class="p">[</span><span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_node</span><span class="o">.</span><span class="n">static_nodal_solution_gcs</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="k">def</span> <span class="nf">static_element_results_lcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_rotation_matrix</span><span class="nd">@self</span><span class="o">.</span><span class="n">static_element_results_gcs</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">mean_element_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">results_gcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_results_gcs</span><span class="p">()</span>
        <span class="n">results_first_node</span> <span class="o">=</span> <span class="n">results_gcs</span><span class="p">[:</span><span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">]</span>
        <span class="n">results_last_node</span> <span class="o">=</span> <span class="n">results_gcs</span><span class="p">[</span><span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">:]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">results_first_node</span><span class="o">+</span><span class="n">results_last_node</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="c1"># u_x = (results_gcs[0] + results_gcs[-6])/2</span>
        <span class="c1"># u_y = (results_gcs[1] + results_gcs[-5])/2</span>
        <span class="c1"># u_z = (results_gcs[2] + results_gcs[-4])/2       </span>
        <span class="c1"># theta_x = (results_gcs[3] + results_gcs[-3])/2</span>
        <span class="c1"># tehta_y = (results_gcs[4] + results_gcs[-2])/2</span>
        <span class="c1"># tehta_z = (results_gcs[5] + results_gcs[-1])/2</span>
        <span class="c1"># return np.array([u_x, u_y, u_z, theta_x, tehta_y, tehta_z], dtype=float)</span>

    <span class="k">def</span> <span class="nf">mean_rotations_at_global_coordinate_system</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">results_gcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_results_gcs</span><span class="p">()</span>
        <span class="n">theta_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">results_gcs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">results_gcs</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">tehta_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">results_gcs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">results_gcs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">tehta_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">results_gcs</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">results_gcs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">theta_x</span><span class="p">,</span> <span class="n">tehta_y</span><span class="p">,</span> <span class="n">tehta_z</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mean_rotations_at_local_coordinate_system</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">results_lcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_results_lcs</span><span class="p">()</span>
        <span class="n">theta_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">results_lcs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">results_lcs</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">tehta_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">results_lcs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">results_lcs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">tehta_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">results_lcs</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">results_lcs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">theta_x</span><span class="p">,</span> <span class="n">tehta_y</span><span class="p">,</span> <span class="n">tehta_z</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">section_normal_vectors_at_lcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">theta_x</span><span class="p">,</span> <span class="n">theta_y</span><span class="p">,</span> <span class="n">theta_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_rotations_at_local_coordinate_system</span><span class="p">()</span>
        <span class="n">L_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">L_</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_z</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">L_</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_z</span><span class="p">)</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="o">-</span><span class="n">L</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_y</span><span class="p">)</span>
        <span class="n">uvw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_x</span><span class="p">)</span> <span class="o">-</span> <span class="n">dz</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_x</span><span class="p">),</span> <span class="n">dy</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_x</span><span class="p">)</span> <span class="o">+</span> <span class="n">dz</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_x</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>   
        <span class="k">return</span> <span class="n">uvw</span>

    <span class="k">def</span> <span class="nf">deformed_element_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deformed_length</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">delta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">delta</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        
<div class="viewcode-block" id="StructuralElement.global_matrix_indexes"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.global_matrix_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">global_matrix_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the indexes of the rows and columns that place the element matrices into the global matrices according to the element global degrees of freedom.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rows : array</span>
<span class="sd">            Indexes of the rows. It&#39;s a matrix with dimension 12 by 12 constant through the rows.</span>
<span class="sd">            </span>
<span class="sd">        cols : array</span>
<span class="sd">            Indexes of the columns. It&#39;s a matrix with dimension 12 by 12 constant through the columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_dof</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">DOF_PER_ELEMENT</span><span class="p">))</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">rows</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">rows</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">cols</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="StructuralElement.matrices_gcs"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.matrices_gcs">[docs]</a>    <span class="k">def</span> <span class="nf">matrices_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the element stiffness and mass matrices according to the 3D Timoshenko beam theory in the global coordinate system.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        stiffness : array</span>
<span class="sd">            Element stiffness matrix in the global coordinate system.</span>
<span class="sd">            </span>
<span class="sd">        mass : array</span>
<span class="sd">            Element mass matrix in the global coordinate system.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        stiffness_matrix_gcs : Element stiffness matrix in the global coordinate system.</span>
<span class="sd">        </span>
<span class="sd">        mass_matrix_gcs : Element mass matrix in the global coordinate system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rot</span> <span class="o">=</span> <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_rotation_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_element_rotation_matrix</span><span class="p">()</span>
        <span class="n">Rt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transpose_rotation_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_rotation_matrix</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pipe_1&#39;</span><span class="p">,</span><span class="s1">&#39;pipe_2&#39;</span><span class="p">]:</span>
            <span class="n">stiffness</span> <span class="o">=</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness_matrix_pipes</span><span class="p">()</span> <span class="o">@</span> <span class="n">R</span>
            <span class="n">mass</span> <span class="o">=</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_matrix_pipes</span><span class="p">()</span> <span class="o">@</span> <span class="n">R</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;beam_1&#39;</span><span class="p">]:</span>
            <span class="n">stiffness</span> <span class="o">=</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness_matrix_beam</span><span class="p">()</span> <span class="o">@</span> <span class="n">R</span>
            <span class="n">mass</span> <span class="o">=</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_matrix_beam</span><span class="p">()</span> <span class="o">@</span> <span class="n">R</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;valve&#39;</span><span class="p">]:</span>
            <span class="n">stiffness</span> <span class="o">=</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness_matrix_pipes</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_stiffening_factor</span> <span class="o">@</span> <span class="n">R</span>
            <span class="n">mass</span> <span class="o">=</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_matrix_valve</span><span class="p">()</span> <span class="o">@</span> <span class="n">R</span>   
        <span class="c1"># elif self.element_type == &quot;expansion_joint&quot;:</span>
        <span class="c1">#     stiffness = Rt @ self.stiffness_matrix_expansion_joint() @ R</span>
        <span class="c1">#     mass = Rt @ self.mass_matrix_expansion_joint() @ R            </span>
        <span class="k">return</span> <span class="n">stiffness</span><span class="p">,</span> <span class="n">mass</span></div>

<div class="viewcode-block" id="StructuralElement.expansion_joint_matrices_gcs"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.expansion_joint_matrices_gcs">[docs]</a>    <span class="k">def</span> <span class="nf">expansion_joint_matrices_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the element stiffness and mass matrices according to the 3D Timoshenko beam theory in the global coordinate system.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        stiffness : array</span>
<span class="sd">            Element stiffness matrix in the global coordinate system.</span>
<span class="sd">            </span>
<span class="sd">        mass : array</span>
<span class="sd">            Element mass matrix in the global coordinate system.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        stiffness_matrix_gcs : Element stiffness matrix in the global coordinate system.</span>
<span class="sd">        </span>
<span class="sd">        mass_matrix_gcs : Element mass matrix in the global coordinate system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rot</span> <span class="o">=</span> <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_rotation_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_element_rotation_matrix</span><span class="p">()</span>
        <span class="n">Rt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transpose_rotation_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_rotation_matrix</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="o">==</span> <span class="s2">&quot;expansion_joint&quot;</span><span class="p">:</span>
            <span class="n">stiffness</span> <span class="o">=</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness_matrix_expansion_joint_harmonic</span><span class="p">(</span><span class="n">frequencies</span><span class="o">=</span><span class="n">frequencies</span><span class="p">)</span> <span class="o">@</span> <span class="n">R</span>
            <span class="n">mass</span> <span class="o">=</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_matrix_expansion_joint</span><span class="p">()</span> <span class="o">@</span> <span class="n">R</span>            
        <span class="k">return</span> <span class="n">stiffness</span><span class="p">,</span> <span class="n">mass</span></div>

<div class="viewcode-block" id="StructuralElement.stiffness_matrix_gcs"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.stiffness_matrix_gcs">[docs]</a>    <span class="k">def</span> <span class="nf">stiffness_matrix_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the element stiffness matrix according to the 3D Timoshenko beam theory in the global coordinate system.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        stiffness : array</span>
<span class="sd">            Element stiffness matrix in the global coordinate system.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        matrices_gcs : Element stiffness and mass matrices in the global coordinate system.</span>
<span class="sd">        </span>
<span class="sd">        mass_matrix_gcs : Element mass matrix in the global coordinate system.</span>

<span class="sd">        stiffness_matrix_pipes : Pipe element stiffness matrix in the local coordinate system.</span>

<span class="sd">        stiffness_matrix_beam : Beam element stiffness matrix in the local coordinate system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_rotation_matrix</span>
        <span class="n">Rt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transpose_rotation_matrix</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pipe_1&#39;</span><span class="p">,</span><span class="s1">&#39;pipe_2&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness_matrix_pipes</span><span class="p">()</span> <span class="o">@</span> <span class="n">R</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;beam_1&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness_matrix_beam</span><span class="p">()</span> <span class="o">@</span> <span class="n">R</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;valve&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness_matrix_pipes</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">valve_stiffening_factor</span> <span class="o">@</span> <span class="n">R</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="o">==</span> <span class="s2">&quot;expansion_joint&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness_matrix_expansion_joint_harmonic</span><span class="p">(</span><span class="n">frequencies</span><span class="o">=</span><span class="n">frequencies</span><span class="p">)</span> <span class="o">@</span> <span class="n">R</span></div>
            
<div class="viewcode-block" id="StructuralElement.mass_matrix_gcs"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.mass_matrix_gcs">[docs]</a>    <span class="k">def</span> <span class="nf">mass_matrix_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the element mass matrix according to the 3D Timoshenko beam theory in the global coordinate system.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mass : array</span>
<span class="sd">            Element mass matrix in the global coordinate system.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        matrices_gcs : Element stiffness and mass matrices in the global coordinate system.</span>

<span class="sd">        stiffness_matrix_gcs : Element stiffness matrix in the global coordinate system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_rotation_matrix</span>
        <span class="n">Rt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transpose_rotation_matrix</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pipe_1&#39;</span><span class="p">,</span><span class="s1">&#39;pipe_2&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_matrix_pipes</span><span class="p">()</span> <span class="o">@</span> <span class="n">R</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;beam_1&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_matrix_beam</span><span class="p">()</span> <span class="o">@</span> <span class="n">R</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;valve&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_matrix_valve</span><span class="p">()</span> <span class="o">@</span> <span class="n">R</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="o">==</span> <span class="s2">&quot;expansion_joint&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_matrix_expansion_joint</span><span class="p">()</span> <span class="o">@</span> <span class="n">R</span>  </div>

<div class="viewcode-block" id="StructuralElement.force_vector_gcs"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.force_vector_gcs">[docs]</a>    <span class="k">def</span> <span class="nf">force_vector_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the element force vector in the global coordinate system.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        array</span>
<span class="sd">            Force vector in the global coordinate system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Rt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transpose_rotation_matrix</span>
        <span class="k">return</span> <span class="n">Rt</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_vector</span><span class="p">()</span></div>

<div class="viewcode-block" id="StructuralElement._element_rotation_matrix"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement._element_rotation_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">_element_rotation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the transformation matrix that perform a rotation from the element&#39;s local coordinate system to the global coordinate system.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        array</span>
<span class="sd">            Rotation matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="n">DOF_PER_ELEMENT</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="c1"># self.sub_transformation_matrix = _rotation_matrix(self.delta_x, self.delta_y, self.delta_z)</span>
        <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_transformation_matrix</span>
        <span class="k">return</span> <span class="n">R</span></div>
    
    <span class="k">def</span> <span class="nf">_inverse_element_rotation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="n">DOF_PER_ELEMENT</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_inverse_rotation_matrix</span>
        <span class="k">return</span> <span class="n">R</span>

<div class="viewcode-block" id="StructuralElement.get_local_coordinate_system_info"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.get_local_coordinate_system_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_local_coordinate_system_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the coordinates of the element center and its local coordinate system.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        element_center_coordinates: array</span>
<span class="sd">            Coordinates of element center.</span>

<span class="sd">        directional_vectors: array</span>
<span class="sd">            Element local coordinate system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># invR = np.linalg.inv(self.sub_transformation_matrix)</span>
        <span class="c1"># u = invR@np.array([1,0,0])</span>
        <span class="c1"># v = invR@np.array([0,1,0])</span>
        <span class="c1"># w = invR@np.array([0,0,1])</span>
        <span class="c1"># invR = inverse_matrix_3x3(self.sub_transformation_matrix)</span>
        <span class="c1"># u ,v, w = invR.T</span>
        <span class="c1"># self.section_directional_vectors = [u, v, w]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_center_coordinates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_directional_vectors</span> </div>

<div class="viewcode-block" id="StructuralElement.stiffness_matrix_pipes"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.stiffness_matrix_pipes">[docs]</a>    <span class="k">def</span> <span class="nf">stiffness_matrix_pipes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the pipe element stiffness matrix according to the 3D Timoshenko beam theory in the local coordinate system. This formulation is optimized for pipe cross section data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        stiffness : array</span>
<span class="sd">            Pipe element stiffness matrix in the local coordinate system.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        stiffness_matrix_beam : Beam element stiffness matrix in the local coordinate system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

        <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">young_modulus</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">mu_parameter</span>
        <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">shear_modulus</span>

        <span class="c1"># Area properties</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">area</span>
        <span class="n">Iy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">second_moment_area_y</span>
        <span class="n">Iz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">second_moment_area_z</span>
        <span class="n">J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">polar_moment_area</span>
        <span class="n">res_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">res_y</span>
        <span class="n">res_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">res_z</span>
 
        <span class="c1"># Shear coefficiets</span>
        <span class="n">aly</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">res_y</span>
        <span class="n">alz</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">res_z</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pipe_1&#39;</span><span class="p">,</span> <span class="s1">&#39;valve&#39;</span><span class="p">]:</span>
            <span class="n">Qy</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">Qz</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">Iyz</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">principal_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">principal_axis</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="o">==</span> <span class="s1">&#39;pipe_2&#39;</span><span class="p">:</span>
            <span class="n">Qy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">first_moment_area_y</span>
            <span class="n">Qz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">first_moment_area_z</span>
            <span class="n">Iyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">second_moment_area_yz</span>
            <span class="n">principal_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">DOF_PER_ELEMENT</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Only pipe_1 and pipe_2 element types are allowed.&#39;</span><span class="p">)</span>
            <span class="k">pass</span>
            
        <span class="c1"># Determinant of Jacobian (linear 1D trasform)</span>
        <span class="n">det_jacob</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">inv_jacob</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">det_jacob</span>

        <span class="c1"># Constitutive matrices (element with constant geometry along x-axis)</span>
        <span class="c1"># Torsion and shear</span>
        <span class="n">Dts</span> <span class="o">=</span> <span class="n">mu</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">J</span><span class="p">,</span>   <span class="o">-</span><span class="n">Qy</span><span class="p">,</span>   <span class="n">Qz</span><span class="p">],</span>
                        <span class="p">[</span><span class="o">-</span><span class="n">Qy</span><span class="p">,</span> <span class="n">aly</span><span class="o">*</span><span class="n">A</span><span class="p">,</span>  <span class="mi">0</span>  <span class="p">],</span>
                        <span class="p">[</span><span class="n">Qz</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="n">alz</span><span class="o">*</span><span class="n">A</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Dts</span> <span class="o">=</span> <span class="n">Dts</span>
        <span class="c1"># Axial and Bending</span>
        <span class="n">Dab</span> <span class="o">=</span> <span class="n">E</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">A</span><span class="p">,</span>  <span class="n">Qy</span> <span class="p">,</span> <span class="o">-</span><span class="n">Qz</span><span class="p">],</span>
                        <span class="p">[</span><span class="n">Qy</span><span class="p">,</span> <span class="n">Iy</span> <span class="p">,</span> <span class="o">-</span><span class="n">Iyz</span><span class="p">],</span>
                        <span class="p">[</span><span class="o">-</span><span class="n">Qz</span><span class="p">,</span><span class="o">-</span><span class="n">Iyz</span><span class="p">,</span> <span class="n">Iz</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Dab</span> <span class="o">=</span> <span class="n">Dab</span>

        <span class="n">key</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Variables related to prestress effect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span> <span class="o">=</span> <span class="n">key</span><span class="o">*</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">Iz</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="n">aly</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span> <span class="o">=</span> <span class="n">key</span><span class="o">*</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="n">Iy</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="n">alz</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Jx_Ax</span> <span class="o">=</span> <span class="n">key</span><span class="o">*</span><span class="n">J</span><span class="o">/</span><span class="n">A</span>

        <span class="c1">## Numerical integration by Gauss quadrature</span>
        <span class="n">integrations_points</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">points</span><span class="p">,</span> <span class="n">weigths</span> <span class="o">=</span> <span class="n">gauss_quadrature</span><span class="p">(</span> <span class="n">integrations_points</span> <span class="p">)</span>

        <span class="n">Kabe</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">Ktse</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="n">Ue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">K_geo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="n">DOF_PER_ELEMENT</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_analysis_evaluated</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">static_analysis_evaluated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">Ue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_element_results_lcs</span><span class="p">()</span>
            <span class="n">mat_K_geo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_Te_matrix</span><span class="p">()</span>
            <span class="n">Fp_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_vector_stress_stiffening</span><span class="p">(</span><span class="n">vector_gcs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">Te</span> <span class="o">=</span> <span class="p">(</span><span class="n">E</span><span class="o">*</span><span class="n">A</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Ue</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="n">Ue</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">Fp_x</span>
            <span class="n">K_geo</span> <span class="o">=</span> <span class="p">(</span><span class="n">Te</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">mat_K_geo</span>

            <span class="c1"># if self.index in [12]:</span>
            <span class="c1">#     # print(&quot;\nElement 12:&quot;)</span>
            <span class="c1">#     # print(&quot;UX(11):&quot;, self.first_node.static_nodal_solution_gcs[0])</span>
            <span class="c1">#     # print(&quot;UX(12):&quot;, self.last_node.static_nodal_solution_gcs[0])</span>
            <span class="c1">#     print(f&quot;Te: {Te}&quot;)</span>

        <span class="k">for</span> <span class="n">point</span><span class="p">,</span> <span class="n">weigth</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span> <span class="n">points</span><span class="p">,</span> <span class="n">weigths</span> <span class="p">):</span>

            <span class="c1"># Shape function and its derivative</span>
            <span class="n">phi</span><span class="p">,</span> <span class="n">derivative_phi</span> <span class="o">=</span> <span class="n">shape_function</span><span class="p">(</span> <span class="n">point</span> <span class="p">)</span>
            <span class="n">dphi</span> <span class="o">=</span> <span class="n">inv_jacob</span> <span class="o">*</span> <span class="n">derivative_phi</span>

            <span class="c1"># Axial and Bending B-matrix</span>
            <span class="n">Bab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
            <span class="n">Bab</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dphi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># 1st node</span>
            <span class="n">Bab</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dphi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># 2nd node</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Bab</span> <span class="o">=</span> <span class="n">Bab</span>

            <span class="c1"># Torsional and Shear B-matrix</span>
            <span class="n">Bts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
            <span class="n">Bts</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dphi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># 1st node</span>
            <span class="n">Bts</span><span class="p">[[</span><span class="mi">1</span><span class="p">],[</span><span class="mi">5</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Bts</span><span class="p">[[</span><span class="mi">2</span><span class="p">],[</span><span class="mi">4</span><span class="p">]]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Bts</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dphi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># 2nd node</span>
            <span class="n">Bts</span><span class="p">[[</span><span class="mi">1</span><span class="p">],[</span><span class="mi">11</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">Bts</span><span class="p">[[</span><span class="mi">2</span><span class="p">],[</span><span class="mi">10</span><span class="p">]]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Bts</span> <span class="o">=</span> <span class="n">Bts</span>

            <span class="n">Kabe</span> <span class="o">+=</span> <span class="n">Bab</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Dab</span> <span class="o">@</span> <span class="n">Bab</span> <span class="o">*</span> <span class="n">det_jacob</span> <span class="o">*</span> <span class="n">weigth</span>
            <span class="n">Ktse</span> <span class="o">+=</span> <span class="n">Bts</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Dts</span> <span class="o">@</span> <span class="n">Bts</span> <span class="o">*</span> <span class="n">det_jacob</span> <span class="o">*</span> <span class="n">weigth</span>

        <span class="n">Ke</span> <span class="o">=</span> <span class="n">Kabe</span> <span class="o">+</span> <span class="n">Ktse</span> <span class="o">+</span> <span class="n">K_geo</span>

        <span class="k">return</span> <span class="n">principal_axis</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Ke</span> <span class="o">@</span> <span class="n">principal_axis</span></div>

    <span class="k">def</span> <span class="nf">get_Te_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
               
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>    
        <span class="n">den_y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">den_z</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

        <span class="n">mat_K_geo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="n">DOF_PER_ELEMENT</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        
        <span class="n">mat_K_geo</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>  <span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">den_y</span><span class="p">,</span> 
                                            <span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">den_z</span><span class="p">,</span>
                                            <span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">den_y</span><span class="p">,</span>
                                            <span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">den_z</span>  <span class="p">]</span>

        <span class="n">mat_K_geo</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>  <span class="o">-</span><span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">den_y</span><span class="p">,</span> 
                                            <span class="o">-</span><span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">den_z</span><span class="p">,</span>
                                            <span class="o">-</span><span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">den_y</span><span class="p">,</span>
                                            <span class="o">-</span><span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">den_z</span>   <span class="p">]</span>

        <span class="n">mat_K_geo</span><span class="p">[[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span><span class="p">]]</span> <span class="o">=</span>  <span class="p">[</span>  <span class="bp">self</span><span class="o">.</span><span class="n">Jx_Ax</span><span class="p">,</span> 
                                            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Jx_Ax</span><span class="p">,</span> 
                                            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Jx_Ax</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">Jx_Ax</span>    <span class="p">]</span>

        <span class="n">mat_K_geo</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>  <span class="p">(</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">2</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span><span class="o">/</span><span class="n">den_z</span><span class="p">,</span>
                                                <span class="p">(</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">2</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span><span class="o">/</span><span class="n">den_y</span><span class="p">,</span>
                                                <span class="p">(</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">2</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span><span class="o">/</span><span class="n">den_z</span><span class="p">,</span>
                                                <span class="p">(</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">2</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span><span class="o">/</span><span class="n">den_y</span>   <span class="p">]</span>

        <span class="n">mat_K_geo</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>  <span class="o">-</span><span class="p">(</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span><span class="o">/</span><span class="n">den_z</span><span class="p">,</span>
                                                <span class="o">-</span><span class="p">(</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span><span class="o">/</span><span class="n">den_y</span><span class="p">,</span>
                                                <span class="o">-</span><span class="p">(</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span><span class="o">/</span><span class="n">den_z</span><span class="p">,</span>
                                                <span class="o">-</span><span class="p">(</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Phi_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span><span class="o">/</span><span class="n">den_y</span>   <span class="p">]</span>

        <span class="n">mat_K_geo</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span>  <span class="p">[</span>   <span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_y</span><span class="p">),</span> 
                                                <span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_y</span><span class="p">),</span>  
                                                <span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_y</span><span class="p">),</span> 
                                                <span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_y</span><span class="p">)</span>     <span class="p">]</span>

        <span class="n">mat_K_geo</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">]]</span> <span class="o">=</span>  <span class="p">[</span>   <span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_z</span><span class="p">),</span> 
                                                <span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_z</span><span class="p">),</span> 
                                                <span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_z</span><span class="p">),</span> 
                                                <span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_z</span><span class="p">)</span>     <span class="p">]</span>

        <span class="n">mat_K_geo</span><span class="p">[[</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">]]</span> <span class="o">=</span>  <span class="p">[</span>   <span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_y</span><span class="p">),</span> 
                                                <span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_y</span><span class="p">),</span> 
                                                <span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_y</span><span class="p">),</span> 
                                                <span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_y</span><span class="p">)</span>    <span class="p">]</span>

        <span class="n">mat_K_geo</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span>  <span class="p">[</span>   <span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_z</span><span class="p">),</span> 
                                                <span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_z</span><span class="p">),</span> 
                                                <span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_z</span><span class="p">),</span> 
                                                <span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">den_z</span><span class="p">)</span>    <span class="p">]</span>
        
        <span class="k">return</span> <span class="n">mat_K_geo</span>

<div class="viewcode-block" id="StructuralElement.mass_matrix_pipes"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.mass_matrix_pipes">[docs]</a>    <span class="k">def</span> <span class="nf">mass_matrix_pipes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the pipe element mass matrix according to the 3D Timoshenko beam theory in the local coordinate system. This formulation is optimized for pipe cross section data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mass : array</span>
<span class="sd">            Pipe element mass matrix in the local coordinate system.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        mass_matrix_beam : Beam element mass matrix in the local coordinate system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">L</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">density</span>

        <span class="c1"># Area properties</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">area</span>
        <span class="n">Iy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">second_moment_area_y</span>
        <span class="n">Iz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">second_moment_area_z</span>
        <span class="n">J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">polar_moment_area</span>
        <span class="n">Ais</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">area_insulation</span>
        <span class="n">rho_insulation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">insulation_density</span>
                    
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">adding_mass_effect</span><span class="p">:</span>
            <span class="n">rho_fluid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluid</span><span class="o">.</span><span class="n">density</span>
            <span class="n">Ai</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">area_fluid</span>
            <span class="n">Gfl</span> <span class="o">=</span> <span class="n">rho_fluid</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">Ai</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ai</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Ai</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Gfl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span> 

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="o">==</span> <span class="s1">&#39;pipe_1&#39;</span><span class="p">:</span>
            <span class="n">Qy</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">Qz</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">Iyz</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">principal_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">principal_axis</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="o">==</span> <span class="s1">&#39;pipe_2&#39;</span><span class="p">:</span>
            <span class="n">Qy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">first_moment_area_y</span>
            <span class="n">Qz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">first_moment_area_z</span>
            <span class="n">Iyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">second_moment_area_yz</span>
            <span class="n">principal_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">DOF_PER_ELEMENT</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Only pipe_1 and pipe_2 element types are allowed.&#39;</span><span class="p">)</span>
            <span class="k">pass</span>

        <span class="c1"># Determinant of Jacobian (linear 1D trasform)</span>
        <span class="n">det_jacob</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="mi">2</span>
        
        <span class="c1">#Fluid/Insulation inertia effects</span>
        <span class="n">Gis</span> <span class="o">=</span> <span class="n">rho_insulation</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">Ais</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ais</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Ais</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span> 

        <span class="c1"># Inertial matrices</span>
        <span class="n">Ggm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="n">Ggm</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">diag_indices</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">Ggm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">Qy</span>
        <span class="n">Ggm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Qy</span>
        <span class="n">Ggm</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Qz</span>
        <span class="n">Ggm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Qz</span>
        <span class="n">Ggm</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Iyz</span>
        <span class="n">Ggm</span> <span class="o">=</span> <span class="n">rho</span><span class="o">*</span><span class="p">(</span> <span class="n">Ggm</span> <span class="o">+</span> <span class="n">Ggm</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span>
        <span class="n">Ggm</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ggm</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">Gfl</span> <span class="o">+</span> <span class="n">Gis</span>

        <span class="c1"># Numerical integration by Gauss quadrature</span>
        <span class="n">integrations_points</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">points</span><span class="p">,</span> <span class="n">weigths</span> <span class="o">=</span> <span class="n">gauss_quadrature</span><span class="p">(</span> <span class="n">integrations_points</span> <span class="p">)</span>

        <span class="n">Me</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">))</span>
        <span class="n">aux_eyes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span> <span class="n">DOF_PER_NODE_STRUCTURAL</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">point</span><span class="p">,</span> <span class="n">weigth</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">weigths</span><span class="p">):</span>
            <span class="n">phi</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">shape_function</span><span class="p">(</span> <span class="n">point</span> <span class="p">)</span>

            <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">aux_eyes</span><span class="p">,</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">aux_eyes</span><span class="p">]</span> 

            <span class="n">Me</span> <span class="o">+=</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Ggm</span> <span class="o">@</span> <span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">det_jacob</span> <span class="o">*</span> <span class="n">weigth</span>

        <span class="k">return</span> <span class="n">principal_axis</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Me</span> <span class="o">@</span> <span class="n">principal_axis</span></div>
    
<div class="viewcode-block" id="StructuralElement.force_vector"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.force_vector">[docs]</a>    <span class="k">def</span> <span class="nf">force_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the element load vector in the local coordinate system. The loads are forces and moments according to the degree of freedom.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        force : array</span>
<span class="sd">            Load in the local coordinate system.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            Only pipe_1 and pipe_2 element types are allowed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">## Numerical integration by Gauss quadrature</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="n">integrations_points</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">points</span><span class="p">,</span> <span class="n">weigths</span> <span class="o">=</span> <span class="n">gauss_quadrature</span><span class="p">(</span><span class="n">integrations_points</span><span class="p">)</span>

        <span class="c1">#Determinant of Jacobian (linear 1D trasform)</span>
        <span class="n">det_jacobian</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">Fe</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">point</span><span class="p">,</span> <span class="n">weigth</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">weigths</span><span class="p">):</span>
            <span class="n">phi</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">shape_function</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

            <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span> <span class="n">DOF_PER_NODE_STRUCTURAL</span> <span class="p">),</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span> <span class="n">DOF_PER_NODE_STRUCTURAL</span> <span class="p">)]</span> 

            <span class="n">Fe</span> <span class="o">+=</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded_forces</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">det_jacobian</span> <span class="o">*</span> <span class="n">weigth</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="o">==</span> <span class="s1">&#39;pipe_1&#39;</span><span class="p">:</span>
            <span class="n">principal_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">principal_axis</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="o">==</span> <span class="s1">&#39;pipe_2&#39;</span><span class="p">:</span>
            <span class="n">principal_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">DOF_PER_ELEMENT</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Only pipe_1 and pipe_2 element types are allowed.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_offset</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">principal_axis</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Fe</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Fe</span></div>

<div class="viewcode-block" id="StructuralElement.force_vector_acoustic_gcs"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.force_vector_acoustic_gcs">[docs]</a>    <span class="k">def</span> <span class="nf">force_vector_acoustic_gcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">,</span> <span class="n">pressures</span><span class="p">,</span> <span class="n">pressure_external</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the element load vector due to the internal acoustic pressure field in the global coordinate system. The loads are forces and moments according to the degree of freedom. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frequencies : array</span>
<span class="sd">            Frequencies of analysis in Hertz.</span>
<span class="sd">        </span>
<span class="sd">        pressure_avg : array</span>
<span class="sd">            The average between the pressure at the first node and last node of the element. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        force : array</span>
<span class="sd">            Load vector in the global coordinate system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">DOF_PER_ELEMENT</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
        <span class="n">Do</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">outer_diameter</span>
        <span class="n">Di</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">inner_diameter</span>
        
        <span class="n">nu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">poisson_ratio</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">area</span>

        <span class="c1"># p_avg = (pressures[0]+pressures[1])/2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">capped_end</span><span class="p">:</span>
            <span class="n">capped_end</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">capped_end</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pipe_1&#39;</span><span class="p">,</span> <span class="s1">&#39;pipe_2&#39;</span><span class="p">]:</span>
            <span class="n">stress_axial</span> <span class="o">=</span> <span class="p">(</span><span class="n">pressures</span> <span class="o">*</span> <span class="n">Di</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">pressure_external</span> <span class="o">*</span> <span class="n">Do</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Do</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Di</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wall_formutation_type</span> <span class="o">==</span> <span class="s2">&quot;thick wall&quot;</span><span class="p">:</span> 
                <span class="n">force</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">capped_end</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">nu</span><span class="p">)</span><span class="o">*</span> <span class="n">stress_axial</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">wall_formutation_type</span> <span class="o">==</span> <span class="s2">&quot;thin wall&quot;</span><span class="p">:</span>
                <span class="n">force</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">capped_end</span><span class="o">*</span><span class="n">stress_axial</span> <span class="o">-</span> <span class="n">nu</span><span class="o">*</span><span class="n">pressures</span><span class="o">*</span><span class="p">(</span><span class="n">Do</span><span class="o">/</span><span class="p">(</span><span class="n">Do</span><span class="o">-</span><span class="n">Di</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;expansion_joint&#39;</span><span class="p">,</span><span class="s1">&#39;valve&#39;</span><span class="p">]:</span>
            <span class="n">nu</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">force</span> <span class="o">=</span> <span class="p">(</span><span class="n">capped_end</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">nu</span><span class="p">)</span><span class="o">*</span> <span class="n">A</span> <span class="o">*</span><span class="n">pressures</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>

        <span class="n">aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="o">-</span><span class="n">force</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="n">aux</span><span class="p">[</span><span class="mi">6</span><span class="p">,:]</span> <span class="o">=</span>  <span class="n">force</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_rotation_matrix</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="o">==</span> <span class="s1">&#39;pipe_1&#39;</span><span class="p">:</span>
            <span class="n">principal_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">principal_axis</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="o">==</span> <span class="s1">&#39;pipe_2&#39;</span><span class="p">:</span>
            <span class="n">principal_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">DOF_PER_ELEMENT</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Only pipe_1 and pipe_2 element types are allowed.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_offset</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">principal_axis</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">aux</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">aux</span></div>

<div class="viewcode-block" id="StructuralElement.force_vector_stress_stiffening"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.force_vector_stress_stiffening">[docs]</a>    <span class="k">def</span> <span class="nf">force_vector_stress_stiffening</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_gcs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns description</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        S : array</span>
<span class="sd">            Load vector in the global coordinate system.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="n">DOF_PER_ELEMENT</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        
        <span class="n">D_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">outer_diameter</span>
        <span class="n">D_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">inner_diameter</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">area</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">poisson_ratio</span>

        <span class="n">P_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_pressure</span>
        <span class="n">P_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_pressure</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pipe_1&#39;</span><span class="p">,</span> <span class="s1">&#39;pipe_2&#39;</span><span class="p">,</span> <span class="s1">&#39;valve&#39;</span><span class="p">]:</span>
            <span class="n">axial_stress</span> <span class="o">=</span> <span class="p">(</span><span class="n">P_in</span><span class="o">*</span><span class="p">(</span><span class="n">D_in</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">P_out</span><span class="o">*</span><span class="p">(</span><span class="n">D_out</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">((</span><span class="n">D_out</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">D_in</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">aux</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">capped_end</span><span class="p">:</span>
            <span class="n">capped_end</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">capped_end</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="o">==</span> <span class="s1">&#39;pipe_1&#39;</span><span class="p">:</span>
            <span class="n">principal_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">principal_axis</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_type</span> <span class="o">==</span> <span class="s1">&#39;pipe_2&#39;</span><span class="p">:</span>
            <span class="n">principal_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">DOF_PER_ELEMENT</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Only pipe_1 and pipe_2 element types are allowed.&#39;</span><span class="p">)</span>

        <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">aux</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_rotation_matrix</span>

        <span class="k">if</span> <span class="n">vector_gcs</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_offset</span><span class="p">:</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">principal_axis</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">aux</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aux</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">aux</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aux</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">capped_end</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wall_formutation_type</span> <span class="o">==</span> <span class="s2">&quot;thick wall&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">capped_end</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">nu</span><span class="p">)</span> <span class="o">*</span> <span class="n">axial_stress</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">aux</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">wall_formutation_type</span> <span class="o">==</span> <span class="s2">&quot;thin wall&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">capped_end</span><span class="o">*</span><span class="n">axial_stress</span> <span class="o">-</span> <span class="n">nu</span><span class="o">*</span><span class="p">((</span><span class="n">P_in</span><span class="o">*</span><span class="n">D_out</span><span class="o">/</span><span class="p">(</span><span class="n">D_out</span><span class="o">-</span><span class="n">D_in</span><span class="p">))</span><span class="o">-</span><span class="n">P_in</span><span class="p">))</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">aux</span></div>
            
<div class="viewcode-block" id="StructuralElement.stiffness_matrix_beam"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.stiffness_matrix_beam">[docs]</a>    <span class="k">def</span> <span class="nf">stiffness_matrix_beam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the beam element stiffness matrix according to the 3D Timoshenko beam theory in the local coordinate system. This formulation is suitable for any beam cross section data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        stiffness : array</span>
<span class="sd">            Beam element stiffness matrix in the local coordinate system.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        stiffness_matrix_pipes : Pipe element stiffness matrix in the local coordinate system.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Element length</span>
        <span class="n">L</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

        <span class="c1"># Material properities</span>
        <span class="n">E</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">young_modulus</span>
        <span class="n">nu</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">poisson_ratio</span>
        <span class="n">G</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">shear_modulus</span>

        <span class="c1"># Tube cross section properties</span>
        <span class="n">A</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">area</span>
        <span class="n">I_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">second_moment_area_y</span>
        <span class="n">I_3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">second_moment_area_z</span>
        <span class="n">J</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">polar_moment_area</span>

        <span class="c1"># Process cross-section offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">offset_rotation</span><span class="p">(</span><span class="n">el_type</span> <span class="o">=</span> <span class="s1">&#39;beam_1&#39;</span><span class="p">)</span>
        <span class="n">principal_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">principal_axis</span>

        <span class="c1"># alpha = self.get_shear_coefficient(self.cross_section.additional_section_info, self.material.poisson_ratio)</span>
        <span class="c1"># k_2 = alpha</span>
        <span class="n">k_2</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Others constitutive properties</span>
        <span class="c1"># I_3     = I_2</span>
        <span class="n">k_3</span>     <span class="o">=</span> <span class="n">k_2</span>

        <span class="c1"># Auxiliar constantes</span>
        <span class="n">Phi_12</span>      <span class="o">=</span> <span class="mf">24.</span> <span class="o">*</span> <span class="n">I_3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">k_2</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Phi_13</span>      <span class="o">=</span> <span class="mf">24.</span> <span class="o">*</span> <span class="n">I_2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">k_3</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">beta_12_a</span>   <span class="o">=</span> <span class="n">E</span> <span class="o">*</span> <span class="n">I_3</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">Phi_12</span><span class="p">)</span>
        <span class="n">beta_13_a</span>   <span class="o">=</span> <span class="n">E</span> <span class="o">*</span> <span class="n">I_2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">Phi_13</span><span class="p">)</span>
        <span class="n">beta_12_b</span>   <span class="o">=</span> <span class="p">(</span><span class="mf">4.</span> <span class="o">+</span> <span class="n">Phi_12</span><span class="p">)</span> <span class="o">*</span> <span class="n">beta_12_a</span>
        <span class="n">beta_13_b</span>   <span class="o">=</span> <span class="p">(</span><span class="mf">4.</span> <span class="o">+</span> <span class="n">Phi_13</span><span class="p">)</span> <span class="o">*</span> <span class="n">beta_13_a</span>
        <span class="n">beta_12_c</span>   <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">-</span> <span class="n">Phi_12</span><span class="p">)</span> <span class="o">*</span> <span class="n">beta_12_a</span>
        <span class="n">beta_13_c</span>   <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">-</span> <span class="n">Phi_13</span><span class="p">)</span> <span class="o">*</span> <span class="n">beta_13_a</span>

        <span class="n">ke</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="n">DOF_PER_ELEMENT</span><span class="p">))</span>

        <span class="c1"># stiffness matrix diagonal construction</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag_indices</span><span class="p">(</span><span class="n">DOF_PER_ELEMENT</span><span class="p">)</span>
        <span class="n">ke</span><span class="p">[[</span><span class="n">rows</span><span class="p">],</span> <span class="p">[</span><span class="n">cols</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">E</span> <span class="o">*</span> <span class="n">A</span> <span class="o">/</span> <span class="n">L</span>               <span class="p">,</span>
                                        <span class="mi">12</span> <span class="o">*</span> <span class="n">beta_12_a</span> <span class="o">/</span> <span class="n">L</span><span class="o">**</span><span class="mi">3</span>   <span class="p">,</span>
                                        <span class="mi">12</span> <span class="o">*</span> <span class="n">beta_13_a</span> <span class="o">/</span> <span class="n">L</span><span class="o">**</span><span class="mi">3</span>   <span class="p">,</span>
                                        <span class="n">G</span> <span class="o">*</span> <span class="n">J</span> <span class="o">/</span> <span class="n">L</span>               <span class="p">,</span>
                                        <span class="n">beta_13_b</span> <span class="o">/</span> <span class="n">L</span>           <span class="p">,</span>
                                        <span class="n">beta_12_b</span> <span class="o">/</span> <span class="n">L</span>           <span class="p">,</span>
                                        <span class="n">E</span> <span class="o">*</span> <span class="n">A</span> <span class="o">/</span> <span class="n">L</span>               <span class="p">,</span>
                                        <span class="mi">12</span> <span class="o">*</span> <span class="n">beta_12_a</span> <span class="o">/</span> <span class="n">L</span><span class="o">**</span><span class="mi">3</span>   <span class="p">,</span>
                                        <span class="mi">12</span> <span class="o">*</span> <span class="n">beta_13_a</span> <span class="o">/</span> <span class="n">L</span><span class="o">**</span><span class="mi">3</span>   <span class="p">,</span>
                                        <span class="n">G</span> <span class="o">*</span> <span class="n">J</span> <span class="o">/</span> <span class="n">L</span>               <span class="p">,</span>
                                        <span class="n">beta_13_b</span> <span class="o">/</span> <span class="n">L</span>           <span class="p">,</span>
                                        <span class="n">beta_12_b</span> <span class="o">/</span> <span class="n">L</span>           <span class="p">])</span>

        <span class="c1"># stiffness matrix out diagonal construction</span>
        <span class="n">ke</span><span class="p">[</span> <span class="mi">6</span>   <span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">E</span> <span class="o">*</span> <span class="n">A</span> <span class="o">/</span> <span class="n">L</span>
        <span class="n">ke</span><span class="p">[</span> <span class="mi">9</span>   <span class="p">,</span> <span class="mi">3</span> <span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">G</span> <span class="o">*</span> <span class="n">J</span> <span class="o">/</span> <span class="n">L</span>
        <span class="n">ke</span><span class="p">[</span> <span class="mi">7</span>   <span class="p">,</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">beta_12_a</span> <span class="o">/</span> <span class="n">L</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">ke</span><span class="p">[</span> <span class="mi">11</span>  <span class="p">,</span> <span class="mi">5</span> <span class="p">]</span> <span class="o">=</span>   <span class="n">beta_12_c</span> <span class="o">/</span> <span class="n">L</span>
        <span class="n">ke</span><span class="p">[</span> <span class="mi">8</span>   <span class="p">,</span> <span class="mi">2</span> <span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">beta_13_a</span> <span class="o">/</span> <span class="n">L</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">ke</span><span class="p">[</span> <span class="mi">10</span>  <span class="p">,</span> <span class="mi">4</span> <span class="p">]</span> <span class="o">=</span>   <span class="n">beta_13_c</span> <span class="o">/</span> <span class="n">L</span>

        <span class="n">ke</span><span class="p">[[</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span>   <span class="mi">6</span> <span class="o">*</span> <span class="n">beta_12_a</span> <span class="o">/</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">ke</span><span class="p">[[</span><span class="mi">7</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">beta_12_a</span> <span class="o">/</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span>

        <span class="n">ke</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">beta_13_a</span> <span class="o">/</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">ke</span><span class="p">[[</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">]]</span> <span class="o">=</span>   <span class="mi">6</span> <span class="o">*</span> <span class="n">beta_13_a</span> <span class="o">/</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span>

        <span class="c1"># if decoupling_matrix is None:</span>
        <span class="c1">#     Ke = self.symmetrize(me)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     Ke = self.symmetrize(me)*decoupling_matrix</span>

        <span class="n">Ke</span> <span class="o">=</span> <span class="n">symmetrize</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">decoupling_matrix</span>

        <span class="k">return</span> <span class="n">principal_axis</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Ke</span> <span class="o">@</span> <span class="n">principal_axis</span></div>

<div class="viewcode-block" id="StructuralElement.mass_matrix_beam"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.mass_matrix_beam">[docs]</a>    <span class="k">def</span> <span class="nf">mass_matrix_beam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the beam element mass matrix according to the 3D Timoshenko beam theory in the local coordinate system. This formulation is suitable for any beam cross section data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mass : array</span>
<span class="sd">            Beam element mass matrix in the local coordinate system.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        mass_matrix_pipes : Pipe element mass matrix in the local coordinate system.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Element length</span>
        <span class="n">L</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

        <span class="c1"># Material properities</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">density</span>
        <span class="c1"># nu = self.material.poisson_ratio</span>
        <span class="n">E</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">young_modulus</span>
        <span class="n">G</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">shear_modulus</span>

        <span class="c1"># Tube cross section properties</span>
        <span class="n">A</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">area</span>
        <span class="n">I_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">second_moment_area_y</span>
        <span class="n">I_3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">second_moment_area_z</span>
        <span class="n">J</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">polar_moment_area</span>

        <span class="c1"># Process cross-section offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">offset_rotation</span><span class="p">(</span><span class="n">el_type</span> <span class="o">=</span> <span class="s1">&#39;beam_1&#39;</span><span class="p">)</span>
        <span class="n">principal_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">principal_axis</span>

        <span class="c1"># alpha = self.get_shear_coefficient(self.cross_section.section_info, self.material.poisson_ratio)</span>
        <span class="c1"># k_2 = alpha</span>
        <span class="n">k_2</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="c1"># Others constitutive constants</span>
        <span class="c1"># I_3     = I_2</span>
        <span class="n">J_p</span>     <span class="o">=</span> <span class="n">J</span>
        <span class="n">k_3</span>     <span class="o">=</span> <span class="n">k_2</span>

        <span class="c1"># Auxiliar constantes</span>
        <span class="c1"># 1st group</span>
        <span class="n">a_12</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">k_2</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">G</span><span class="p">)</span>
        <span class="n">a_13</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">k_3</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">G</span><span class="p">)</span>
        <span class="n">b_12</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">I_3</span><span class="p">)</span>
        <span class="n">b_13</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">I_2</span><span class="p">)</span>

        <span class="c1"># 2nd group</span>
        <span class="n">a_12u_1</span> <span class="o">=</span> <span class="mi">156</span> <span class="o">*</span> <span class="n">b_12</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">3528</span><span class="o">*</span><span class="n">a_12</span> <span class="o">*</span> <span class="n">b_12</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">20160</span> <span class="o">*</span> <span class="n">a_12</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a_12u_2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="mi">11</span> <span class="o">*</span> <span class="n">b_12</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">231</span> <span class="o">*</span> <span class="n">a_12</span> <span class="o">*</span> <span class="n">b_12</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1260</span> <span class="o">*</span> <span class="n">a_12</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">a_12u_3</span> <span class="o">=</span> <span class="mi">54</span> <span class="o">*</span> <span class="n">b_12</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1512</span> <span class="o">*</span> <span class="n">a_12</span> <span class="o">*</span> <span class="n">b_12</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">10080</span> <span class="o">*</span> <span class="n">a_12</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a_12u_4</span> <span class="o">=</span> <span class="o">-</span><span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="mi">13</span> <span class="o">*</span> <span class="n">b_12</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">378</span> <span class="o">*</span> <span class="n">a_12</span> <span class="o">*</span> <span class="n">b_12</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2520</span> <span class="o">*</span> <span class="n">a_12</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">a_12u_5</span> <span class="o">=</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">b_12</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">84</span> <span class="o">*</span> <span class="n">a_12</span> <span class="o">*</span> <span class="n">b_12</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">504</span> <span class="o">*</span> <span class="n">a_12</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">a_12u_6</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">b_12</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">a_12</span> <span class="o">*</span> <span class="n">b_12</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">168</span> <span class="o">*</span> <span class="n">a_12</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">a_12t_1</span> <span class="o">=</span> <span class="mi">36</span> <span class="o">*</span> <span class="n">b_12</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a_12t_2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="n">b_12</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">b_12</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">a_12</span><span class="p">)</span>
        <span class="n">a_12t_3</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">b_12</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">a_12</span> <span class="o">*</span> <span class="n">b_12</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1440</span> <span class="o">*</span> <span class="n">a_12</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a_12t_4</span> <span class="o">=</span> <span class="o">-</span><span class="n">b_12</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">a_12</span> <span class="o">*</span> <span class="n">b_12</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">720</span> <span class="o">*</span> <span class="n">a_12</span><span class="o">**</span><span class="mi">2</span>

        <span class="c1"># 3rd group</span>
        <span class="n">a_13u_1</span> <span class="o">=</span> <span class="mi">156</span> <span class="o">*</span> <span class="n">b_13</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">3528</span><span class="o">*</span><span class="n">a_13</span> <span class="o">*</span> <span class="n">b_13</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">20160</span> <span class="o">*</span> <span class="n">a_13</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a_13u_2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="mi">11</span> <span class="o">*</span> <span class="n">b_13</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">231</span> <span class="o">*</span> <span class="n">a_13</span> <span class="o">*</span> <span class="n">b_13</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1260</span> <span class="o">*</span> <span class="n">a_13</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">a_13u_3</span> <span class="o">=</span> <span class="mi">54</span> <span class="o">*</span> <span class="n">b_13</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1512</span> <span class="o">*</span> <span class="n">a_13</span> <span class="o">*</span> <span class="n">b_13</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">10080</span> <span class="o">*</span> <span class="n">a_13</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a_13u_4</span> <span class="o">=</span> <span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="mi">13</span> <span class="o">*</span> <span class="n">b_13</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">378</span> <span class="o">*</span> <span class="n">a_13</span> <span class="o">*</span> <span class="n">b_13</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2520</span> <span class="o">*</span> <span class="n">a_13</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">a_13u_5</span> <span class="o">=</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">b_13</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">84</span> <span class="o">*</span> <span class="n">a_13</span> <span class="o">*</span> <span class="n">b_13</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">504</span> <span class="o">*</span> <span class="n">a_13</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">a_13u_6</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">b_13</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">a_13</span> <span class="o">*</span> <span class="n">b_13</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">168</span> <span class="o">*</span> <span class="n">a_13</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">a_13t_1</span> <span class="o">=</span> <span class="mi">36</span> <span class="o">*</span> <span class="n">b_13</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a_13t_2</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="n">b_13</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">b_13</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">a_13</span><span class="p">)</span>
        <span class="n">a_13t_3</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">b_13</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">a_13</span> <span class="o">*</span> <span class="n">b_13</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1440</span> <span class="o">*</span> <span class="n">a_13</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a_13t_4</span> <span class="o">=</span> <span class="o">-</span><span class="n">b_13</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">a_13</span> <span class="o">*</span> <span class="n">b_13</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">720</span> <span class="o">*</span> <span class="n">a_13</span><span class="o">**</span><span class="mi">2</span>

        <span class="c1"># 4th group</span>
        <span class="n">gamma_12</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="n">b_12</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">12</span><span class="o">*</span><span class="n">a_12</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">gamma_13</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="n">b_13</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">12</span><span class="o">*</span><span class="n">a_13</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

        <span class="n">me</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="n">DOF_PER_ELEMENT</span><span class="p">))</span>

        <span class="c1"># Mass matrix diagonal construction</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag_indices</span><span class="p">(</span><span class="n">DOF_PER_ELEMENT</span><span class="p">)</span>
        <span class="n">me</span><span class="p">[[</span><span class="n">rows</span><span class="p">],</span> <span class="p">[</span><span class="n">cols</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span>
                                        <span class="n">gamma_12</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_12u_1</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_3</span> <span class="o">*</span> <span class="n">a_12t_1</span> <span class="o">/</span> <span class="mi">30</span><span class="p">),</span>
                                        <span class="n">gamma_13</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_13u_1</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_2</span> <span class="o">*</span> <span class="n">a_13t_1</span> <span class="o">/</span> <span class="mi">30</span><span class="p">),</span>
                                        <span class="n">rho</span> <span class="o">*</span> <span class="n">J_p</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span>
                                        <span class="n">gamma_13</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_13u_5</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_2</span> <span class="o">*</span> <span class="n">a_13t_3</span> <span class="o">/</span> <span class="mi">30</span><span class="p">),</span>
                                        <span class="n">gamma_12</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_12u_5</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_3</span> <span class="o">*</span> <span class="n">a_12t_3</span> <span class="o">/</span> <span class="mi">30</span><span class="p">),</span>
                                        <span class="n">rho</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span>
                                        <span class="n">gamma_12</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_12u_1</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_3</span> <span class="o">*</span> <span class="n">a_12t_1</span> <span class="o">/</span> <span class="mi">30</span><span class="p">),</span>
                                        <span class="n">gamma_13</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_13u_1</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_2</span> <span class="o">*</span> <span class="n">a_13t_1</span> <span class="o">/</span> <span class="mi">30</span><span class="p">),</span>
                                        <span class="n">rho</span> <span class="o">*</span> <span class="n">J_p</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span>
                                        <span class="n">gamma_13</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_13u_5</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_2</span> <span class="o">*</span> <span class="n">a_13t_3</span> <span class="o">/</span> <span class="mi">30</span><span class="p">),</span>
                                        <span class="n">gamma_12</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_12u_5</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_3</span> <span class="o">*</span> <span class="n">a_12t_3</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)])</span>

        <span class="c1"># Mass matrix out diagonal construction</span>
        <span class="n">me</span><span class="p">[</span><span class="mi">9</span> <span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span>  <span class="n">rho</span> <span class="o">*</span> <span class="n">J_p</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="mi">6</span>
        <span class="n">me</span><span class="p">[</span><span class="mi">6</span> <span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="n">rho</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="mi">6</span>
        <span class="n">me</span><span class="p">[</span><span class="mi">5</span> <span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="n">gamma_12</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_12u_2</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_3</span> <span class="o">*</span> <span class="n">a_12t_2</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">me</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">gamma_12</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_12u_2</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_3</span> <span class="o">*</span> <span class="n">a_12t_2</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">me</span><span class="p">[</span><span class="mi">4</span> <span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span>  <span class="n">gamma_13</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_13u_2</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_2</span> <span class="o">*</span> <span class="n">a_13t_2</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">me</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">gamma_13</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_13u_2</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_2</span> <span class="o">*</span> <span class="n">a_13t_2</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">me</span><span class="p">[</span><span class="mi">7</span> <span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="n">gamma_12</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_12u_3</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">-</span> <span class="n">I_3</span> <span class="o">*</span> <span class="n">a_12t_1</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">me</span><span class="p">[</span><span class="mi">8</span> <span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span>  <span class="n">gamma_13</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_13u_3</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">-</span> <span class="n">I_2</span> <span class="o">*</span> <span class="n">a_13t_1</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">me</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="n">gamma_12</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_12u_4</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_3</span> <span class="o">*</span> <span class="n">a_12t_2</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">me</span><span class="p">[</span><span class="mi">7</span> <span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">gamma_12</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_12u_4</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_3</span> <span class="o">*</span> <span class="n">a_12t_2</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">me</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span>  <span class="n">gamma_13</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_13u_4</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_2</span> <span class="o">*</span> <span class="n">a_13t_2</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">me</span><span class="p">[</span><span class="mi">8</span> <span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">gamma_13</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_13u_4</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_2</span> <span class="o">*</span> <span class="n">a_13t_2</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">me</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span>  <span class="n">gamma_12</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_12u_6</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_3</span> <span class="o">*</span> <span class="n">a_12t_4</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">me</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span>  <span class="n">gamma_13</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">a_13u_6</span> <span class="o">/</span> <span class="mi">420</span> <span class="o">+</span> <span class="n">I_2</span> <span class="o">*</span> <span class="n">a_13t_4</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>
        
        <span class="n">Me</span> <span class="o">=</span> <span class="n">symmetrize</span><span class="p">(</span><span class="n">me</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">decoupling_matrix</span>

        <span class="k">return</span> <span class="n">principal_axis</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Me</span> <span class="o">@</span> <span class="n">principal_axis</span></div>

<div class="viewcode-block" id="StructuralElement.get_shear_coefficient"><a class="viewcode-back" href="../../../code_reference/StructuralElement.html#pulse.preprocessing.structural_element.StructuralElement.get_shear_coefficient">[docs]</a>    <span class="k">def</span> <span class="nf">get_shear_coefficient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section_info</span><span class="p">,</span> <span class="n">poisson</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the shear coefficient according to the beam cross section. This coefficient is traditionally introduced in the Timoshenko beam theory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -------</span>
<span class="sd">        section_info : </span>
<span class="sd">            Beam cross section data.</span>

<span class="sd">        poisson : float</span>
<span class="sd">            Material Poisson&#39;s ratio.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        shear_coefficient : float</span>
<span class="sd">            shear coefficient</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">section_label</span> <span class="o">=</span> <span class="n">section_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">section_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
 
        <span class="k">if</span> <span class="n">section_label</span> <span class="o">==</span> <span class="s2">&quot;Rectangular section&quot;</span><span class="p">:</span>

            <span class="n">b</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">b_in</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parameters</span>

            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_in</span><span class="p">)</span><span class="o">/</span><span class="n">h</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">b_in</span><span class="o">/</span><span class="n">h</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">poisson</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span> <span class="o">+</span> <span class="mi">72</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="mi">150</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">90</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">poisson</span><span class="o">*</span><span class="p">(</span><span class="mi">11</span> <span class="o">+</span> <span class="mi">66</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="mi">135</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">90</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="mi">3</span> <span class="o">+</span> <span class="n">poisson</span><span class="p">)</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">shear_coefficient</span> <span class="o">=</span> <span class="n">numerator</span><span class="o">/</span><span class="n">denominator</span>

        <span class="k">elif</span> <span class="n">section_label</span> <span class="o">==</span> <span class="s2">&quot;Circular section&quot;</span><span class="p">:</span>

            <span class="n">d_out</span><span class="p">,</span> <span class="n">d_in</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parameters</span>
            
            <span class="n">m</span> <span class="o">=</span> <span class="n">d_in</span><span class="o">/</span><span class="n">d_out</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">poisson</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">poisson</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="mi">20</span> <span class="o">+</span> <span class="mi">12</span><span class="o">*</span><span class="n">poisson</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">shear_coefficient</span> <span class="o">=</span> <span class="n">numerator</span><span class="o">/</span><span class="n">denominator</span>

        <span class="k">elif</span> <span class="n">section_label</span> <span class="o">==</span> <span class="s2">&quot;C-section&quot;</span><span class="p">:</span>

            <span class="n">h</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">tw</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parameters</span>
            
            <span class="n">tf</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span><span class="o">+</span><span class="n">t2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">w1</span><span class="o">+</span><span class="n">w2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">tf</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="n">w2</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="n">h</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">poisson</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span> <span class="o">+</span> <span class="mi">72</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="mi">150</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">90</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">poisson</span><span class="o">*</span><span class="p">(</span><span class="mi">11</span> <span class="o">+</span> <span class="mi">66</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="mi">135</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">90</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">30</span><span class="o">*</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="mi">9</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">poisson</span><span class="o">*</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">shear_coefficient</span> <span class="o">=</span> <span class="mf">0.93</span><span class="o">*</span><span class="n">numerator</span><span class="o">/</span><span class="n">denominator</span>

        <span class="k">elif</span> <span class="n">section_label</span> <span class="o">==</span> <span class="s2">&quot;I-section&quot;</span><span class="p">:</span>

            <span class="n">h</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">tw</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parameters</span>
            
            <span class="n">tf</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span><span class="o">+</span><span class="n">t2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">w1</span><span class="o">+</span><span class="n">w2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">tf</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="n">w2</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="n">h</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">poisson</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span> <span class="o">+</span> <span class="mi">72</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="mi">150</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">90</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">poisson</span><span class="o">*</span><span class="p">(</span><span class="mi">11</span> <span class="o">+</span> <span class="mi">66</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="mi">135</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">90</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">30</span><span class="o">*</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="mi">9</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">poisson</span><span class="o">*</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">shear_coefficient</span> <span class="o">=</span> <span class="n">numerator</span><span class="o">/</span><span class="n">denominator</span>

        <span class="k">elif</span> <span class="n">section_label</span> <span class="o">==</span> <span class="s2">&quot;T-section&quot;</span><span class="p">:</span>

            <span class="n">h</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">tw</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parameters</span>
            <span class="n">tf</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">t1</span><span class="p">,</span> <span class="n">w1</span>
      
            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">tf</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="n">tw</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="n">h</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">poisson</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span> <span class="o">+</span> <span class="mi">96</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="mi">278</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">192</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">poisson</span><span class="o">*</span><span class="p">(</span><span class="mi">11</span> <span class="o">+</span> <span class="mi">88</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="mi">248</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">216</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">30</span><span class="o">*</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">m</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">poisson</span><span class="o">*</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">shear_coefficient</span> <span class="o">=</span> <span class="n">numerator</span><span class="o">/</span><span class="n">denominator</span>

        <span class="k">elif</span> <span class="n">section_label</span> <span class="o">==</span> <span class="s2">&quot;Generic section&quot;</span><span class="p">:</span>
            <span class="n">shear_coefficient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">shear_coefficient</span>

        <span class="k">return</span> <span class="n">shear_coefficient</span></div>

    <span class="k">def</span> <span class="nf">stiffness_matrix_expansion_joint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">L_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_length</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="n">K_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="n">DOF_PER_ELEMENT</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        
        <span class="n">K1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_axial_stiffness</span><span class="o">*</span><span class="n">L_e</span>
        <span class="n">K2</span> <span class="o">=</span> <span class="n">K3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_transversal_stiffness</span><span class="o">/</span><span class="n">L_e</span>
        <span class="n">K4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_torsional_stiffness</span><span class="o">*</span><span class="n">L_e</span>
        <span class="n">K5</span> <span class="o">=</span> <span class="n">K6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_angular_stiffness</span><span class="o">/</span><span class="n">L_e</span>  

        <span class="n">Ks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">K1</span><span class="p">,</span> <span class="n">K2</span><span class="p">,</span> <span class="n">K3</span><span class="p">,</span> <span class="n">K4</span><span class="p">,</span> <span class="n">K5</span><span class="p">,</span> <span class="n">K6</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">indexes_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">indexes_2</span> <span class="o">=</span> <span class="n">indexes_1</span> <span class="o">+</span> <span class="mi">6</span>

        <span class="n">K_matrix</span><span class="p">[</span><span class="n">indexes_1</span><span class="p">,</span><span class="n">indexes_1</span><span class="p">]</span> <span class="o">=</span> <span class="n">K_matrix</span><span class="p">[</span><span class="n">indexes_2</span><span class="p">,</span><span class="n">indexes_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ks</span>
        <span class="n">K_matrix</span><span class="p">[</span><span class="n">indexes_1</span><span class="p">,</span><span class="n">indexes_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">K_matrix</span><span class="p">[</span><span class="n">indexes_2</span><span class="p">,</span><span class="n">indexes_1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Ks</span>
 
        <span class="k">return</span> <span class="n">K_matrix</span>

    <span class="k">def</span> <span class="nf">stiffness_matrix_expansion_joint_harmonic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">L_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_length</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="k">if</span> <span class="n">frequencies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">number_frequencies</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">number_frequencies</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
         
        <span class="n">K_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_frequencies</span><span class="p">,</span> <span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="n">DOF_PER_ELEMENT</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            
        <span class="n">K1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_axial_stiffness</span><span class="o">*</span><span class="n">L_e</span>
        <span class="n">K2</span> <span class="o">=</span> <span class="n">K3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_transversal_stiffness</span><span class="o">/</span><span class="n">L_e</span>
        <span class="n">K4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_torsional_stiffness</span><span class="o">*</span><span class="n">L_e</span>
        <span class="n">K5</span> <span class="o">=</span> <span class="n">K6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_angular_stiffness</span><span class="o">/</span><span class="n">L_e</span>  

        <span class="n">K1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array_values</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span> <span class="n">number_frequencies</span><span class="p">)</span>
        <span class="n">K2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array_values</span><span class="p">(</span><span class="n">K2</span><span class="p">,</span> <span class="n">number_frequencies</span><span class="p">)</span>
        <span class="n">K3</span> <span class="o">=</span> <span class="n">K2</span>
        <span class="n">K4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array_values</span><span class="p">(</span><span class="n">K4</span><span class="p">,</span> <span class="n">number_frequencies</span><span class="p">)</span>
        <span class="n">K5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array_values</span><span class="p">(</span><span class="n">K5</span><span class="p">,</span> <span class="n">number_frequencies</span><span class="p">)</span>
        <span class="n">K6</span> <span class="o">=</span> <span class="n">K5</span>   

        <span class="n">Ks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">K1</span><span class="p">,</span> <span class="n">K2</span><span class="p">,</span> <span class="n">K3</span><span class="p">,</span> <span class="n">K4</span><span class="p">,</span> <span class="n">K5</span><span class="p">,</span> <span class="n">K6</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">number_frequencies</span><span class="p">,</span> <span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">)</span>
        <span class="n">indexes_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">DOF_PER_NODE_STRUCTURAL</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">indexes_2</span> <span class="o">=</span> <span class="n">indexes_1</span> <span class="o">+</span> <span class="n">DOF_PER_NODE_STRUCTURAL</span>

        <span class="n">K_matrix</span><span class="p">[:,</span><span class="n">indexes_1</span><span class="p">,</span><span class="n">indexes_1</span><span class="p">]</span> <span class="o">=</span> <span class="n">K_matrix</span><span class="p">[:,</span><span class="n">indexes_2</span><span class="p">,</span><span class="n">indexes_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ks</span>
        <span class="n">K_matrix</span><span class="p">[:,</span><span class="n">indexes_1</span><span class="p">,</span><span class="n">indexes_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">K_matrix</span><span class="p">[:,</span><span class="n">indexes_2</span><span class="p">,</span><span class="n">indexes_1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Ks</span>

        <span class="k">return</span> <span class="n">K_matrix</span>

    <span class="k">def</span> <span class="nf">mass_matrix_expansion_joint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">L_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_length</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="n">M_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="n">DOF_PER_ELEMENT</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">M1</span> <span class="o">=</span> <span class="n">M2</span> <span class="o">=</span> <span class="n">M3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_mass</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">L_e</span><span class="p">)</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">M_matrix</span><span class="p">[</span><span class="n">indexes</span><span class="p">,</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">M1</span><span class="p">,</span> <span class="n">M2</span><span class="p">,</span> <span class="n">M3</span><span class="p">,</span> <span class="n">M1</span><span class="p">,</span> <span class="n">M2</span><span class="p">,</span> <span class="n">M3</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">M_matrix</span>

    <span class="k">def</span> <span class="nf">mass_matrix_valve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">L_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_length</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="n">M_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">DOF_PER_ELEMENT</span><span class="p">,</span> <span class="n">DOF_PER_ELEMENT</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">M1</span> <span class="o">=</span> <span class="n">M2</span> <span class="o">=</span> <span class="n">M3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valve_mass</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">L_e</span><span class="p">)</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">M_matrix</span><span class="p">[</span><span class="n">indexes</span><span class="p">,</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">M1</span><span class="p">,</span> <span class="n">M2</span><span class="p">,</span> <span class="n">M3</span><span class="p">,</span> <span class="n">M1</span><span class="p">,</span> <span class="n">M2</span><span class="p">,</span> <span class="n">M3</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">M_matrix</span>

    <span class="k">def</span> <span class="nf">reset_expansion_joint_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expansion_joint_parameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_effective_diameter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_mass</span> <span class="o">=</span> <span class="mi">0</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_axial_locking_criteria</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_rods_included</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_axial_stiffness</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_transversal_stiffness</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_torsional_stiffness</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_angular_stiffness</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_stiffness_table_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">reset_valve_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valve_parameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valve_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flange_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valve_section_parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valve_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valve_stiffening_factor</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valve_mass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valve_center_coordinates</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flange_parameters</span> <span class="o">=</span> <span class="p">{}</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">valve_diameters</span> <span class="o">=</span> <span class="p">{}</span>        

    <span class="k">def</span> <span class="nf">get_array_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">number_frequencies</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">number_frequencies</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">number_frequencies</span><span class="p">)</span></div>

    <span class="c1"># def __str__(self):</span>
    <span class="c1">#     text = &#39;&#39;</span>
    <span class="c1">#     text += f&#39;Element ID: {self.index} \n&#39;</span>
    <span class="c1">#     text += f&#39;First Node ID: {self.first_node.external_index} -- Coordinates: ({self.first_node.coordinates}) [m]\n&#39;</span>
    <span class="c1">#     text += f&#39;Last Node ID: {self.last_node.external_index} -- Coordinates: ({self.first_node.coordinates}) [m]\n&#39;</span>
    <span class="c1">#     text += f&#39;Material: {self.material.name} \n&#39;</span>
    <span class="c1">#     text += f&#39;Strutural element type: {self.element_type} \n&#39;</span>
    <span class="c1">#     return text</span>
</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2020, MOPT.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>